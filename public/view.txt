@model BinusSchool.Web.Models.Scoring.EntryScoreViewModel
<style>
    #table-data tbody tr td {
        vertical-align: top;
    }

    .DTFC_LeftWrapper .DTFC_Cloned {
        margin: 0 !important;
    }

    .DTFC_LeftWrapper .DTFC_LeftBodyLiner {
        width: 100% !important;
    }

    .DTFC_LeftWrapper .DTFC_Cloned tbody tr td {
        vertical-align: top;
    }

    .bss-btn-action {
        padding: 2px;
        margin: 1px;
    }

    .uk-modal-page body {
        overflow: hidden !important;
    }
</style>
<div uk-entry_score id="entry_score" class="kt-container kt-container--fluid kt-grid__item kt-grid__item--fluid">
    <div uk-modal="stack: true" uk-modal_update_score class="modal fade py-0" id="modal-update-score" data-keyboard="false" data-backdrop="static"></div>
    <div uk-modal="stack: true" uk-modal_approval class="modal fade py-0" id="modal-approval" data-keyboard="false" data-backdrop="static"></div>

    <div class="kt-portlet">
        <div class="kt-portlet__body">
            <div class="row bss-margin-bottom-15">
                <div class="col-md-4">
                    <div class="form-group form-group-marginless">
                        <input id="selectedAcadYear" type="hidden" />
                        <input id="selectedAcadYearDesc" type="hidden" />
                        <label class="col-form-label">Academic Year</label>
                        <select uk-select2_unsorting="url:/lov/academicyear;
						        is-depend:false;
						        is-multiple:false;
						        is-allow-clear:false;
						        placeholder : Search Academic Year;
						        default-value:null;
						        object-id:Id;
						        object-code:Description;
						        object-mapping:"
                                id="filterAcadYear" class="form-control mb-0"></select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group form-group-marginless">
                        <input id="selectedGrade" type="hidden" />
                        <input id="selectedGradeDesc" type="hidden" />
                        <label class="col-form-label">Grade</label>
                        <select id="filterGrade" class="form-control mb-0"></select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group form-group-marginless">
                        <input id="selectedSemester" type="hidden" />
                        <input id="selectedSemesterDesc" type="hidden" />
                        <label class="col-form-label">Semester</label>
                        <select id="filterSemester" class="form-control mb-0"></select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group form-group-marginless">
                        <input id="selectedTerm" type="hidden" />
                        <input id="selectedTermDesc" type="hidden" />
                        <label class="col-form-label">Term</label>
                        <select id="filterTerm" class="form-control mb-0"></select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group form-group-marginless">
                        <input id="selectedSubject" type="hidden" />
                        <input id="selectedSubjectDesc" type="hidden" />
                        <label class="col-form-label">Subject</label>
                        <select id="filterSubject" class="form-control mb-0"></select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group form-group-marginless">
                        <input id="selectedClassID" type="hidden" />
                        <input id="selectedClassIDDesc" type="hidden" />
                        <label class="col-form-label">Homeroom / Class</label>
                        <select id="filterClassID" class="form-control mb-0"></select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group form-group-marginless">
                        <input id="selectedComponent" type="hidden" />
                        <input id="selectedComponentDesc" type="hidden" />
                        <label class="col-form-label">Component Name</label>
                        <select id="filterComponent" class="form-control mb-0"></select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group form-group-marginless">
                        <input id="selectedSubComponent" type="hidden" />
                        <input id="selectedSubComponentDesc" type="hidden" />
                        <label class="col-form-label">Sub Component Name</label>
                        <select id="filterSubComponent" class="form-control mb-0"></select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group form-group-marginless">
                        <input id="selectedCounter" type="hidden" />
                        <input id="selectedCounterDesc" type="hidden" />
                        <label class="col-form-label">Counter</label>
                        <select id="filterCounter" class="form-control mb-0"></select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-10"></div>
                <div class="col-md-2 text-right">
                    <button id="btnApply" class="btn btn-warning text-white btn-sm bss-btn-width-full">Apply</button>
                </div>
            </div>
        </div>
    </div>
    <div class="blocking-content-academic"></div>
    <div id="hiddenFirst" class="d-none">
        <hr />
        <div class="row mr-2">
            <div class="col-md-8"></div>
            <div class="col-md-2 text-right">
                <button id="btnPredictedGrade" class="btn btn-success text-white btn-sm bss-btn-width-full d-none">Predicted Grade</button>
            </div>
            <div class="col-md-2 text-right">
                <button id="btnTeacherJudgment" class="btn btn-success text-white btn-sm bss-btn-width-full d-none">Teacher Judgement</button>
            </div>
        </div>
        <br />
        <div class="row w-100">
            <div class="col-md-2 newScore">
                <div class="kt-portlet">
                    <div class="kt-portlet__body">
                        <span class="label-total-teacher" id="label-total-counter">0</span>
                        <span class="label-info-assignment">Total Counter</span>
                    </div>
                </div>
            </div>
            <div class="col-md-2 newScore">
                <div class="kt-portlet">
                    <div class="kt-portlet__body">
                        <span class="label-assigned" id="label-total-submitted">0</span>
                        <span class="label-info-assignment">Submitted Score</span>
                    </div>
                </div>
            </div>
            <div class="col-md-2 notNewScore">
                <div class="kt-portlet">
                    <div class="kt-portlet__body">
                        <span class="label-unassigned" id="label-total-onprogress">0</span>
                        <span class="label-info-assignment">On Progress Score</span>
                    </div>
                </div>
            </div>
            <a class="col-md-2 newScore" id="pendingScore">
                <div class="kt-portlet">
                    <div class="kt-portlet__body">
                        <span class="label-unassigned" id="label-total-pending">0</span>
                        <span class="label-info-assignment">Pending Score</span>
                    </div>
                </div>
            </a>
            <a class="col-md-2 newScore" id="unsubmittedScore">
                <div class="kt-portlet">
                    <div class="kt-portlet__body">
                        <span class="label-standard" id="label-total-unsubmitted">0</span>
                        <span class="label-info-assignment">Unsubmitted Score</span>
                    </div>
                </div>
            </a>
            <div class="col-md-2 notNewScore">
                <div class="kt-portlet">
                    <div class="kt-portlet__body">
                        <span class="label-total-teacher" id="label-total-incoming">0</span>
                        <span class="label-info-assignment">Upcoming Score</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <label id="lblScoringPeriod" class="text-danger"></label>
            </div>
            <div class="col-md-5"></div>
            <div class="col-md-3 text-right">
                <label id="lblCounterError" class="text-danger"></label>
            </div>
        </div>
        <div class="kt-portlet">
            <div class="kt-portlet__body">
                <div class="p-2">
                    <form id="formCreate" name="formCreate" class="kt-form" onsubmit="return event.preventDefault()">
                        <div id="newCounter" class="d-none">
                            <div class="row">
                                <input type="hidden" id="isAddnewCounter" name="IsAddNewCounter" />
                                <div class="col-md-1 form-group bss-margin-bottom-10">
                                    <label>Counter</label>
                                    <input type="text" id="NewComponentCounterNumber" name="NewComponentCounterNumber"
                                           class="form-control bss-margin-bottom-0" placeholder="Counter"
                                           readonly>
                                </div>
                                <div class="col-md-3 form-group bss-margin-bottom-10">
                                    <label>Date</label>
                                    <div class="kt-input-icon kt-input-icon--right">
                                        <input type="text" id="NewComponentNameDate" name="NewComponentNameDate" class="form-control bss-margin-bottom-0 select-datepicker" placeholder="Select Counter Date" readonly>
                                        <span class="kt-input-icon__icon kt-input-icon__icon--right">
                                            <span><i class="la la-calendar"></i></span>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-md-3 form-group bss-margin-bottom-10">
                                    <label>Type</label>
                                    <select class="form-control" id="ddlCounterCategory" name="NewCounterCategory">
                                    </select>
                                </div>
                                <div class="col-md-5 form-group bss-margin-bottom-10">
                                    <label>Description</label>
                                    <input type="text" id="NewCounterDescription" name="NewCounterDescription"
                                           class="form-control bss-margin-bottom-0"
                                           placeholder="Sub Component Counter Short Name">
                                </div>
                                <div class="col-md-3 form-group bss-margin-bottom-10">
                                    <label>Weight</label>
                                    <input type="text" id="NewComponentCounterWeight" name="NewComponentCounterWeight"
                                           class="form-control bss-margin-bottom-0" placeholder="Weight">
                                </div>
                                <div class="col-md-5 form-group bss-margin-bottom-10">
                                    <label>Position</label>
                                    <select class="form-control" id="NewCounterPosition" name="NewCounterPosition">
                                    </select>
                                </div>
                            </div>
                            <hr />
                        </div>
                        <input type="hidden" name="needapproval" />
                        <div class="row">
                            <div class="col-md-2">
                                <button type="button" class="btn btn-secondary btn-sm bss-btn-width-full btn-delete-counter" style="display: none;">Delete Counter Score</button>
                            </div>
                            <div class="col-md-2">
                                <button type="button" class="btn btn-primary btn-sm bss-btn-width-full btn-delete-assessment" style="display: none;">Delete Assessment</button>
                            </div>
                        </div>
                        <div id="editAssessmentSpes" style="display: none;">
                            <input type="hidden" id="IdCounterAssessment" />
                            <div class="row bss-margin-top-17">
                                <div class="col-md-3 form-group bss-margin-bottom-10">
                                    <label>Date</label>
                                    <div class="kt-input-icon kt-input-icon--right">
                                        <input type="text" id="assessmentDate" name="AssessmentDate" class="form-control bss-margin-bottom-0 select-datepicker" placeholder="Select Assessment Date" readonly>
                                        <span class="kt-input-icon__icon kt-input-icon__icon--right">
                                            <span><i class="la la-calendar"></i></span>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-md-3 form-group bss-margin-bottom-10">
                                    <label>Type</label>
                                    <select class="form-control" id="assessmentType" name="AssessmentType"
                                            uk-select2_unsorting="url:/Scoring/CounterCategories;
						                        is-depend:false;
						                        is-multiple:false;
						                        is-allow-clear:false;
						                        placeholder : Search Assessment Type;
						                        default-value:null;
						                        object-id:idCounterCategory;
						                        object-code:name;
						                        object-mapping:"
                                            style="width: 100%">
                                    </select>
                                </div>
                                <div class="col-md-5 form-group bss-margin-bottom-10">
                                    <label>Description</label>
                                    <input type="text" id="assessmentDescription" name="AssessmentDescription"
                                           class="form-control bss-margin-bottom-0"
                                           placeholder="Assessment Description">
                                </div>
                                <div class="col-md-3 offset-md-9">
                                    <button class="btn btn-primary bss-btn-width-full btn-save-assessment">Save</button>
                                </div>
                            </div>
                            <hr />
                        </div>
                        <div id="table-entry-wrapper">

                        </div>
                        <br />
                        <div class="row bss-margin-bottom-10">
                            <div class="col-md-2">
                                <button id="btnDraft"
                                        class="btn btn-secondary bss-btn-width-full btn-save-score">
                                    Save as Draft
                                </button>
                            </div>
                            <div class="col-md-2 offset-md-8">
                                <button id="btnSave"
                                        class="btn btn-primary bss-btn-width-full btn-save-score">
                                    Save
                                </button>
                            </div>
                        </div>
                    </form>
                    <div id="forFormTemp" class="d-none"></div>
                </div>
            </div>
        </div>
    </div>
</div>

@await Html.PartialAsync("Misc/component-table-entry")
@await Html.PartialAsync("Misc/component-score-option")
@await Html.PartialAsync("Misc/component-modal-update-score")
@await Html.PartialAsync("Misc/component-modal-approval")
@await Html.PartialAsync("Misc/component-modal-edit-assessment")
@section Scripts
{
    <script>
        var settingGlobalScore = {};
        var _thisDataGlobal = {};
        var studentidglobal;
        var IsCurrentCLA = false
        $(document).ready(() => {
            $('[data-toggle="tooltip"]').tooltip()
            var components = {};
            components.entry_score = {
                data: {
                    _dropdownsetting: "",
                    _scoreOneGo: "",
                    _scoresetting: "",
                    _idTeacherPosition: "",
                    _viewModel: {},
                    listTeacherPosition: [],
                    selectedClassID: '',
                    listCounterEditMaxScore: [],
                    exitStudent: [],
                    entryScoreStudentList: '',
                    exitStudentData: [],
                },
                connected: function () {
                    var viewModel = @Html.Raw(Json.Serialize(Model));
                    this._viewModel = viewModel
                    if (viewModel != null) {
                        this.initDdl();
                        var textacadyear;
                        $.ajax({
                            url: "/lov/academicyear",
                            method: 'GET',
                            success: function (success) {
                                var acadyear = success.payload;
                                textacadyear = _.find(acadyear, function (x) { return x.id == viewModel.academicYear }).description;
                            }
                        }).then(function () {
                            studentidglobal = viewModel.studentID;
                            var data = {
                                id: viewModel.academicYear,
                                description: textacadyear
                            }
                            var option = new Option(data.description, data.id, true, true);
                            $("#filterAcadYear").append(option).trigger('change');
                        });
                    }
                    else {
                        this.disabledDdl();
                        this.initDdl();
                    }
                    $(".select2").width("100%");
                },
                methods: {
                    initDdl: function () {
                        $("#filterLevel").select2({ placeholder: 'Search Level' });
                        $("#filterGrade").select2({ placeholder: 'Search Grade' });
                        $("#filterSemester").select2({ placeholder: 'Search Semester' });
                        $("#filterTerm").select2({ placeholder: 'Search Term' });
                        $("#filterStreaming").select2({ placeholder: 'Search Streaming' });
                        $("#filterSubjectType").select2({ placeholder: 'Search SubjectType' });
                        $("#filterSubject").select2({ placeholder: 'Search Subject' });
                        $("#filterSubjectLevel").select2({ placeholder: 'Search Subject Level' });
                        $("#filterClassID").select2({ placeholder: 'Search Class ID' });
                        $("#filterComponent").select2({ placeholder: 'Search Component' });
                        $("#filterSubComponent").select2({ placeholder: 'Search Sub Component' });
                        $("#filterCounter").select2({ placeholder: 'Search Counter' });
                    },
                    init: function () {
                        $("#table-data").DataTable({
                            //scrollY: "800px",
                            scrollX: true,
                            scrollCollapse: true,
                            fixedColumns: {
                                leftColumns: 2,
                            },
                            ordering: false,
                            paging: false,
                            info: false,
                        });
                    },
                    validateDdl: function () {
                        if (!$("#filterAcadYear").val()) {
                            toastr.error("Please select Academic Year");
                            return false;
                        }
                        if (!$("#filterGrade").val()) {
                            toastr.error("Please select Grade");
                            return false;
                        }
                        if (!$("#filterSemester").val()) {
                            toastr.error("Please select Semester");
                            return false;
                        }
                        if (!$("#filterTerm").val()) {
                            toastr.error("Please select Term");
                            return false;
                        }
                        if (!$("#filterSubject").val()) {
                            toastr.error("Please select Subject");
                            return false;
                        }
                        if (!$("#filterClassID").val()) {
                            toastr.error("Please select Homeroom / Class");
                            return false;
                        }
                        return true;
                    },
                    bindInnerDDL: async function (name, addCounter, selectedValue) {
                        let _this = UIkit.getComponent(UIkit.util.$("#entry_score"), "entry_score");
                        switch (name) {
                            case ("component"):
                                let isSubjectCla = $("#filterSubject").find(':selected').attr('isCla');
                                var param = {
                                    Period: $("#filterTerm").val(),
                                    Subject: $("#filterSubject").val().split('/')[0],
                                    //SubjectLevel: $("#filterSubjectLevel").val(),
                                    //SubjectLevel: isSubjectCla === 'true' ? '' : $("#filterSubject").val().split('/')[1],
                                    SubjectLevel: $("#filterSubject").val().split('/')[1],
                                    idLesson: $("#filterClassID").val().split('/')[0]
                                }
                                await binus.getReq("/Scoring/Component", param)
                                    .then(function (response) {
                                        var option = new Option("", "", false, false);
                                        $("#filterComponent").append(option);
                                        var selectedAll = response.payload.length > 0 ? false : true
                                        var option = new Option("All Components", "all", selectedAll, selectedAll);
                                        $("#filterComponent").append(option);
                                        _.each(response.payload, function (val, key) {
                                            var selected = key == 0 ? true : false
                                            if (_this._viewModel != null && _this._viewModel.component === val.id) selected = true;
                                            option = new Option(val.description, val.id, selected, selected);
                                            $("#filterComponent").append(option);
                                        });
                                        $(".select2").width("100%");
                                        _this.bindInnerDDL('subcomponent')
                                    }).catch(function () {

                                    });
                                $("#filterComponent").select2({ placeholder: 'Search Component' });
                                break;
                            case ("subcomponent"):
                                var param = {
                                    ComponentID: $("#filterComponent").val()
                                }
                                if (!param.ComponentID || param.ComponentID == "all") {
                                    var option = new Option("", "", false, false);
                                    $("#filterSubComponent").append(option);
                                    var option = new Option("All Sub Components", "all", true, true);
                                    $("#filterSubComponent").append(option);
                                    $(".select2").width("100%");
                                    _this.bindInnerDDL('counter', settingGlobalScore.isAddCounter)
                                }
                                else {
                                    await binus.getReq("/Scoring/SubComponent", param)
                                        .then(function (response) {
                                            var option = new Option("", "", false, false);
                                            $("#filterSubComponent").append(option);
                                            var selectedAll = response.payload.length > 0 ? false : true
                                            var option = new Option("All Sub Components", "all", selectedAll, selectedAll)
                                            $("#filterSubComponent").append(option);
                                            _.each(response.payload, function (val, key) {
                                                var selected = key == 0 ? true : false
                                                if (_this._viewModel != null && _this._viewModel.subComponent === val.id) selected = true;
                                                if (val.description == ' ' || val.description == '' || val.description == null) val.description = '-'
                                                option = new Option(val.description, val.id, selected, selected);
                                                $("#filterSubComponent").append(option);
                                            });
                                            $(".select2").width("100%");
                                            _this.bindInnerDDL('counter', settingGlobalScore.isAddCounter)
                                        }).catch(function () {

                                        });
                                }

                                $("#filterSubComponent").select2({ placeholder: 'Search Sub Component' });
                                break;
                            case ("counter"):
                                var param = {
                                    SubComponentID: $("#filterSubComponent").val(),
                                    LessonID: $("#filterClassID").val().split('/')[0],
                                    TeacherPositionID: _this._idTeacherPosition.join("~")
                                }
                                $("#filterCounter").empty()
                                if (!param.SubComponentID || param.SubComponentID == "all") {
                                    option = new Option("", "", false, false);
                                    $("#filterCounter").append(option);
                                    option = new Option("All", "All", true, true);
                                    $("#filterCounter").append(option);
                                    if (addCounter && settingGlobalScore.inPeriod == 1) {
                                        option = new Option("New", "NEW", false, false);
                                        $("#filterCounter").append(option);
                                    }
                                    $(".select2").width("100%");
                                    if (_this._viewModel != null) {
                                        $("#btnApply").click();
                                        _this._viewModel = null;
                                    }
                                }
                                else {
                                    await binus.getReq("/Scoring/Counter", param)
                                        .then(function (response) {
                                            $("#filterCounter").empty()
                                            var selectedAll = response.payload.length > 0 ? false : true
                                            option = new Option("All", "All", selectedAll, selectedAll);
                                            $("#filterCounter").append(option);
                                            _.each(response.payload, function (val, key) {
                                                if (!val.id.toLowerCase().includes('new')) {
                                                    var selected = key == 0 ? true : false
                                                    if (_this._viewModel != null && _this._viewModel.counter === val.id) selected = true;
                                                    if (selectedValue === val.id) selected = true;
                                                    if (val.description == ' ' || val.description == '' || val.description == null) val.description = '-'
                                                    option = new Option(val.description, val.id, selected, selected);
                                                    $("#filterCounter").append(option);
                                                }
                                            });
                                            if (addCounter && settingGlobalScore.inPeriod == 1) {
                                                option = new Option("New", "NEW", false, false);
                                                $("#filterCounter").append(option);
                                            }
                                            $(".select2").width("100%");
                                            if (_this._viewModel != null) {
                                                $("#btnApply").click();
                                                _this._viewModel = null;
                                            }
                                        }).catch(function () {

                                        });
                                }
                                $("#filterCounter").select2({ placeholder: 'Search Counter' });
                                break;
                        }

                    },
                    disabledDdl() {
                        $("#filterLevel").attr("disabled", true);
                        $("#filterGrade").attr("disabled", true);
                        $("#filterSemester").attr("disabled", true);
                        $("#filterTerm").attr("disabled", true);
                        $("#filterStreaming").attr("disabled", true);
                        $("#filterSubjectType").attr("disabled", true);
                        $("#filterSubject").attr("disabled", true);
                        $("#filterSubjectLevel").attr("disabled", true);
                        $("#filterClassID").attr("disabled", true);
                        $("#filterComponent").attr("disabled", true);
                        $("#filterSubComponent").attr("disabled", true);
                        $("#filterCounter").attr("disabled", true);
                    },
                    removeSpinnerButton(id) {
                        $("#" + id).removeClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light ml-n4').attr('disabled', false);
                    },
                    addSpinnerButton(id) {
                        $("#" + id).addClass('kt-spinner kt-spinner--right kt-spinner--sm kt-spinner--light ml-n4').attr('disabled', true);
                    },
                    setSelectedValue() {
                        $("#selectedAcadYear").val($("#filterAcadYear").val());
                        $("#selectedLevel").val($("#filterLevel").val());
                        $("#selectedGrade").val($("#filterGrade").val());
                        $("#selectedSemester").val($("#filterSemester").val());
                        $("#selectedTerm").val($("#filterTerm").val());
                        $("#selectedStreaming").val($("#filterStreaming").val());
                        $("#selectedSubjectType").val($("#filterSubjectType").val());
                        $("#selectedSubject").val($("#filterSubject").val());
                        $("#selectedSubjectLevel").val($("#filterSubjectLevel").val());
                        $("#selectedClassID").val($("#filterClassID").val());
                        $("#selectedComponent").val($("#filterComponent").val());
                        $("#selectedSubComponent").val($("#filterSubComponent").val());
                        $("#selectedCounter").val($("#filterCounter").val());

                        $("#selectedAcadYearDesc").val($("#filterAcadYear").find(":selected").text());
                        $("#selectedLevelDesc").val($("#filterLevel").find(":selected").text());
                        $("#selectedGradeDesc").val($("#filterGrade").find(":selected").text());
                        $("#selectedSemesterDesc").val($("#filterSemester").find(":selected").text());
                        $("#selectedTermDesc").val($("#filterTerm").find(":selected").text());
                        $("#selectedStreamingDesc").val($("#filterStreaming").find(":selected").text());
                        $("#selectedSubjectTypeDesc").val($("#filterSubjectType").find(":selected").text());
                        $("#selectedSubjectDesc").val($("#filterSubject").find(":selected").text());
                        $("#selectedSubjectLevelDesc").val($("#filterSubjectLevel").find(":selected").text());
                        $("#selectedClassIDDesc").val($("#filterClassID").find(":selected").text());
                        $("#selectedComponentDesc").val($("#filterComponent").find(":selected").text());
                        $("#selectedSubComponentDesc").val($("#filterSubComponent").find(":selected").text());
                        $("#selectedCounterDesc").val($("#filterCounter").find(":selected").text());
                    },
                    checkMaxRawScore: function () {
                        let returnfunc = true;
                        $('input[id^="raw_"').each((idx, elm) => {
                            if ($(elm).val() === undefined || $(elm).val() === '' || $(elm).val() === null) {
                                returnfunc = false;
                                return;
                            }
                        })
                        return returnfunc;
                    },
                    checkBlockedLMS: async function (param) {
                        var path = window.location.pathname;
                        paramNormalClass = ".isblocking-academic";
                        paramBlockingClass = ".blocking-content-academic";

                        var paramBlocking =
                        {
                            IdAcademicYear: $("#filterAcadYear").val(),
                            IdGrade: param.grade,
                            ControllerName: 'scoring',
                            ActionName: 'entryscore'
                        };

                        return toddleBlockPage(paramBlocking, paramNormalClass, paramBlockingClass);
                    },
                },
                events: [
                    {
                        name: "click",
                        delegate: "#btnApply",
                        handler: async function (e) {
                            let _this = this
                            _this.exitStudent = [];
                            _this.exitStudentData = [];
                            $("#hiddenFirst").addClass("d-none");
                            $("#newCounter").addClass("d-none");
                            $('.btn-delete-counter').hide();
                            components.entry_score.methods.addSpinnerButton("btnApply");
                            if (!components.entry_score.methods.validateDdl()) {
                                components.entry_score.methods.removeSpinnerButton("btnApply");
                                return false;
                            }
                            components.entry_score.methods.setSelectedValue();
                            let isSubjectCla = $("#filterSubject").find(':selected').attr('isCla');
                            var param = {
                                idTeacherPosition: _this._idTeacherPosition.join('~'),
                                semester: $("#selectedSemester").val(),
                                term: $("#selectedTerm").val(),
                                streaming: $("#selectedStreaming").val(),
                                grade: $("#selectedGrade").val(),
                                subject: $("#selectedSubject").val().split('/')[0],
                                //subjectlevel: isSubjectCla === 'true' ? '' : $("#selectedSubject").val().split('/')[1],
                                subjectlevel: $("#selectedSubject").val().split('/')[1],
                                classid: $("#selectedClassID").val().split('/')[0],
                                component: $("#selectedComponent").val(),
                                subcomponent: $("#selectedSubComponent").val(),
                                counter: ($("#selectedCounter").val().toLowerCase() == "all" ? "" : $("#selectedCounter").val())
                            }

                            if (await _this.checkBlockedLMS(param)) {
                                components.entry_score.methods.removeSpinnerButton("btnApply");
                                return false;
                            }
                            $("#table-entry-wrapper").empty();
                            if ((param.counter !== "" && param.counter !== 'all' && param.counter != "NEW") && settingGlobalScore.enableDeleteAllScore) $('.btn-delete-counter').show();
                            _this.selectedClassID = $("#selectedClassID").val().split('/')[0]
                            binus.getReq("/Scoring/StudentScoreHeader", param)
                                .then(function (response) {
                                    if ((param.counter !== "" && param.counter !== 'all' && param.counter != "NEW") && settingGlobalScore.isAddCounter) {
                                        $('.btn-delete-assessment').show();
                                        $("#editAssessmentSpes").show();
                                        $("#assessmentDescription").val(response.counter[0].subComponentCounterData.longDesc);
                                        $("#assessmentType").empty();
                                        var selectedCounterCategory = response.counter[0].subComponentCounterData.counterCategory;
                                        $("#assessmentType").append(new Option(selectedCounterCategory.description, selectedCounterCategory.id, true, true)).val(selectedCounterCategory.id).trigger('change');
                                        if (response.counter[0].subComponentCounterData.dateCounter !== null)
                                            $("#assessmentDate").val(moment(new Date(response.counter[0].subComponentCounterData.dateCounter)).locale('en').format("DD-MMM-YYYY"));
                                        $("#IdCounterAssessment").val(response.counter[0].subComponentCounterData.idSubComponentCounter)
                                    }
                                    else {
                                        $("#assessmentDescription").val('');
                                        $("#assessmentType").empty();
                                        $("#IdCounterAssessment").val('');
                                        $("#assessmentDate").val('');
                                        $('.btn-delete-assessment').hide();
                                        $("#editAssessmentSpes").hide();
                                    }
                                    _this.listCounterEditMaxScore = []
                                    var componentTr = "", subTemp, subComponentTr = "", lastCompIdforAverage = '', counterTemp, counterTr = "", averageSubCompSetting = [], totalLabel = 0;
                                    // Component
                                    /*
                                     * Make table header for component list in string for entry score table,
                                     * i have no other idea so sorry ^=^, please take a look at
                                     * TeacherJudgement.cshtml for better reference
                                     */
                                    _.each(response.component, function (val, key) {
                                        componentTr += "<th colspan=\"" + (param.counter == "NEW" ? _.filter(response.subComponent, function (x) {
                                            return x.componentID == val.componentID;
                                        }).length : val.totalCounter) + "\">" + val.longDesc + "</th>";
                                        if (!subTemp) subTemp = _.where(response.subComponent, { 'componentID': val.componentID });
                                        else {
                                            var temp = _.where(response.subComponent, { 'componentID': val.componentID });
                                            subTemp = subTemp.concat(temp);
                                        }
                                        if (val.averageSubCounterScore) {
                                            var stringCompJson = "{\"id\":\"" + val.componentID + "\"}";
                                            averageSubCompSetting.push(JSON.parse(stringCompJson));
                                        }
                                    });
                                    //Sub Component
                                    /*
                                     * Make table header for SubComponent list in string for entry score table,
                                     * i have no other idea so sorry ^=^, please take a look at
                                     * TeacherJudgement.cshtml for better reference
                                     */
                                    _.each(subTemp, function (val, key) {
                                        subComponentTr += "<th colspan=\"" + (param.counter == "NEW" ? 1 : _.filter(response.counter, function (x) {
                                            return x.subComponentCounterData.subComponentData.idSubComponent == val.subComponentID;
                                        }).length) + "\">" + val.longDesc + "</th>";
                                        if (!counterTemp) {
                                            counterTemp = _.filter(response.counter, function (x) {
                                                return x.subComponentCounterData.subComponentData.idSubComponent == val.subComponentID;
                                            });
                                        }
                                        else {
                                            var temp = _.filter(response.counter, function (x) {
                                                return x.subComponentCounterData.subComponentData.idSubComponent == val.subComponentID;
                                            });
                                            counterTemp = counterTemp.concat(temp);
                                        }
                                        if (!lastCompIdforAverage) lastCompIdforAverage = val.componentID;
                                        if (lastCompIdforAverage != val.componentID) {
                                            var average = _.find(averageSubCompSetting, function (x) {
                                                return x.id == lastCompIdforAverage;
                                            });
                                            if (average)
                                                totalLabel += parseFloat(_.find(subTemp, function (x) { return x.componentID == average.id }).weight);
                                            var average = _.find(averageSubCompSetting, function (x) {
                                                return x.id == val.componentID;
                                            });
                                            if (!average)
                                                totalLabel += parseFloat(val.weight);
                                            else if (key == subTemp.length - 1) {
                                                totalLabel += parseFloat(val.weight);
                                            }
                                            lastCompIdforAverage = val.componentID;
                                        }
                                        else {
                                            var average = _.find(averageSubCompSetting, function (x) {
                                                return x.id == val.componentID;
                                            });
                                            if (!average)
                                                totalLabel += parseFloat(val.weight);
                                            else if (key == subTemp.length - 1) {
                                                totalLabel += parseFloat(val.weight);
                                            }
                                        }

                                    });
                                    /*
                                     * Make table header for Counter list according to API return if
                                     * not adding new counter, please take a look at
                                     * TeacherJudgement.cshtml for better reference
                                     */
                                    if (param.counter != "NEW") {
                                        //Sub Component Counter
                                        _.each(counterTemp, function (val, key) {
                                            var counterData = JSON.parse(JSON.stringify(val))
                                            //counterTr += "<th>" + val.subComponentCounterData.longDesc;
                                            counterTr += `<th>`
                                            if (settingGlobalScore.isAddCounter) counterTr += `<a href="javascript:;" class="edit-spesific-element" data-counter="${btoa(JSON.stringify(counterData))}">${val.subComponentCounterData.longDesc}</a>`;
                                            else counterTr += val.subComponentCounterData.longDesc;
                                            var counterStartDate = moment(val.subComponentCounterData.startDate).locale('en');
                                            var counterEndDate = moment(val.subComponentCounterData.endDate).locale('en');
                                            var datenow = moment(new Date()).locale('en');
                                            if (counterStartDate < datenow && datenow <= counterEndDate) {
                                                var endDate = moment(val.subComponentCounterData.endDate).locale('en').format('YYYY-MM-DD HH:mm');
                                                counterTr += "<span class=\"icon-button\"data-toggle=\"tooltip\" data-placement=\"left\"style=\"padding-left: 10px;\" title=\"Due Date: " + endDate + "\"><img style=\"width: 20px;\" src=\"../assets/img/ic_info.svg\" /></span>";
                                            }
                                            counterTr += "</th >";
                                            if (counterData.subComponentCounterData.canUpdateMaxRawScore)
                                                _this.listCounterEditMaxScore.push({
                                                    id: counterData.subComponentCounterData.idSubComponentCounter
                                                })
                                        });
                                    }

                                    //Get Subject Score setting
                                    components.entry_score.data._scoresetting = settingGlobalScore;
                                    _thisData = components.entry_score.data._scoresetting;
                                    _thisDataGlobal = components.entry_score.data._scoresetting;

                                    $("#lblScoringPeriod").text(_thisData.periodLabel);

                                    //Teacher Judgment validation
                                    $("#btnTeacherJudgment").addClass('d-none');
                                    if (_thisData.enableTeacherJudgement) $("#btnTeacherJudgment").removeClass("d-none");
                                    else $("#btnPredictedGrade").parent().addClass('offset-md-2');
                                    //Predicted Grade
                                    $("#btnPredictedGrade").addClass('d-none');
                                    if (_thisData.enablePredictedGrade) $("#btnPredictedGrade").removeClass("d-none");

                                    var totalComp = 0, studentIDBefore = "", subM = "", compM = "", countTemp = 0, maxTemp = 0, radioTemp = "", totalCounter = 0,
                                        labelfortotal = totalLabel,
                                        emptyScoreList = false;
                                    let isAllComponent = param.component.toLowerCase() === 'all'

                                    binus.getReq("/Scoring/StudentScore", param)
                                        .then(async function (scoreResponse) {
                                            _this.entryScoreStudentList = scoreResponse;
                                            let counterHasperiod = false;
                                            //console.log(JSON.stringify(scoreResponse))
                                            /*
                                             * If adding a new counter
                                             */
                                            if (param.counter == "NEW") {
                                                $("#ddlCounterCategory").empty();
                                                $("#isAddnewCounter").val('true');
                                                var totalCounterTemporary = counterTemp.length * scoreResponse.length;
                                                if (!$("#btnTeacherJudgment").hasClass("d-none")) $("#btnTeacherJudgment").addClass("d-none");
                                                var biggestCounter;
                                                await binus.getReq("/Scoring/CounterCategories")
                                                    .then(function (response) {
                                                        if (response.statusCode == 200) {
                                                            var option = new Option("", "", false, false);
                                                            $("#ddlCounterCategory").append(option);
                                                            _.each(response.payload, function (val, key) {
                                                                option = new Option(val.name, val.idCounterCategory, false, false);
                                                                $("#ddlCounterCategory").append(option);
                                                            });
                                                            $("#ddlCounterCategory").select2({ placeholder: 'Search Counter Category' });
                                                            $(".select2").width("100%");
                                                        }
                                                    }).catch(function (data) {
                                                        binus.showerror(data);
                                                        KTApp.unblockPage();
                                                    })
                                                _.each(subTemp, function (val, key) {
                                                    if (biggestCounter) {
                                                        var biggestCounterTemp = _.filter(counterTemp, function (x) {
                                                            return x.subComponentCounterData.subComponentData.idSubComponent == val.subComponentID;
                                                        }).length;
                                                        if (biggestCounter < biggestCounterTemp) biggestCounter = biggestCounterTemp;
                                                    }
                                                    else biggestCounter = _.filter(counterTemp, function (x) {
                                                        return x.subComponentCounterData.subComponentData.idSubComponent == val.subComponentID;
                                                    }).length;
                                                });
                                                var finalStringScore = "";
                                                var isContainNumber = false;
                                                var stringMaxScore = "";
                                                var optionradio = false
                                                let firstExit = false;

                                                /*
                                                 * Make table body row for entry score table with string,
                                                 * first loop is for every student, second loop is
                                                 * for each student score
                                                 */
                                                _.each(scoreResponse, function (valStud, key) {
                                                    isStillEntry = 0;
                                                    var stringScore = "<tr>";
                                                    stringScore += "<td>" + valStud.idStudent + "</td>";
                                                    stringScore += "<td>" + valStud.studentName + "</td>";
                                                    var idsubbefore = '';
                                                    let isStudentExit = valStud.isExitStudent;
                                                    if (!isStudentExit) {
                                                        _.each(valStud.studentScoreList, function (valScore, keyScore) {

                                                            var newCounter = '';
                                                            if (idsubbefore && idsubbefore != valScore.idSubComponent) {
                                                                idsubbefore = valScore.idSubComponent;
                                                                newCounter = valScore;
                                                            }
                                                            else if (!idsubbefore) {
                                                                idsubbefore = valScore.idSubComponent;
                                                                newCounter = valScore;
                                                            }
                                                            else newCounter = '';

                                                            if (newCounter) {
                                                                var ScoreOptionD = "";
                                                                var arraySOD = [];
                                                                /*
                                                                 * If the score type is option or radio, need to make a list of
                                                                 * option for select tag in component-score-option.cshtml
                                                                 */
                                                                if (newCounter.scoreOptionDetail && newCounter.inputType == "Option") {
                                                                    var scoredet = newCounter.scoreOptionDetail.sort(sortByProperty('key'));
                                                                    _.each(scoredet, function (sod, keySod) {
                                                                        var osod = "<option value='" + sod.key + "'>";
                                                                        osod += sod.description;
                                                                        osod += "</option>";
                                                                        ScoreOptionD += osod;
                                                                    });
                                                                    if ((key == 0 || firstExit) && stringMaxScore == '')
                                                                        stringMaxScore = "<tr><td></td><td></td>";
                                                                }
                                                                else if (newCounter.scoreOptionDetail && newCounter.inputType == "Radio") {
                                                                    var scoredet = newCounter.scoreOptionDetail.sort(sortByProperty('key'));
                                                                    _.each(scoredet, function (sod, keySod) {
                                                                        var jsonRad = "{\"code\":\"" + sod.grade + "\",\"value\":" + sod.key + "}";
                                                                        arraySOD.push(JSON.parse(jsonRad));
                                                                    });
                                                                    if ((key == 0 || firstExit) && stringMaxScore == '')
                                                                        stringMaxScore = "<tr><td></td><td></td>";
                                                                }
                                                                else {
                                                                    if ((key == 0 || firstExit) && stringMaxScore == '')
                                                                        stringMaxScore = "<tr><td></td><td>Max Score</td>";
                                                                }
                                                                stringScore += "<td>";
                                                                var data = {
                                                                    idtransaction: '',
                                                                    maxscorelength: valScore.maxScoreLength,
                                                                    idapprovalstate: '',
                                                                    forroleactionnext: '',
                                                                    idactionnext: '',
                                                                    idscore: '',
                                                                    isEditable: true,
                                                                    studentID: valStud.idStudent,
                                                                    scoreOption: newCounter.inputType,
                                                                    value: '',
                                                                    isHasCodeSetting: _thisData.showCodeOption,
                                                                    CodeSettingList: _thisData.codeList,
                                                                    ScoreOptionList: ScoreOptionD,
                                                                    RadioOptionList: arraySOD,
                                                                    counterID: newCounter.idSubComponent + "_new",
                                                                    setPeriod: 'yes',
                                                                    inPeriod: 1,
                                                                    subcomponentID: newCounter.idSubComponent,
                                                                    componentID: newCounter.idComponent,
                                                                    weight: '',
                                                                    subweight: subTemp.find(function (x) { return x.subComponentID == newCounter.idSubComponent }).weight,
                                                                    rawScore: '',
                                                                    averagecounter: subTemp.find(function (x) { return x.subComponentID == newCounter.idSubComponent }).averageCounterScore,
                                                                    averageSub: response.component.find(function (x) { return x.componentID == newCounter.idComponent }).averageSubCounterScore
                                                                }
                                                                var templateOption = _.template($("#component-score-option").html());
                                                                stringScore += templateOption({ data: data });
                                                                stringScore += "</td>";
                                                                if ((key == 0 || firstExit))
                                                                    stringMaxScore += "<td>";
                                                                if (newCounter.inputType == "TextBox") {
                                                                    isContainNumber = true;
                                                                    if ((key == 0 || firstExit))
                                                                        stringMaxScore += "<input type=\"text\" id=\"raw_" + newCounter.idSubComponent + "_new" + "\" value=\"" + newCounter.maxScoreLength + "\" onkeypress='return (event.charCode != 8 && event.charCode == 0 || (event.charCode >= 48 && event.charCode <= 57))' class=\"form-control raw_\" name=\"raw_" + newCounter.idSubComponent + "_new" + "\" style =\"min-width:60px;\" >";
                                                                }
                                                                else if (newCounter.inputType == "Option") {
                                                                    if ((key == 0 || firstExit)) {
                                                                        optionradio = true
                                                                        var scoredet = newCounter.scoreOptionDetail.sort(sortByProperty('key'));
                                                                        stringMaxScore += '<select class="form-control set-all-counter" counterId="' + newCounter.idSubComponent + "_new" + '" style="padding-left: 5px;padding-right:5px;">'
                                                                        var osod = "<option value=''>"
                                                                        osod += "</option>";
                                                                        stringMaxScore += osod
                                                                        _.each(scoredet, function (sod, keySod) {
                                                                            var osod = "<option value='" + sod.key + "'>"
                                                                            osod += sod.description;
                                                                            osod += "</option>";
                                                                            stringMaxScore += osod;
                                                                        });
                                                                        stringMaxScore += _thisData.codeList
                                                                        stringMaxScore += '</select>'
                                                                    }
                                                                }
                                                                else if (newCounter.inputType == "Radio") {
                                                                    if ((key == 0 || firstExit)) {
                                                                        optionradio = true
                                                                        var scoredet = newCounter.scoreOptionDetail.sort(sortByProperty('key'));
                                                                        var radiobuttonAll = ''
                                                                        _.each(scoredet, function (sod, keySod) {
                                                                            radiobuttonAll += '<label class="kt-radio kt-radio--brand mr-2"> <input type="radio" name="' + newCounter.idSubComponent + "_new" + '" value="' + sod.key + '" onclick="clickAllRadioButton(this)"><span></span> ' + sod.grade + ' <span></span> </label>'
                                                                        });
                                                                        stringMaxScore += '<div class="form-row" style="min-width: 300px;"> <div class="col-12"> <div class="kt-radio-inlinex">'
                                                                        stringMaxScore += radiobuttonAll
                                                                        stringMaxScore += '</div> </div> </div>'
                                                                    }
                                                                }
                                                                if ((key == 0 || firstExit))
                                                                    stringMaxScore += "</td>";
                                                                firstExit = false;
                                                            }

                                                        });
                                                        stringScore += "</tr>";
                                                        finalStringScore += stringScore;
                                                    }
                                                    else {
                                                        _this.exitStudent.push(valStud.idStudent);
                                                        _this.exitStudentData.push(valStud);
                                                        if (key === 0) firstExit = true;
                                                        totalCounterTemporary -= valStud.studentScoreList?.length;
                                                    }
                                                });
                                                $("#label-total-counter").html(counterTemp.length * scoreResponse.length);
                                                finalMaxScorestring += stringMaxScore + "</tr>";
                                                var dataTable = {
                                                    component: componentTr,
                                                    subcomponent: subComponentTr,
                                                    counter: '',
                                                    scorehtml: finalStringScore,
                                                    maxscorehtml: stringMaxScore,
                                                    isAddCounter: 1,
                                                    isContainNumber: isContainNumber,
                                                    total: labelfortotal,
                                                    optionradio: optionradio
                                                }
                                                var templateTable = _.template($("#component-table-entry").html());
                                                $("#table-entry-wrapper").append(templateTable({ data: dataTable }));

                                                var now = new Date();

                                                var day = ("0" + now.getDate()).slice(-2);
                                                var month = ("0" + (now.getMonth() + 1)).slice(-2);

                                                var today = now.getFullYear() + "-" + (month) + "-" + (day);

                                                $('#NewComponentNameDate').val(today);

                                                $("#NewComponentCounterNumber").val(biggestCounter + 1);

                                                $(".notNewScore").hide();
                                                $(".newScore").removeClass("col-md-2").addClass("col-md-3");
                                                $("#newCounter").removeClass("d-none");
                                                $("#NewCounterPosition").empty()
                                                var counterOption = new Option('', '')
                                                $("#NewCounterPosition").append(counterOption)
                                                _this.listTeacherPosition.forEach((_value, idx) => {
                                                    counterOption = new Option(_value.description, _value.idTeacherPosition, (_value.code == 'ST' ? true : false), (_value.code == 'ST' ? true : false))
                                                    $("#NewCounterPosition").append(counterOption)
                                                })
                                                $("#NewCounterPosition").select2({
                                                    placeholder: 'Select Position'
                                                })
                                                $(".select2").css('width', '100%')
                                            }
                                            // else
                                            else {
                                                $("#isAddnewCounter").val('');
                                                if (!counterTemp || !scoreResponse) {
                                                    toastr.error('No Data Available');
                                                    components.entry_score.methods.removeSpinnerButton("btnApply");
                                                    KTApp.unblockPage();
                                                    return;
                                                }
                                                var totalCounterTemporary = counterTemp.length * scoreResponse.length;
                                                var finalStringScore = "";
                                                var finalMaxScorestring = "";
                                                var isStillEntry = 0;
                                                var isContainNumber = false;
                                                var stringMaxScore = "";
                                                var position = _this._idTeacherPosition
                                                var optionradio = false
                                                let firstExit = false;

                                                _.each(scoreResponse, function (valStud, key) {
                                                    isStillEntry = 0;
                                                    var stringScore = "<tr>";
                                                    if (studentidglobal && studentidglobal == valStud.idStudent) stringScore = "<tr class=\"bg-secondary\">"
                                                    stringScore += "<td>" + valStud.idStudent + "</td>";
                                                    stringScore += "<td>" + valStud.studentName + "</td>";
                                                    let isStudentExit = valStud.isExitStudent
                                                    if (!isStudentExit) {
                                                        if (valStud.studentScoreList.length > 0)
                                                            _.each(valStud.studentScoreList, function (valScore, keyScore) {
                                                                var idtransaction = "";
                                                                var idapprovalstate = "";
                                                                var forroleactionnext = "";
                                                                var idactionnext = "";
                                                                var ScoreOptionD = "";
                                                                var statuscounter = "";
                                                                var arraySOD = [];
                                                                var arraySODDesc = [];
                                                                var valuedesc = '';
                                                                if (valScore.scoreOptionDetail && valScore.inputType == "Option") {
                                                                    var scoredet = valScore.scoreOptionDetail.sort(sortByProperty('key'));
                                                                    _.each(scoredet, function (sod, keySod) {
                                                                        var osod = "<option value='" + sod.key + "'>";
                                                                        osod += sod.description;
                                                                        osod += "</option>";
                                                                        ScoreOptionD += osod;
                                                                    });
                                                                    if ((key == 0 || firstExit) && stringMaxScore == '')
                                                                        stringMaxScore = "<tr><td></td><td></td>";
                                                                }
                                                                else if (valScore.scoreOptionDetail && valScore.inputType == "Radio") {
                                                                    var scoredet = valScore.scoreOptionDetail.sort(sortByProperty('key'));
                                                                    _.each(scoredet, function (sod, keySod) {
                                                                        var jsonRad = "{\"code\":\"" + sod.grade + "\",\"value\":" + sod.key + "}";
                                                                        arraySOD.push(JSON.parse(jsonRad));
                                                                        var jsonRadDesc = "{\"code\":\"" + sod.description + "\",\"value\":" + sod.key + "}";
                                                                        arraySODDesc.push(JSON.parse(jsonRadDesc));
                                                                    });
                                                                    if ((key == 0 || firstExit) && stringMaxScore == '')
                                                                        stringMaxScore = "<tr><td></td><td></td>";
                                                                }
                                                                else {
                                                                    if ((key == 0 || firstExit) && stringMaxScore == '')
                                                                        stringMaxScore = "<tr><td></td><td>Max Score</td>";
                                                                }
                                                                var scoreValue;
                                                                var oldScore;
                                                                var isUpdateScore = valScore.updateScore, isEditAble = "";
                                                                var userId = "@ViewBag.userId";
                                                                if (isUpdateScore) {
                                                                    isEditAble = isUpdateScore.isEditable;
                                                                    statuscounter = isUpdateScore.statusAction;
                                                                    idtransaction = isUpdateScore.idTransactionScore;
                                                                    idapprovalstate = isUpdateScore.idApprovalState;
                                                                    if (isUpdateScore.forPositionActionNext != null && isUpdateScore.forPositionActionNext != '' && position.includes(isUpdateScore.forPositionActionNext))
                                                                        forroleactionnext = isUpdateScore.forPositionActionNext;
                                                                    if (userId && userId == isUpdateScore.idUserActionNext)
                                                                        idactionnext = isUpdateScore.idUserActionNext;
                                                                    if (isUpdateScore.updateScore) {
                                                                        scoreValue = isUpdateScore.updateScore;
                                                                        if (valScore.subComponentCounterScore)
                                                                            oldScore = valScore.subComponentCounterScore;
                                                                        else
                                                                            oldScore = isUpdateScore.rawScore;
                                                                    }
                                                                    else {
                                                                        if (isUpdateScore.rawScore) {
                                                                            scoreValue = isUpdateScore.rawScore;
                                                                            oldScore = isUpdateScore.rawScore;
                                                                        }
                                                                        else {
                                                                            scoreValue = valScore.subComponentCounterScore;
                                                                            oldScore = valScore.subComponentCounterScore;
                                                                        }
                                                                    }
                                                                    if (valScore.subComponentCounterScore && !scoreValue) {
                                                                        scoreValue = valScore.subComponentCounterScore;
                                                                        oldScore = undefined;
                                                                    }
                                                                    else if (valScore.subComponentCounterScore && isUpdateScore.statusAction == 6) {
                                                                        scoreValue = valScore.subComponentCounterScore;
                                                                        oldScore = undefined;
                                                                    }
                                                                }
                                                                else scoreValue = valScore.subComponentCounterScore;
                                                                var isenablelink = true;
                                                                if (isUpdateScore && isUpdateScore.statusAction == 3 && (idactionnext == '' || forroleactionnext == '')) isenablelink = false;
                                                                if (!settingGlobalScore.updatePeriod) isenablelink = false;
                                                                var counterStart = counterTemp.find(function (x) { return x.subComponentCounterData.idSubComponentCounter == valScore.idSubComponentCounter }).subComponentCounterData.startDate;
                                                                var counterEnd = counterTemp.find(function (x) { return x.subComponentCounterData.idSubComponentCounter == valScore.idSubComponentCounter }).subComponentCounterData.endDate;
                                                                var inPeriod = counterTemp.find(function (x) { return x.subComponentCounterData.idSubComponentCounter == valScore.idSubComponentCounter }).subComponentCounterData.canEntryScoreInPeriod;
                                                                if (counterStart) {
                                                                    if (!inPeriod) {
                                                                        let couterStartDateTime = moment(counterStart).locale('en');
                                                                        let counterEndDateTime = moment(counterEnd).locale('en');
                                                                        let datenow = new Date();
                                                                        let nowDate = moment(datenow).locale('en');
                                                                        if (counterEndDateTime < nowDate) {
                                                                            inPeriod = -1;
                                                                        }
                                                                        else if (couterStartDateTime > datenow) {
                                                                            inPeriod = 0;
                                                                        }
                                                                        else inPeriod = 1;
                                                                    }
                                                                    else inPeriod = 1;
                                                                    if (inPeriod === 1) counterHasperiod = true;
                                                                }
                                                                else inPeriod = _thisData.inPeriod;
                                                                if (inPeriod != 1 && isUpdateScore != null && statuscounter == 1) {
                                                                    scoreValue = isUpdateScore.rawScore
                                                                }
                                                                var rawScore = counterTemp.find(function (x) { return x.subComponentCounterData.idSubComponentCounter == valScore.idSubComponentCounter }).subComponentCounterData.maxRawScore;
                                                                if ((isEditAble && (statuscounter == 1 || statuscounter == 4) && inPeriod > 0) || (!isEditAble && !scoreValue && inPeriod > 0)) {
                                                                    isStillEntry++;
                                                                    if (scoreValue > rawScore) {
                                                                        if (scoreValue != null) scoreValue = isUpdateScore.rawScore
                                                                        else
                                                                            scoreValue = (scoreValue * rawScore) / valScore.subComponentCounterWeight
                                                                    }
                                                                }

                                                                var data = {
                                                                    oldScore: oldScore,
                                                                    isenablelink: isenablelink,
                                                                    maxscorelength: valScore.maxScoreLength,
                                                                    isneedapprove: _thisData.needChangeApproval,
                                                                    isneedapprovecode: _thisData.needChangeCodeApproval,
                                                                    counterstatus: statuscounter,
                                                                    idtransaction: idtransaction,
                                                                    idapprovalstate: idapprovalstate,
                                                                    forroleactionnext: forroleactionnext,
                                                                    idactionnext: idactionnext,
                                                                    idscore: valScore.idScore,
                                                                    isEditable: isEditAble,
                                                                    studentID: valStud.idStudent,
                                                                    scoreOption: valScore.inputType,
                                                                    value: scoreValue,
                                                                    truerawscore: '',
                                                                    valueDesc: '',
                                                                    isHasCodeSetting: _thisData.showCodeOption,
                                                                    CodeSettingList: _thisData.codeList,
                                                                    ScoreOptionList: ScoreOptionD,
                                                                    RadioOptionList: arraySOD,
                                                                    RadioOptionListDesc: arraySODDesc,
                                                                    counterID: valScore.idSubComponentCounter,
                                                                    setPeriod: counterStart,
                                                                    inPeriod: inPeriod,
                                                                    subcomponentID: valScore.idSubComponent,
                                                                    componentID: valScore.idComponent,
                                                                    weight: valScore.subComponentCounterWeight,
                                                                    subweight: subTemp.find(function (x) { return x.subComponentID == valScore.idSubComponent }).weight,
                                                                    rawScore: rawScore,
                                                                    averagecounter: subTemp.find(function (x) { return x.subComponentID == valScore.idSubComponent }).averageCounterScore,
                                                                    averageSub: response.component.find(function (x) { return x.componentID == valScore.idComponent }).averageSubCounterScore,
                                                                    realScore: valScore.subComponentCounterScore,
                                                                    submittedRawScore: valScore.rawScore
                                                                }
                                                                if (!isEditAble && (scoreValue || scoreValue == 0)) {
                                                                    var scorefordesc = oldScore != undefined ? oldScore : scoreValue
                                                                    if ((scorefordesc || scorefordesc == 0) > data.rawScore) {
                                                                        var tempScore = (parseFloat(scorefordesc) * parseFloat(data.rawScore)) / parseFloat(data.weight);
                                                                        if (valScore.scoreOptionDetail && valScore.scoreOptionDetail.length > 0)
                                                                            valuedesc = _.find(valScore.scoreOptionDetail, function (x) { return x.key == tempScore }).description;
                                                                        else valuedesc = scorefordesc;
                                                                    }
                                                                    else if ((scorefordesc || scorefordesc == 0) && parseFloat(scorefordesc) >= 0) {
                                                                        if (valScore.scoreOptionDetail && valScore.scoreOptionDetail.length > 0)
                                                                            valuedesc = _.find(valScore.scoreOptionDetail, function (x) { return x.key == scorefordesc }).description;
                                                                        else valuedesc = scorefordesc;
                                                                    }
                                                                    else if (scorefordesc && parseFloat(scorefordesc) < 0) {
                                                                        valuedesc = _.find(valScore.scoreOptionDetail, function (x) { return x.key == scorefordesc })?.description;
                                                                        if (!valuedesc)
                                                                            valuedesc = _.find(_thisData.codeListObject, function (x) { return x.key == scorefordesc }).longDesc;
                                                                    }
                                                                }
                                                                if (scoreValue > data.rawScore) {
                                                                    scoreValue = valScore.rawScore;
                                                                }
                                                                //if (data.oldScore > data.rawScore) {
                                                                //    data.oldScore = (data.oldScore * data.rawScore) / data.weight;
                                                                //}
                                                                data.truerawscore = scoreValue;
                                                                data.valueDesc = valuedesc;
                                                                var templateOption = _.template($("#component-score-option").html());
                                                                stringScore += "<td style=\"min-width:80px;\">";
                                                                stringScore += templateOption({ data: data });
                                                                stringScore += "</td>";
                                                                if ((key == 0 || firstExit))
                                                                    stringMaxScore += "<td>";
                                                                if (valScore.inputType == "TextBox") {
                                                                    isContainNumber = true;
                                                                    if ((key == 0 || firstExit)) {
                                                                        if (_.find(_this.listCounterEditMaxScore, (x) => { return x.id == valScore.idSubComponentCounter }))
                                                                            stringMaxScore += "<input type=\"text\" id=\"raw_" + valScore.idSubComponentCounter + "\" placeholder=\"Recommended: " + counterTemp.find(function (x) { return x.subComponentCounterData.idSubComponentCounter == valScore.idSubComponentCounter }).subComponentCounterData.maxRawScore + "\" onkeypress='return (event.charCode != 8 && event.charCode == 0 || (event.charCode >= 48 && event.charCode <= 57))' class=\"form-control raw_" + valScore.idSubComponentCounter + "\" name=\"raw_" + valScore.idSubComponentCounter + "\" style =\"min-width:60px;\" >"
                                                                        else
                                                                            stringMaxScore += "<input type=\"text\" id=\"raw_" + valScore.idSubComponentCounter + "\" value=\"" + counterTemp.find(function (x) { return x.subComponentCounterData.idSubComponentCounter == valScore.idSubComponentCounter }).subComponentCounterData.maxRawScore + "\" disabled class=\"form-control raw_score\" style =\"min-width:60px;\" >";
                                                                    }
                                                                }
                                                                else if (valScore.inputType == "Option") {
                                                                    if ((key == 0 || firstExit)) {
                                                                        optionradio = true
                                                                        var scoredet = valScore.scoreOptionDetail.sort(sortByProperty('key'));
                                                                        stringMaxScore += '<select class="form-control set-all-counter" counterId="' + valScore.idSubComponentCounter + '" style="padding-left: 5px;padding-right:5px;">'
                                                                        var osod = "<option value=''>"
                                                                        osod += "</option>";
                                                                        stringMaxScore += osod
                                                                        _.each(scoredet, function (sod, keySod) {
                                                                            var osod = "<option value='" + sod.key + "'>"
                                                                            osod += sod.description;
                                                                            osod += "</option>";
                                                                            stringMaxScore += osod;
                                                                        });
                                                                        stringMaxScore += _thisData.codeList
                                                                        stringMaxScore += '</select>'
                                                                    }
                                                                }
                                                                else if (valScore.inputType == "Radio") {
                                                                    if ((key == 0 || firstExit)) {
                                                                        optionradio = true
                                                                        var scoredet = valScore.scoreOptionDetail.sort(sortByProperty('key'));
                                                                        var radiobuttonAll = ''
                                                                        _.each(scoredet, function (sod, keySod) {
                                                                            radiobuttonAll += '<label class="kt-radio kt-radio--brand mr-2"> <input type="radio" name="' + valScore.idSubComponentCounter + '" value="' + sod.key + '" onclick="clickAllRadioButton(this)" class="set-all-radio"><span></span> ' + sod.grade + ' <span></span> </label>'
                                                                        });
                                                                        stringMaxScore += '<div class="form-row" style="min-width: 300px;"> <div class="col-12"> <div class="kt-radio-inlinex">'
                                                                        stringMaxScore += radiobuttonAll
                                                                        stringMaxScore += '</div> </div> </div>'
                                                                    }
                                                                }
                                                                if ((key == 0 || firstExit))
                                                                    stringMaxScore += "</td>";

                                                            });
                                                        else {
                                                            emptyScoreList = true;
                                                        }
                                                        if (isContainNumber == true && isAllComponent) {
                                                            stringScore += "<td class=\"text-center\">";
                                                            stringScore += "<label id=\"" + valStud.idStudent + ",total\" name=\"" + valStud.idStudent + ",total\" value=\"" + (valStud.subjectScore != null ? valStud.subjectScore.showScore : '') + "\">" + (valStud.subjectScore != null ? valStud.subjectScore.showScore : '') + "</label>"
                                                            stringScore += "</td>";
                                                            if ((key == 0 || firstExit))
                                                                stringMaxScore += "<td></td>"
                                                        }
                                                        else if (isContainNumber == -1 && isAllComponent) {
                                                            stringScore += "<td></td>";
                                                        }
                                                        stringScore += "</tr>";
                                                        finalStringScore += stringScore;
                                                        firstExit = false;
                                                    }
                                                    else {
                                                        _this.exitStudent.push(valStud.idStudent);
                                                        _this.exitStudentData.push(valStud);
                                                        if (key === 0) firstExit = true;
                                                        totalCounterTemporary -= valStud.studentScoreList?.length;
                                                    }
                                                });
                                                $("#label-total-counter").html(totalCounterTemporary);
                                                finalMaxScorestring += stringMaxScore + "</tr>";
                                                var dataTable = {
                                                    component: componentTr,
                                                    subcomponent: subComponentTr,
                                                    counter: counterTr,
                                                    scorehtml: finalStringScore,
                                                    maxscorehtml: finalMaxScorestring,
                                                    isAddCounter: 0,
                                                    isContainNumber: isContainNumber,
                                                    total: labelfortotal,
                                                    optionradio: optionradio,
                                                    isAllComponent: isAllComponent
                                                    //enablePredicted: enablePredicted
                                                }
                                                var templateTable = _.template($("#component-table-entry").html());
                                                $("#table-entry-wrapper").append(templateTable({ data: dataTable }));

                                                $(".notNewScore").show();
                                                $(".newScore").removeClass("col-md-3").addClass("col-md-2");
                                            }

                                            // Validating and Counting Score
                                            var studentID = "", countCounter = 0, countSub = 0,
                                                incoming = 0, isNotEntry = 0;
                                            var averagesubbefore = '';
                                            var averagecounterbefore = '';
                                            let prorateArray = [];
                                            let SubweightSum = 0;
                                            //let periodForPredicted = true
                                            let valueNotNullBefore = false
                                            $(".input_score").each(function (key, e) {
                                                var id;
                                                if (e.type == "radio") {
                                                    id = e.attributes.getId.value.split(",");
                                                }
                                                else id = e.attributes.id.value.split(",");
                                                var setPeriod = $("input[class='hid," + id[0] + "," + id[1] + "," + id[2] + ",isSetPeriod']").val();
                                                var inPeriod = $("input[class='hid," + id[0] + "," + id[1] + "," + id[2] + ",isInPeriod']").val();
                                                var averageCounterScore = $("input[class='hid," + id[0] + "," + id[1] + "," + id[2] + ",averageCounter']").val();
                                                var averageSubCounterScore = $("input[class='hid," + id[0] + "," + id[1] + "," + id[2] + ",averageSub']").val();
                                                var statuscounter = $("input[class='hid," + id[0] + "," + id[1] + "," + id[2] + ",counterstatus']").val();

                                                // Validating period
                                                if (!setPeriod) {
                                                    /*
                                                     * If counter not set any period, than follow
                                                     * the SubjectScoreSetting Period
                                                     */
                                                    if (_thisData.inPeriod == 0 || _thisData.inPeriod == false) {
                                                        /*
                                                         * If period not yet started, disable input
                                                         */
                                                        if (e.type == "radio") {
                                                            $("input[name='" + e.attributes.name.value + "']").prop('disabled', true);
                                                            if (radioTemp && $(e).attr('name') != radioTemp) {
                                                                incoming++;
                                                            }
                                                            else if (!radioTemp) {
                                                                incoming++;
                                                            }
                                                        }
                                                        else {
                                                            $(e).prop("disabled", true);
                                                            if (e.type !== "hidden")
                                                                incoming++;
                                                        }
                                                        $("select[id='opt," + id.join(",") + "']").prop("disabled", true);
                                                    }
                                                    //if (_thisData.inPeriod == 0 || _thisData.inPeriod == false || _thisData.inPeriod == -1)
                                                    //    periodForPredicted = false

                                                }
                                                else {
                                                    if (inPeriod == 0 || inPeriod == false || inPeriod == "") {
                                                        /*
                                                         * If period not yet started, disable input
                                                         */
                                                        if (e.type == "radio") {
                                                            $("input[name='" + e.attributes.name.value + "']").prop('disabled', true);
                                                            if (radioTemp && $(e).attr('name') != radioTemp) {
                                                                incoming++;
                                                            }
                                                            else if (!radioTemp) {
                                                                incoming++;
                                                            }
                                                        }
                                                        else {
                                                            $(e).prop("disabled", true);
                                                            if (e.type !== "hidden")
                                                                incoming++;
                                                        }
                                                        $("select[id='opt," + id.join(",") + "']").prop("disabled", true);
                                                    }
                                                    //if (_thisData.inPeriod == 0 || _thisData.inPeriod == false || _thisData.inPeriod == -1)
                                                    //    periodForPredicted = false

                                                }
                                                //Number
                                                if (e.type == "text") {
                                                    if (setPeriod != 1 && inPeriod != 1) {
                                                        $(e).prop('disabled', true)
                                                        $("select[id='opt," + id.join(",") + "']").prop("disabled", true);
                                                    }
                                                    if ($(e).val() != '') valueNotNullBefore = true
                                                    isNotEntry++;
                                                    if (studentID) {
                                                        if (studentID != id[0]) {
                                                            var afterValidateTotalCounter;
                                                            if (averagecounterbefore != 1)
                                                                afterValidateTotalCounter = countTemp;
                                                            else {
                                                                afterValidateTotalCounter = countTemp;
                                                            }
                                                            studentIDBefore = studentID;
                                                            studentID = id[0];
                                                            if (maxTemp == 0) maxTemp = 1
                                                            totalCounter += ((afterValidateTotalCounter / maxTemp) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
                                                            var afterValidateTotalSub;
                                                            if (averagesubbefore != 1) {
                                                                afterValidateTotalSub = totalCounter;
                                                            }
                                                            else afterValidateTotalSub = totalCounter / countSub;
                                                            totalComp += afterValidateTotalSub;
                                                            if (_thisData.isProrateScore) {
                                                                var afterValidateProrate;
                                                                totalComp = 0;
                                                                _.each(prorateArray, function (compScore, keySub) {
                                                                    totalSubComp = 0;
                                                                    var subProrateCount = compScore.subCompData.length;
                                                                    var isSubProrateAverage = compScore.averageSubComp;
                                                                    _.each(compScore.subCompData, function (score, keyscore) {
                                                                        var totalProrateScore = 0;
                                                                        var afterValidateProrateCounter = 0;
                                                                        var isCounterProrateAverage = score.averageCounter;
                                                                        var counterProrateCount = score.val.length;
                                                                        _.each(score.val, function (counterScore, keyCounter) {
                                                                            totalProrateScore += counterScore.score;
                                                                        });
                                                                        if (isCounterProrateAverage != "1") {
                                                                            afterValidateProrateCounter += totalProrateScore;
                                                                        }
                                                                        else {
                                                                            afterValidateProrateCounter += totalProrateScore / counterProrateCount;
                                                                        }
                                                                        totalSubComp += (afterValidateProrateCounter * score.subWeight) / SubweightSum;
                                                                    });
                                                                    if (isSubProrateAverage != "1") {
                                                                        afterValidateProrate = totalSubComp;
                                                                    }
                                                                    else afterValidateProrate = totalSubComp / subProrateCount;
                                                                    totalComp += afterValidateProrate;
                                                                });
                                                            }
                                                            if (totalComp > 0) {
                                                                //$("input[id='" + studentIDBefore + ",total']").val((totalComp).toFixed(2));
                                                                //$("label[id='" + studentIDBefore + ",total']").html((totalComp).toFixed(2));
                                                            }
                                                            if (valueNotNullBefore) {
                                                                _.each(_thisData.SubjectScoreLegendList, function (x) {
                                                                    if (totalComp >= x.min && totalComp <= x.max) $("td[id='grade-for-" + studentIDBefore + "']").html(x.grade)
                                                                })
                                                                valueNotNullBefore = false
                                                            }
                                                            totalComp = 0;
                                                            totalCounter = 0;
                                                            countTemp = 0;
                                                            maxTemp = 0;
                                                            countCounter = 0;
                                                            countSub = 0;
                                                            countTemp = 0;
                                                            subM = "";
                                                            compM = "";
                                                            SubweightSum = 0;
                                                            prorateArray = [];
                                                        }
                                                    }
                                                    else {
                                                        studentIDBefore = id[0];
                                                        studentID = id[0];
                                                    }
                                                    var sub = id[1];
                                                    var nameAtt = e.attributes.name.value.split(",");
                                                    var comp = nameAtt[4];
                                                    /*
                                                     * If sub component already defined
                                                     */
                                                    if (subM) {
                                                        /*
                                                         * If sub component before is not the same with current sub component
                                                         * than calculate the sub component before score, than add to
                                                         * temporary total
                                                         */
                                                        if (subM != sub) {
                                                            var afterValidateTotalCounter;
                                                            if (averageCounterScore != 1)
                                                                afterValidateTotalCounter = countTemp;
                                                            else afterValidateTotalCounter = countTemp / countCounter;
                                                            if (maxTemp == 0) maxTemp = 1
                                                            totalCounter += ((afterValidateTotalCounter / maxTemp) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
                                                            /*
                                                             * If component before is not the same with current component
                                                             * than calculate the component before score, than add to
                                                             * temporary total
                                                             */
                                                            if (compM != comp) {
                                                                var afterValidateTotalSub;
                                                                if (averageSubCounterScore != 1) {
                                                                    afterValidateTotalSub = totalCounter;
                                                                }
                                                                else afterValidateTotalSub = totalCounter / countSub;
                                                                totalComp += afterValidateTotalSub;
                                                                compM = comp;
                                                                countSub = 1;
                                                                totalCounter = 0;
                                                            }
                                                            else {
                                                                countSub++;
                                                            }
                                                            if ($(e).val() != '') {
                                                                if (_thisData.isProrateScore) {
                                                                    let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                    if (temp) {
                                                                        let subTemp = temp.subCompData.find(x => x.subComp == sub);
                                                                        if (subTemp) {
                                                                            let toProrateArray =
                                                                            {
                                                                                'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                            }
                                                                                ;
                                                                            prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == sub).val.push(toProrateArray);
                                                                        }
                                                                        else {
                                                                            let toProrateArray = {
                                                                                'subComp': sub,
                                                                                'averageCounter': averageCounterScore,
                                                                                'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                'val': [
                                                                                    {
                                                                                        'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                                    }
                                                                                ]
                                                                            }
                                                                            prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                        }
                                                                    }
                                                                    else {
                                                                        let toProrateArray = {
                                                                            'comp': compM,
                                                                            'averageSubComp': averageSubCounterScore,
                                                                            'subCompData': [
                                                                                {
                                                                                    'subComp': sub,
                                                                                    'averageCounter': averageCounterScore,
                                                                                    'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                    'val': [
                                                                                        {
                                                                                            'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        };
                                                                        prorateArray.push(toProrateArray);
                                                                    }
                                                                    SubweightSum += parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val());
                                                                }
                                                            }
                                                            subM = sub;
                                                            if (parseFloat($(e).val()) < 0) {
                                                                $("select[id='opt," + id.join(",") + "']").val($(e).val());
                                                                $(e).val("");
                                                                $(e).prop("disabled", true);
                                                                countTemp = 0;
                                                            }
                                                            else {
                                                                if ($(e).val()) {
                                                                    let valueTemporary = ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val()))
                                                                    if(!isNaN(valueTemporary))
                                                                        countTemp = ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val()));
                                                                    else countTemp = 0
                                                                    $("select[id='opt," + id.join(",") + "']").prop("disabled", true);
                                                                }
                                                                else countTemp = 0;
                                                            }
                                                            if (!_thisData.isProrateScore || (_thisData.isProrateScore && $(e).val() != '')) {
                                                                maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                countCounter = 1;
                                                            }
                                                            else {
                                                                maxTemp = 0;
                                                                countCounter = 0;
                                                            }
                                                        }
                                                        /*
                                                         * else add the sub component before score to temporary total
                                                         */
                                                        else {
                                                            if (parseFloat($(e).val()) < 0) {
                                                                $("select[id='opt," + id.join(",") + "']").val($(e).val());
                                                                $(e).val("");
                                                                $(e).prop("disabled", true);
                                                            }
                                                            else {
                                                                if ($(e).val()) {
                                                                    let valueTemporary = ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val()))
                                                                    if (!isNaN(valueTemporary))
                                                                        countTemp += ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val()))
                                                                    $("select[id='opt," + id.join(",") + "']").prop("disabled", true);
                                                                }
                                                            }
                                                            if (!_thisData.isProrateScore || (_thisData.isProrateScore && $(e).val() != '')) {
                                                                if (_thisData.isProrateScore) {
                                                                    let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                    if (temp) {
                                                                        let subTemp = temp.subCompData.find(x => x.subComp == subM);
                                                                        if (subTemp) {
                                                                            let toProrateArray =
                                                                            {
                                                                                'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                            }
                                                                                ;
                                                                            prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == subM).val.push(toProrateArray);
                                                                        }
                                                                        else {
                                                                            let toProrateArray = {
                                                                                'subComp': subM,
                                                                                'averageCounter': averageCounterScore,
                                                                                'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                                'val': [
                                                                                    {
                                                                                        'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                                    }
                                                                                ]
                                                                            }
                                                                            prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                        }
                                                                    }
                                                                    else {
                                                                        let toProrateArray = {
                                                                            'comp': compM,
                                                                            'averageSubComp': averageSubCounterScore,
                                                                            'subCompData': [
                                                                                {
                                                                                    'subComp': subM,
                                                                                    'averageCounter': averageCounterScore,
                                                                                    'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                                    'val': [
                                                                                        {
                                                                                            'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        };
                                                                        prorateArray.push(toProrateArray);
                                                                    }
                                                                    if (SubweightSum < 1)
                                                                        SubweightSum = parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val());
                                                                }

                                                                if (averageCounterScore != 1)
                                                                    maxTemp += parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                else
                                                                    maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                countCounter++;
                                                            }
                                                        }

                                                    }
                                                    /*
                                                     * If sub component not yet defined, define the sub component
                                                     * and the component, then add the sub component score to
                                                     * temporary total
                                                     */
                                                    else {
                                                        subM = sub;
                                                        compM = comp;
                                                        if (!isNaN(parseFloat($(e).val())) && parseFloat($(e).val()) < 0) {
                                                            $("select[id='opt," + id.join(",") + "']").val($(e).val());
                                                            $(e).val("");
                                                            $(e).prop("disabled", true);
                                                        }
                                                        else {
                                                            if ($(e).val()) {
                                                                let valueTemporary = ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val()))
                                                                if(!isNaN(valueTemporary))
                                                                    countTemp += ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val()));
                                                                $("select[id='opt," + id.join(",") + "']").prop("disabled", true);
                                                            }
                                                        }
                                                        if (!_thisData.isProrateScore || (_thisData.isProrateScore && $(e).val() != '')) {
                                                            if (_thisData.isProrateScore) {
                                                                let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                if (temp) {
                                                                    let subTemp = temp.subCompData.find(x => x.subComp == subM);
                                                                    if (subTemp) {
                                                                        let toProrateArray =
                                                                        {
                                                                            'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                        }
                                                                            ;
                                                                        prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == subM).val.push(toProrateArray);
                                                                    }
                                                                    else {
                                                                        let toProrateArray = {
                                                                            'subComp': subM,
                                                                            'averageCounter': averageCounterScore,
                                                                            'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                            'val': [
                                                                                {
                                                                                    'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                                }
                                                                            ]
                                                                        }
                                                                        prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                    }
                                                                }
                                                                else {
                                                                    let toProrateArray = {
                                                                        'comp': compM,
                                                                        'averageSubComp': averageSubCounterScore,
                                                                        'subCompData': [
                                                                            {
                                                                                'subComp': subM,
                                                                                'averageCounter': averageCounterScore,
                                                                                'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                                'val': [
                                                                                    {
                                                                                        'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    };
                                                                    prorateArray.push(toProrateArray);
                                                                }
                                                                SubweightSum = parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val());
                                                            }
                                                            if (averageCounterScore != 1)
                                                                maxTemp += parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                            else
                                                                maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                            countCounter++;
                                                            countSub++;
                                                        }
                                                    }
                                                    /*
                                                     * If current index is the last index of entire table body or score
                                                     */
                                                    if (key == $(".input_score").length - 1) {
                                                        var afterValidateTotalCounter;
                                                        if (averageCounterScore != 1)
                                                            afterValidateTotalCounter = countTemp;
                                                        else afterValidateTotalCounter = countTemp / countCounter;
                                                        totalCounter += ((afterValidateTotalCounter / maxTemp) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
                                                        var afterValidateTotalSub;
                                                        if (averageSubCounterScore != 1) {
                                                            afterValidateTotalSub = totalCounter;
                                                        }
                                                        else afterValidateTotalSub = totalCounter / countSub;
                                                        totalComp += afterValidateTotalSub;
                                                        if (_thisData.isProrateScore) {
                                                            var afterValidateProrate;
                                                            totalComp = 0;
                                                            _.each(prorateArray, function (compScore, keySub) {
                                                                totalSubComp = 0;
                                                                var subProrateCount = compScore.subCompData.length;
                                                                var isSubProrateAverage = compScore.averageSubComp;
                                                                _.each(compScore.subCompData, function (score, keyscore) {
                                                                    var totalProrateScore = 0;
                                                                    var afterValidateProrateCounter = 0;
                                                                    var isCounterProrateAverage = score.averageCounter;
                                                                    var counterProrateCount = score.val.length;
                                                                    _.each(score.val, function (counterScore, keyCounter) {
                                                                        totalProrateScore += counterScore.score;
                                                                    });
                                                                    if (isCounterProrateAverage != "1") {
                                                                        afterValidateProrateCounter += totalProrateScore;
                                                                    }
                                                                    else {
                                                                        afterValidateProrateCounter += totalProrateScore / counterProrateCount;
                                                                    }
                                                                    totalSubComp += (afterValidateProrateCounter * score.subWeight) / SubweightSum;
                                                                });
                                                                if (isSubProrateAverage != "1") {
                                                                    afterValidateProrate = totalSubComp;
                                                                }
                                                                else afterValidateProrate = totalSubComp / subProrateCount;
                                                                totalComp += afterValidateProrate;
                                                            });
                                                        }
                                                        if (totalComp > 0) {
                                                            //$("input[id='" + studentID + ",total']").val((totalComp).toFixed(2));
                                                            //$("label[id='" + studentID + ",total']").html((totalComp).toFixed(2));
                                                        }
                                                        if (valueNotNullBefore)
                                                        _.each(_thisData.SubjectScoreLegendList, function (x) {
                                                            if (totalComp >= x.min && totalComp <= x.max) $("td[id='grade-for-" + studentID + "']").html(x.grade)
                                                        })
                                                    }
                                                }

                                                //Radio
                                                if (e.type == "radio") {
                                                    if (setPeriod != 1 && inPeriod != 1) {
                                                        $(e).prop('disabled', true)
                                                        $("select[id='opt," + id.join(",") + "']").prop("disabled", true);
                                                    }
                                                    isNotEntry++;
                                                    var scoreValue = $("input[class='hid," + id[0] + "," + id[1] + "," + id[2] + ",value']").val();
                                                    if (scoreValue) valueNotNullBefore = true
                                                    if (studentID) {
                                                        if (studentID != id[0]) {
                                                            studentIDBefore = studentID;
                                                            studentID = id[0];
                                                            var afterValidateTotalCounter;
                                                            if (averagecounterbefore != 1)
                                                                afterValidateTotalCounter = countTemp;
                                                            else afterValidateTotalCounter = countTemp / countCounter;
                                                            if (maxTemp == 0) maxTemp = 1
                                                            totalCounter += ((afterValidateTotalCounter / parseFloat(maxTemp)) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
                                                            var afterValidateTotalSub;
                                                            if (averagesubbefore != 1) {
                                                                afterValidateTotalSub = totalCounter;
                                                            }
                                                            else afterValidateTotalSub = totalCounter / countSub;
                                                            totalComp += afterValidateTotalSub;
                                                            if (_thisData.isProrateScore) {
                                                                var afterValidateProrate;
                                                                totalComp = 0;
                                                                _.each(prorateArray, function (compScore, keySub) {
                                                                    totalSubComp = 0;
                                                                    var subProrateCount = compScore.subCompData.length;
                                                                    var isSubProrateAverage = compScore.averageSubComp;
                                                                    _.each(compScore.subCompData, function (score, keyscore) {
                                                                        var totalProrateScore = 0;
                                                                        var afterValidateProrateCounter = 0;
                                                                        var isCounterProrateAverage = score.averageCounter;
                                                                        var counterProrateCount = score.val.length;
                                                                        _.each(score.val, function (counterScore, keyCounter) {
                                                                            totalProrateScore += counterScore.score;
                                                                        });
                                                                        if (isCounterProrateAverage != "1") {
                                                                            afterValidateProrateCounter += totalProrateScore;
                                                                        }
                                                                        else {
                                                                            afterValidateProrateCounter += totalProrateScore / counterProrateCount;
                                                                        }
                                                                        totalSubComp += (afterValidateProrateCounter * score.subWeight) / SubweightSum;
                                                                    });
                                                                    if (isSubProrateAverage != "1") {
                                                                        afterValidateProrate = totalSubComp;
                                                                    }
                                                                    else afterValidateProrate = totalSubComp / subProrateCount;
                                                                    totalComp += afterValidateProrate;
                                                                });
                                                            }
                                                            if (totalComp > 0) {
                                                                //$("input[id='" + studentIDBefore + ",total']").val((totalComp).toFixed(2));
                                                                //$("label[id='" + studentIDBefore + ",total']").html((totalComp).toFixed(2));
                                                            }
                                                            if (valueNotNullBefore) {
                                                                _.each(_thisData.SubjectScoreLegendList, function (x) {
                                                                    if (totalComp >= x.min && totalComp <= x.max) $("td[id='grade-for-" + studentIDBefore + "']").html(x.grade)
                                                                })
                                                                valueNotNullBefore = false
                                                            }
                                                            totalComp = 0;
                                                            totalCounter = 0;
                                                            countTemp = 0;
                                                            countSub = 0;
                                                            maxTemp = 0;
                                                            countCounter = 0;
                                                            subM = "";
                                                            compM = "";
                                                        }
                                                    }
                                                    else {
                                                        studentIDBefore = id[0];
                                                        studentID = id[0];
                                                    }
                                                    /*
                                                     * If radiotemp is already defined and radio button before
                                                     * is not on the same group with current radio button
                                                     */
                                                    if (radioTemp && $(e).attr('name') != radioTemp) {
                                                        var sub = id[1];
                                                        var nameAtt = e.attributes.name.value.split(",");
                                                        var comp = nameAtt[4];
                                                        if (scoreValue && parseFloat(scoreValue) >= 0) {
                                                            if (parseFloat(scoreValue) > parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) scoreValue = (parseFloat(scoreValue) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val());
                                                            $("input[name='" + e.attributes.name.value + "']").each(function (key, radionya) {
                                                                if ($(radionya).attr("value") == scoreValue) {
                                                                    $(radionya).prop("checked", true);
                                                                    $(radionya).attr("previousValue", scoreValue);
                                                                }
                                                            });
                                                            $("input[name='" + e.attributes.name.value + "']").attr("previousValue", scoreValue);
                                                            $("select[id='opt," + id.join(",") + "']").prop("disabled", true);
                                                        }
                                                        else if (scoreValue && parseFloat(scoreValue) < 0) {
                                                            $("select[id='opt," + id.join(",") + "']").val(scoreValue);
                                                            $("input[name='" + e.attributes.name.value + "']").prop('disabled', true);
                                                        }
                                                        radioTemp = $(e).attr('name');
                                                        /*
                                                         * If sub component already defined
                                                         */
                                                        if (subM) {
                                                            /*
                                                             * If sub component before is not the same with current sub component
                                                             * than calculate the sub component before score, than add to
                                                             * temporary total
                                                             */
                                                            if (subM != sub) {
                                                                var afterValidateTotalCounter;
                                                                if (averageCounterScore != 1)
                                                                    afterValidateTotalCounter = countTemp;
                                                                else afterValidateTotalCounter = countTemp / countCounter;
                                                                if (maxTemp == 0) maxTemp = 1
                                                                totalCounter += ((afterValidateTotalCounter / parseFloat(maxTemp)) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
                                                                /*
                                                                 * If component before is not the same with current component
                                                                 * than calculate the component before score, than add to
                                                                 * temporary total
                                                                 */
                                                                if (compM != comp) {
                                                                    var afterValidateTotalSub;
                                                                    if (averageSubCounterScore != 1) {
                                                                        afterValidateTotalSub = totalCounter;
                                                                    }
                                                                    else afterValidateTotalSub = totalCounter / countSub;
                                                                    totalComp += afterValidateTotalSub;
                                                                    compM = comp;
                                                                    countSub = 1;
                                                                    totalCounter = 0;
                                                                }
                                                                else {
                                                                    countSub++;
                                                                }
                                                                if (scoreValue) {
                                                                    if (_thisData.isProrateScore) {
                                                                        let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                        if (temp) {
                                                                            let subTemp = temp.subCompData.find(x => x.subComp == sub);
                                                                            if (subTemp) {
                                                                                let toProrateArray =
                                                                                {
                                                                                    'score': (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())
                                                                                }
                                                                                    ;
                                                                                prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == sub).val.push(toProrateArray);
                                                                            }
                                                                            else {
                                                                                let toProrateArray = {
                                                                                    'subComp': sub,
                                                                                    'averageCounter': averageCounterScore,
                                                                                    'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                    'val': [
                                                                                        {
                                                                                            'score': (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())
                                                                                        }
                                                                                    ]
                                                                                }
                                                                                prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                            }
                                                                        }
                                                                        else {
                                                                            let toProrateArray = {
                                                                                'comp': compM,
                                                                                'averageSubComp': averageSubCounterScore,
                                                                                'subCompData': [
                                                                                    {
                                                                                        'subComp': sub,
                                                                                        'averageCounter': averageCounterScore,
                                                                                        'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                        'val': [
                                                                                            {
                                                                                                'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            };
                                                                            prorateArray.push(toProrateArray);
                                                                        }

                                                                        SubweightSum += parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val());
                                                                    }
                                                                }
                                                                subM = sub;
                                                                if (scoreValue && parseFloat(scoreValue) < 0) {
                                                                    countTemp = 0;
                                                                }
                                                                else {
                                                                    let valueTemporary = (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                                    if (!isNaN(valueTemporary)) {
                                                                        if (scoreValue) countTemp = (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                        else countTemp = 0;
                                                                    }
                                                                    else countTemp = 0
                                                                }
                                                                if (!_thisData.isProrateScore || (_thisData.isProrateScore && scoreValue)) {
                                                                    maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                    countCounter = 1;
                                                                }
                                                                else {
                                                                    maxTemp = 0;
                                                                    countCounter = 0;
                                                                }
                                                            }
                                                            else {
                                                                if (scoreValue && parseFloat(scoreValue) > 0) countTemp += (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                if (!_thisData.isProrateScore || (_thisData.isProrateScore && scoreValue)) {
                                                                    if (_thisData.isProrateScore) {
                                                                        let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                        if (temp) {
                                                                            let subTemp = temp.subCompData.find(x => x.subComp == sub);
                                                                            if (subTemp) {
                                                                                let toProrateArray =
                                                                                {
                                                                                    'score': (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())
                                                                                }
                                                                                    ;
                                                                                prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == sub).val.push(toProrateArray);
                                                                            }
                                                                            else {
                                                                                let toProrateArray = {
                                                                                    'subComp': sub,
                                                                                    'averageCounter': averageCounterScore,
                                                                                    'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                    'val': [
                                                                                        {
                                                                                            'score': (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())
                                                                                        }
                                                                                    ]
                                                                                }
                                                                                prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                            }
                                                                        }
                                                                        else {
                                                                            let toProrateArray = {
                                                                                'comp': compM,
                                                                                'averageSubComp': averageSubCounterScore,
                                                                                'subCompData': [
                                                                                    {
                                                                                        'subComp': sub,
                                                                                        'averageCounter': averageCounterScore,
                                                                                        'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                        'val': [
                                                                                            {
                                                                                                'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            };
                                                                            prorateArray.push(toProrateArray);
                                                                        }
                                                                        if (SubweightSum < 1)
                                                                            SubweightSum = parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val());
                                                                    }

                                                                    if (averageCounterScore != 1)
                                                                        maxTemp += parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                    else
                                                                        maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                    countCounter++;
                                                                }
                                                            }
                                                        }
                                                        else {
                                                            compM = comp;
                                                            subM = sub;
                                                            let valueTemporary = (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                            if(!isNaN(valueTemporary))
                                                            if (scoreValue && parseFloat(scoreValue) > 0) countTemp += (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                            if (!_thisData.isProrateScore || (_thisData.isProrateScore && scoreValue)) {
                                                                if (_thisData.isProrateScore) {
                                                                    let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                    if (temp) {
                                                                        let subTemp = temp.subCompData.find(x => x.subComp == subM);
                                                                        if (subTemp) {
                                                                            let toProrateArray =
                                                                            {
                                                                                'score': (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                                            }
                                                                                ;
                                                                            prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == subM).val.push(toProrateArray);
                                                                        }
                                                                        else {
                                                                            let toProrateArray = {
                                                                                'subComp': subM,
                                                                                'averageCounter': averageCounterScore,
                                                                                'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                                'val': [
                                                                                    {
                                                                                        'score': (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                                                    }
                                                                                ]
                                                                            }
                                                                            prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                        }
                                                                    }
                                                                    else {
                                                                        let toProrateArray = {
                                                                            'comp': compM,
                                                                            'averageSubComp': averageSubCounterScore,
                                                                            'subCompData': [
                                                                                {
                                                                                    'subComp': subM,
                                                                                    'averageCounter': averageCounterScore,
                                                                                    'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                                    'val': [
                                                                                        {
                                                                                            'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        };
                                                                        prorateArray.push(toProrateArray);
                                                                    }
                                                                    SubweightSum = parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val());
                                                                }
                                                                if (averageCounterScore != 1)
                                                                    maxTemp += parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                else
                                                                    maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                countCounter++;
                                                                countSub++;
                                                            }
                                                        }
                                                    }
                                                    /*
                                                     * if radiotemp is not defined
                                                     */
                                                    if (!radioTemp) {
                                                        var sub = id[1];
                                                        var nameAtt = e.attributes.name.value.split(",");
                                                        var comp = nameAtt[4];
                                                        radioTemp = $(e).attr('name');
                                                        if (scoreValue && parseFloat(scoreValue) >= 0) {
                                                            if (parseFloat(scoreValue) > parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) scoreValue = (parseFloat(scoreValue) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val());
                                                            $("input[name='" + e.attributes.name.value + "']").each(function (key, radionya) {
                                                                if ($(radionya).attr("value") == scoreValue) {
                                                                    $(radionya).prop("checked", true);
                                                                    $(radionya).attr("previousValue", scoreValue);
                                                                }
                                                            });
                                                            $("input[name='" + e.attributes.name.value + "']").attr("previousValue", scoreValue);
                                                            $("select[id='opt," + id.join(",") + "']").prop("disabled", true);
                                                        }
                                                        else if (scoreValue && parseFloat(scoreValue) < 0) {
                                                            $("select[id='opt," + id.join(",") + "']").val(scoreValue);
                                                            $("input[name='" + e.attributes.name.value + "']").prop('disabled', true);
                                                        }
                                                        radioTemp = $(e).attr('name');
                                                        if (subM) {
                                                            if (subM != sub) {
                                                                var afterValidateTotalCounter;
                                                                if (averageCounterScore != 1)
                                                                    afterValidateTotalCounter = countTemp;
                                                                else afterValidateTotalCounter = countTemp / countCounter;
                                                                if (maxTemp == 0) maxTemp = 1
                                                                totalCounter += ((afterValidateTotalCounter / parseFloat(maxTemp)) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
                                                                if (compM != comp) {
                                                                    var afterValidateTotalSub;
                                                                    if (averageSubCounterScore != 1) {
                                                                        afterValidateTotalSub = totalCounter;
                                                                    }
                                                                    else afterValidateTotalSub = totalCounter / countSub;
                                                                    totalComp += afterValidateTotalSub;
                                                                    compM = comp;
                                                                    countSub = 1;
                                                                    totalCounter = 0;
                                                                }
                                                                else {
                                                                    countSub++;
                                                                }
                                                                if (scoreValue) {
                                                                    if (_thisData.isProrateScore) {
                                                                        let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                        if (temp) {
                                                                            let subTemp = temp.subCompData.find(x => x.subComp == sub);
                                                                            if (subTemp) {
                                                                                let toProrateArray =
                                                                                {
                                                                                    'score': (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())
                                                                                }
                                                                                    ;
                                                                                prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == sub).val.push(toProrateArray);
                                                                            }
                                                                            else {
                                                                                let toProrateArray = {
                                                                                    'subComp': sub,
                                                                                    'averageCounter': averageCounterScore,
                                                                                    'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                    'val': [
                                                                                        {
                                                                                            'score': (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())
                                                                                        }
                                                                                    ]
                                                                                }
                                                                                prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                            }
                                                                        }
                                                                        else {
                                                                            let toProrateArray = {
                                                                                'comp': compM,
                                                                                'averageSubComp': averageSubCounterScore,
                                                                                'subCompData': [
                                                                                    {
                                                                                        'subComp': sub,
                                                                                        'averageCounter': averageCounterScore,
                                                                                        'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                        'val': [
                                                                                            {
                                                                                                'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            };
                                                                            prorateArray.push(toProrateArray);
                                                                        }
                                                                        SubweightSum += parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val());
                                                                    }
                                                                }
                                                                subM = sub;
                                                                if (scoreValue && parseFloat(scoreValue) < 0) {
                                                                    countTemp = 0;
                                                                }
                                                                else {
                                                                    let valueTemporary = (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                                    if (!isNaN(valueTemporary)) {
                                                                        if (scoreValue) countTemp = (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                        else countTemp = 0;
                                                                    }
                                                                    else countTemp = 0
                                                                }
                                                                if (!_thisData.isProrateScore || (_thisData.isProrateScore && scoreValue)) {
                                                                    maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                    countCounter = 1;
                                                                }
                                                                else {
                                                                    maxTemp = 0;
                                                                    countCounter = 0;
                                                                }
                                                            }
                                                            else {
                                                                let valueTemporary = (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                                if(!isNaN(valueTemporary))
                                                                    if (scoreValue && parseFloat(scoreValue) > 0) countTemp += (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                if (!_thisData.isProrateScore || (_thisData.isProrateScore && scoreValue)) {
                                                                    if (_thisData.isProrateScore) {
                                                                        let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                        if (temp) {
                                                                            let subTemp = temp.subCompData.find(x => x.subComp == sub);
                                                                            if (subTemp) {
                                                                                let toProrateArray =
                                                                                {
                                                                                    'score': (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())
                                                                                }
                                                                                    ;
                                                                                prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == sub).val.push(toProrateArray);
                                                                            }
                                                                            else {
                                                                                let toProrateArray = {
                                                                                    'subComp': sub,
                                                                                    'averageCounter': averageCounterScore,
                                                                                    'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                    'val': [
                                                                                        {
                                                                                            'score': (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())
                                                                                        }
                                                                                    ]
                                                                                }
                                                                                prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                            }
                                                                        }
                                                                        else {
                                                                            let toProrateArray = {
                                                                                'comp': compM,
                                                                                'averageSubComp': averageSubCounterScore,
                                                                                'subCompData': [
                                                                                    {
                                                                                        'subComp': sub,
                                                                                        'averageCounter': averageCounterScore,
                                                                                        'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                        'val': [
                                                                                            {
                                                                                                'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            };
                                                                            prorateArray.push(toProrateArray);
                                                                        }
                                                                        if (SubweightSum < 1)
                                                                            SubweightSum = parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val());
                                                                    }

                                                                    if (averageCounterScore != 1)
                                                                        maxTemp += parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                    else
                                                                        maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                    countCounter++;
                                                                }
                                                            }
                                                        }
                                                        else {
                                                            subM = sub;
                                                            let valueTemporary = (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                            if(!isNaN(valueTemporary))
                                                                if (scoreValue && parseFloat(scoreValue) > 0) countTemp += (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                            if (!_thisData.isProrateScore || (_thisData.isProrateScore && scoreValue)) {
                                                                if (_thisData.isProrateScore) {
                                                                    let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                    if (temp) {
                                                                        let subTemp = temp.subCompData.find(x => x.subComp == subM);
                                                                        if (subTemp) {
                                                                            let toProrateArray =
                                                                            {
                                                                                'score': (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                                            }
                                                                                ;
                                                                            prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == subM).val.push(toProrateArray);
                                                                        }
                                                                        else {
                                                                            let toProrateArray = {
                                                                                'subComp': subM,
                                                                                'averageCounter': averageCounterScore,
                                                                                'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                                'val': [
                                                                                    {
                                                                                        'score': (parseFloat(scoreValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                                                    }
                                                                                ]
                                                                            }
                                                                            prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                        }
                                                                    }
                                                                    else {
                                                                        let toProrateArray = {
                                                                            'comp': compM,
                                                                            'averageSubComp': averageSubCounterScore,
                                                                            'subCompData': [
                                                                                {
                                                                                    'subComp': subM,
                                                                                    'averageCounter': averageCounterScore,
                                                                                    'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                                    'val': [
                                                                                        {
                                                                                            'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        };
                                                                        prorateArray.push(toProrateArray);
                                                                    }
                                                                    SubweightSum = parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val());
                                                                }
                                                                if (averageCounterScore != 1)
                                                                    maxTemp += parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                else
                                                                    maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                countCounter++;
                                                                countSub++;
                                                            }
                                                        }
                                                    }
                                                    /*
                                                     * If current index is the last index of entire table body or score
                                                     */
                                                    if (key == $(".input_score").length - 1) {
                                                        var afterValidateTotalCounter;
                                                        if (averageCounterScore != 1)
                                                            afterValidateTotalCounter = countTemp;
                                                        else afterValidateTotalCounter = countTemp / countCounter;
                                                        if (maxTemp == 0) maxTemp = 1
                                                        totalCounter += ((afterValidateTotalCounter / parseFloat(maxTemp)) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
                                                        var afterValidateTotalSub;
                                                        if (averageSubCounterScore != 1) {
                                                            afterValidateTotalSub = totalCounter;
                                                        }
                                                        else afterValidateTotalSub = totalCounter / countSub;
                                                        totalComp += afterValidateTotalSub;
                                                        if (_thisData.isProrateScore) {
                                                            var afterValidateProrate;
                                                            totalComp = 0;
                                                            _.each(prorateArray, function (compScore, keySub) {
                                                                totalSubComp = 0;
                                                                var subProrateCount = compScore.subCompData.length;
                                                                var isSubProrateAverage = compScore.averageSubComp;
                                                                _.each(compScore.subCompData, function (score, keyscore) {
                                                                    var totalProrateScore = 0;
                                                                    var afterValidateProrateCounter = 0;
                                                                    var isCounterProrateAverage = score.averageCounter;
                                                                    var counterProrateCount = score.val.length;
                                                                    _.each(score.val, function (counterScore, keyCounter) {
                                                                        totalProrateScore += counterScore.score;
                                                                    });
                                                                    if (isCounterProrateAverage != "1") {
                                                                        afterValidateProrateCounter += totalProrateScore;
                                                                    }
                                                                    else {
                                                                        afterValidateProrateCounter += totalProrateScore / counterProrateCount;
                                                                    }
                                                                    totalSubComp += (afterValidateProrateCounter * score.subWeight) / SubweightSum;
                                                                });
                                                                if (isSubProrateAverage != "1") {
                                                                    afterValidateProrate = totalSubComp;
                                                                }
                                                                else afterValidateProrate = totalSubComp / subProrateCount;
                                                                totalComp += afterValidateProrate;
                                                            });
                                                        }
                                                        if (totalComp > 0) {
                                                            //$("input[id='" + studentID + ",total']").val((totalComp).toFixed(2));
                                                            //$("label[id='" + studentID + ",total']").html((totalComp).toFixed(2));
                                                        }
                                                        if (valueNotNullBefore)
                                                        _.each(_thisData.SubjectScoreLegendList, function (x) {
                                                            if (totalComp >= x.min && totalComp <= x.max) $("td[id='grade-for-" + studentID + "']").html(x.grade)
                                                        })
                                                    }
                                                    $(e).on('change', function () {
                                                        changeRadioButton(e);
                                                    });
                                                    $(e).on('click', function () {
                                                        clickRadioButton(e);
                                                    });
                                                }

                                                //Option
                                                if (e.type == "select-one") {
                                                    if (setPeriod != 1 && inPeriod != 1) {
                                                        $(e).prop('disabled', true)
                                                        $("select[id='opt," + id.join(",") + "']").prop("disabled", true);
                                                    }
                                                    isNotEntry++;
                                                    var optionValue = $(e).attr("value");
                                                    var sub = id[1];
                                                    var nameAtt = e.attributes.name.value.split(",");
                                                    var comp = nameAtt[4];
                                                    if (parseFloat(optionValue) > parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) optionValue = (parseFloat(optionValue) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val());
                                                    $(e).val(optionValue);
                                                    if ($(e).val() != '') valueNotNullBefore = true
                                                    if (studentID) {
                                                        if (studentID != id[0]) {
                                                            studentIDBefore = studentID;
                                                            studentID = id[0];
                                                            var afterValidateTotalCounter;
                                                            if (averagecounterbefore != 1)
                                                                afterValidateTotalCounter = countTemp;
                                                            else afterValidateTotalCounter = countTemp / countCounter;
                                                            if (maxTemp == 0) maxTemp = 1
                                                            totalCounter += ((afterValidateTotalCounter / parseFloat(maxTemp)) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
                                                            var afterValidateTotalSub;
                                                            if (averagesubbefore != 1) {
                                                                afterValidateTotalSub = totalCounter;
                                                            }
                                                            else afterValidateTotalSub = totalCounter / countSub;
                                                            totalComp += afterValidateTotalSub;
                                                            countSub = 0;
                                                            if (_thisData.isProrateScore) {
                                                                var afterValidateProrate;
                                                                totalComp = 0;
                                                                _.each(prorateArray, function (compScore, keySub) {
                                                                    totalSubComp = 0;
                                                                    var subProrateCount = compScore.subCompData.length;
                                                                    var isSubProrateAverage = compScore.averageSubComp;
                                                                    _.each(compScore.subCompData, function (score, keyscore) {
                                                                        var totalProrateScore = 0;
                                                                        var afterValidateProrateCounter = 0;
                                                                        var isCounterProrateAverage = score.averageCounter;
                                                                        var counterProrateCount = score.val.length;
                                                                        _.each(score.val, function (counterScore, keyCounter) {
                                                                            totalProrateScore += counterScore.score;
                                                                        });
                                                                        if (isCounterProrateAverage != "1") {
                                                                            afterValidateProrateCounter += totalProrateScore;
                                                                        }
                                                                        else {
                                                                            afterValidateProrateCounter += totalProrateScore / counterProrateCount;
                                                                        }
                                                                        totalSubComp += (afterValidateProrateCounter * score.subWeight) / SubweightSum;
                                                                    });
                                                                    if (isSubProrateAverage != "1") {
                                                                        afterValidateProrate = totalSubComp;
                                                                    }
                                                                    else afterValidateProrate = totalSubComp / subProrateCount;
                                                                    totalComp += afterValidateProrate;
                                                                });
                                                            }
                                                            if (totalComp > 0) {
                                                                //$("input[id='" + studentIDBefore + ",total']").val((totalComp).toFixed(2));
                                                                //$("label[id='" + studentIDBefore + ",total']").html((totalComp).toFixed(2));
                                                            }
                                                            if (valueNotNullBefore) {
                                                                _.each(_thisData.SubjectScoreLegendList, function (x) {
                                                                    if (totalComp >= x.min && totalComp <= x.max) $("td[id='grade-for-" + studentIDBefore + "']").html(x.grade)
                                                                })
                                                                valueNotNullBefore = false
                                                            }
                                                            totalComp = 0;
                                                            totalCounter = 0;
                                                            countTemp = 0;
                                                            countCounter = 0;
                                                            maxTemp = 0;
                                                            subM = "";
                                                            compM = "";
                                                        }
                                                    }
                                                    else {
                                                        studentIDBefore = id[0];
                                                        studentID = id[0];
                                                    }
                                                    /*
                                                     * If sub component already defined
                                                     */
                                                    if (subM) {
                                                        /*
                                                         * If sub component before is not the same with current sub component
                                                         * than calculate the sub component before score, than add to
                                                         * temporary total
                                                         */
                                                        if (subM != sub) {
                                                            var afterValidateTotalCounter;
                                                            if (averageCounterScore != 1)
                                                                afterValidateTotalCounter = countTemp;
                                                            else afterValidateTotalCounter = countTemp / countCounter;
                                                            if (maxTemp == 0) maxTemp = 1
                                                            totalCounter += ((afterValidateTotalCounter / parseFloat(maxTemp)) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
                                                            /*
                                                             * If component before is not the same with current component
                                                             * than calculate the component before score, than add to
                                                             * temporary total
                                                             */
                                                            if (compM != comp) {
                                                                var afterValidateTotalSub;
                                                                if (averageSubCounterScore != 1) {
                                                                    afterValidateTotalSub = totalCounter;
                                                                }
                                                                else afterValidateTotalSub = totalCounter / countSub;
                                                                totalComp += afterValidateTotalSub;
                                                                compM = comp;
                                                                countSub = 1;
                                                                totalCounter = 0;
                                                            }
                                                            else {
                                                                countSub++;
                                                            }
                                                            if ($(e).val() && parseFloat($(e).val()) > 0) {
                                                                if (_thisData.isProrateScore) {
                                                                    let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                    if (temp) {
                                                                        let subTemp = temp.subCompData.find(x => x.subComp == sub);
                                                                        if (subTemp) {
                                                                            let toProrateArray =
                                                                            {
                                                                                'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                            }
                                                                                ;
                                                                            prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == sub).val.push(toProrateArray);
                                                                        }
                                                                        else {
                                                                            let toProrateArray = {
                                                                                'subComp': sub,
                                                                                'averageCounter': averageCounterScore,
                                                                                'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                'val': [
                                                                                    {
                                                                                        'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                                    }
                                                                                ]
                                                                            }
                                                                            prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                        }
                                                                    }
                                                                    else {
                                                                        let toProrateArray = {
                                                                            'comp': compM,
                                                                            'averageSubComp': averageSubCounterScore,
                                                                            'subCompData': [
                                                                                {
                                                                                    'subComp': sub,
                                                                                    'averageCounter': averageCounterScore,
                                                                                    'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                    'val': [
                                                                                        {
                                                                                            'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        };
                                                                        prorateArray.push(toProrateArray);
                                                                    }
                                                                    SubweightSum += parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val());
                                                                }
                                                            }
                                                            subM = sub;
                                                            let valueTemporary = (parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                            if(!isNaN(valueTemporary))
                                                                if ($(e).val() && parseFloat($(e).val()) > 0) countTemp = (parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                            else countTemp = 0;
                                                            if (!_thisData.isProrateScore || (_thisData.isProrateScore && $(e).val() && parseFloat($(e).val()) > 0)) {
                                                                maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                countCounter = 1;
                                                            }
                                                            else {
                                                                maxTemp = 0;
                                                                countCounter = 0;
                                                            }
                                                        }
                                                        /*
                                                         * else add the sub component before score to temporary total
                                                         */
                                                        else {
                                                            let valueTemporary = (parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                            if(!isNaN(valueTemporary))
                                                            if ($(e).val() && parseFloat($(e).val()) > 0) countTemp += (parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                            if (!_thisData.isProrateScore || (_thisData.isProrateScore && $(e).val() && parseFloat($(e).val()) > 0)) {
                                                                if (_thisData.isProrateScore) {
                                                                    let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                    if (temp) {
                                                                        let subTemp = temp.subCompData.find(x => x.subComp == subM);
                                                                        if (subTemp) {
                                                                            let toProrateArray =
                                                                            {
                                                                                'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                            }
                                                                                ;
                                                                            prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == subM).val.push(toProrateArray);
                                                                        }
                                                                        else {
                                                                            let toProrateArray = {
                                                                                'subComp': subM,
                                                                                'averageCounter': averageCounterScore,
                                                                                'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                                'val': [
                                                                                    {
                                                                                        'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                                    }
                                                                                ]
                                                                            }
                                                                            prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                        }
                                                                    }
                                                                    else {
                                                                        let toProrateArray = {
                                                                            'comp': compM,
                                                                            'averageSubComp': averageSubCounterScore,
                                                                            'subCompData': [
                                                                                {
                                                                                    'subComp': subM,
                                                                                    'averageCounter': averageCounterScore,
                                                                                    'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                                    'val': [
                                                                                        {
                                                                                            'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        };
                                                                        prorateArray.push(toProrateArray);
                                                                    }
                                                                    if (SubweightSum < 1)
                                                                        SubweightSum = parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val());
                                                                }

                                                                if (averageCounterScore != 1)
                                                                    maxTemp += parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                else
                                                                    maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                countCounter++;
                                                            }
                                                        }
                                                    }
                                                    /*
                                                     * If sub component not yet defined, define the sub component
                                                     * and the component, then add the sub component score to
                                                     * temporary total
                                                     */
                                                    else {
                                                        compM = comp;
                                                        subM = sub;
                                                        let valueTemporary = (parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                        if (!isNaN(valueTemporary))
                                                        if ($(e).val() && parseFloat($(e).val()) > 0) countTemp += (parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                        if (!_thisData.isProrateScore || (_thisData.isProrateScore && $(e).val() && parseFloat($(e).val()) > 0)) {
                                                            if (_thisData.isProrateScore) {
                                                                let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                if (temp) {
                                                                    let subTemp = temp.subCompData.find(x => x.subComp == subM);
                                                                    if (subTemp) {
                                                                        let toProrateArray =
                                                                        {
                                                                            'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                        }
                                                                            ;
                                                                        prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == subM).val.push(toProrateArray);
                                                                    }
                                                                    else {
                                                                        let toProrateArray = {
                                                                            'subComp': subM,
                                                                            'averageCounter': averageCounterScore,
                                                                            'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                            'val': [
                                                                                {
                                                                                    'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                                }
                                                                            ]
                                                                        }
                                                                        prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                    }
                                                                }
                                                                else {
                                                                    let toProrateArray = {
                                                                        'comp': compM,
                                                                        'averageSubComp': averageSubCounterScore,
                                                                        'subCompData': [
                                                                            {
                                                                                'subComp': subM,
                                                                                'averageCounter': averageCounterScore,
                                                                                'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                                'val': [
                                                                                    {
                                                                                        'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    };
                                                                    prorateArray.push(toProrateArray);
                                                                }
                                                                SubweightSum = parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val());
                                                            }
                                                            if (averageCounterScore != 1)
                                                                maxTemp += parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                            else
                                                                maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                            countCounter++;
                                                            countSub++;
                                                        }
                                                    }
                                                    /*
                                                     * If current index is the last index of entire table body or score
                                                     */
                                                    if (key == $(".input_score").length - 1) {
                                                        var afterValidateTotalCounter;
                                                        if (averageCounterScore != 1)
                                                            afterValidateTotalCounter = countTemp;
                                                        else afterValidateTotalCounter = countTemp / countCounter;
                                                        if (maxTemp == 0) maxTemp = 1
                                                        totalCounter += ((afterValidateTotalCounter / parseFloat(maxTemp)) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
                                                        var afterValidateTotalSub;
                                                        if (averageSubCounterScore != 1) {
                                                            afterValidateTotalSub = totalCounter;
                                                        }
                                                        else afterValidateTotalSub = totalCounter / countSub;
                                                        totalComp += afterValidateTotalSub;
                                                        if (_thisData.isProrateScore) {
                                                            var afterValidateProrate;
                                                            totalComp = 0;
                                                            _.each(prorateArray, function (compScore, keySub) {
                                                                totalSubComp = 0;
                                                                var subProrateCount = compScore.subCompData.length;
                                                                var isSubProrateAverage = compScore.averageSubComp;
                                                                _.each(compScore.subCompData, function (score, keyscore) {
                                                                    var totalProrateScore = 0;
                                                                    var afterValidateProrateCounter = 0;
                                                                    var isCounterProrateAverage = score.averageCounter;
                                                                    var counterProrateCount = score.val.length;
                                                                    _.each(score.val, function (counterScore, keyCounter) {
                                                                        totalProrateScore += counterScore.score;
                                                                    });
                                                                    if (isCounterProrateAverage != "1") {
                                                                        afterValidateProrateCounter += totalProrateScore;
                                                                    }
                                                                    else {
                                                                        afterValidateProrateCounter += totalProrateScore / counterProrateCount;
                                                                    }
                                                                    totalSubComp += (afterValidateProrateCounter * score.subWeight) / SubweightSum;
                                                                });
                                                                if (isSubProrateAverage != "1") {
                                                                    afterValidateProrate = totalSubComp;
                                                                }
                                                                else afterValidateProrate = totalSubComp / subProrateCount;
                                                                totalComp += afterValidateProrate;
                                                            });
                                                        }
                                                        if (totalComp > 0) {
                                                            //$("input[id='" + studentID + ",total']").val((totalComp).toFixed(2));
                                                            //$("label[id='" + studentID + ",total']").val((totalComp).toFixed(2));
                                                        }
                                                        if (valueNotNullBefore)
                                                        _.each(_thisData.SubjectScoreLegendList, function (x) {
                                                            if (totalComp >= x.min && totalComp <= x.max) $("td[id='grade-for-" + studentID + "']").html(x.grade)
                                                        })
                                                    }

                                                }

                                                //TextArea
                                                if (e.type == "textarea" && $(e).val()) {
                                                    if (setPeriod != 1 && inPeriod != 1) {
                                                        $(e).prop('disabled', true)
                                                        $("select[id='opt," + id.join(",") + "']").prop("disabled", true);
                                                    }
                                                    isNotEntry++;
                                                    if (!isNaN(parseFloat($(e).val())) && parseFloat($(e).val()) < 0) {
                                                        $("select[id='opt," + id.join(",") + "']").val($(e).val());
                                                        $(e).val("");
                                                        $(e).prop("disabled", true);
                                                    }
                                                    /*
                                                     * If current index is the last index of entire table body or score
                                                     */
                                                    if (key == $(".input_score").length - 1) {
                                                        var afterValidateTotalCounter;
                                                        if (averageCounterScore != 1)
                                                            afterValidateTotalCounter = countTemp;
                                                        else afterValidateTotalCounter = countTemp / countCounter;
                                                        if (maxTemp == 0) maxTemp = 1
                                                        totalCounter += ((afterValidateTotalCounter / maxTemp) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
                                                        var afterValidateTotalSub;
                                                        if (averageSubCounterScore != 1) {
                                                            afterValidateTotalSub = totalCounter;
                                                        }
                                                        else afterValidateTotalSub = totalCounter / countSub;
                                                        totalComp += afterValidateTotalSub;
                                                        if (_thisData.isProrateScore) {
                                                            var afterValidateProrate;
                                                            totalComp = 0;
                                                            _.each(prorateArray, function (subScore, keySub) {
                                                                var totalProrateScore = 0;
                                                                var subProrateCount = subScore.val.length;
                                                                _.each(subScore.val, function (score, keyscore) {
                                                                    totalProrateScore += score.score;
                                                                });
                                                                if (averagesubbefore != 1) {
                                                                    afterValidateProrate = totalProrateScore;
                                                                }
                                                                else afterValidateProrate = totalProrateScore / subProrateCount;
                                                                totalComp += (afterValidateProrate * subScore.subWeight) / SubweightSum;
                                                            });
                                                        }
                                                        if (totalComp > 0) {
                                                            //$("input[id='" + studentID + ",total']").val((totalComp).toFixed(2));
                                                            //$("label[id='" + studentID + ",total']").html((totalComp).toFixed(2));
                                                        }
                                                        if (valueNotNullBefore)
                                                        _.each(_thisData.SubjectScoreLegendList, function (x) {
                                                            if (totalComp >= x.min && totalComp <= x.max) $("td[id='grade-for-" + studentID + "']").html(x.grade)
                                                        })
                                                    }
                                                }

                                                //AnchorTag
                                                if (e.type == "hidden") {
                                                    var sub = id[1];
                                                    var nameAtt = e.attributes.name.value.split(",");
                                                    var comp = nameAtt[4];
                                                    if ($(e).val() && parseFloat($(e).val() > parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val()))) $(e).val(parseFloat($("input[id='" + id[0] + "," + id[1] + "," + id[2] + ",submittedrawscore']").val()));
                                                    if ($(e).val() != '') valueNotNullBefore = true
                                                    if (studentID) {
                                                        if (studentID != id[0]) {
                                                            var afterValidateTotalCounter;
                                                            if (averagecounterbefore != 1)
                                                                afterValidateTotalCounter = countTemp;
                                                            else afterValidateTotalCounter = countTemp / countCounter;
                                                            studentIDBefore = studentID;
                                                            studentID = id[0];
                                                            if (maxTemp == 0) maxTemp = 1
                                                            totalCounter += ((afterValidateTotalCounter / maxTemp) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
                                                            var afterValidateTotalSub;
                                                            if (averagesubbefore != 1) {
                                                                afterValidateTotalSub = totalCounter;
                                                            }
                                                            else afterValidateTotalSub = totalCounter / countSub;
                                                            totalComp += afterValidateTotalSub;
                                                            if (_thisData.isProrateScore) {
                                                                var afterValidateProrate;
                                                                totalComp = 0;
                                                                _.each(prorateArray, function (compScore, keySub) {
                                                                    totalSubComp = 0;
                                                                    var subProrateCount = compScore.subCompData.length;
                                                                    var isSubProrateAverage = compScore.averageSubComp;
                                                                    _.each(compScore.subCompData, function (score, keyscore) {
                                                                        var totalProrateScore = 0;
                                                                        var afterValidateProrateCounter = 0;
                                                                        var isCounterProrateAverage = score.averageCounter;
                                                                        var counterProrateCount = score.val.length;
                                                                        _.each(score.val, function (counterScore, keyCounter) {
                                                                            totalProrateScore += counterScore.score;
                                                                        });
                                                                        if (isCounterProrateAverage != "1") {
                                                                            afterValidateProrateCounter += totalProrateScore;
                                                                        }
                                                                        else {
                                                                            afterValidateProrateCounter += totalProrateScore / counterProrateCount;
                                                                        }
                                                                        totalSubComp += (afterValidateProrateCounter * score.subWeight) / SubweightSum;
                                                                    });
                                                                    if (isSubProrateAverage != "1") {
                                                                        afterValidateProrate = totalSubComp;
                                                                    }
                                                                    else afterValidateProrate = totalSubComp / subProrateCount;
                                                                    totalComp += afterValidateProrate;
                                                                });
                                                            }
                                                            if (totalComp > 0) {
                                                                //$("input[id='" + studentIDBefore + ",total']").val((totalComp).toFixed(2));
                                                                //$("label[id='" + studentIDBefore + ",total']").html((totalComp).toFixed(2));
                                                            }
                                                            if (valueNotNullBefore) {
                                                                _.each(_thisData.SubjectScoreLegendList, function (x) {
                                                                    if (totalComp >= x.min && totalComp <= x.max) $("td[id='grade-for-" + studentIDBefore + "']").html(x.grade)
                                                                })
                                                                valueNotNullBefore = false
                                                            }
                                                            totalComp = 0;
                                                            totalCounter = 0;
                                                            countTemp = 0;
                                                            maxTemp = 0;
                                                            countCounter = 0;
                                                            countSub = 0;
                                                            countTemp = 0;
                                                            subM = "";
                                                            SubweightSum = 0;
                                                            compM = "";
                                                            prorateArray = [];
                                                        }
                                                    }
                                                    else {
                                                        studentIDBefore = id[0];
                                                        studentID = id[0];
                                                    }
                                                    /*
                                                     * If sub component already defined
                                                     */
                                                    if (subM) {
                                                        /*
                                                         * If sub component before is not the same with current sub component
                                                         * than calculate the sub component before score, than add to
                                                         * temporary total
                                                         */
                                                        if (subM != sub) {
                                                            var afterValidateTotalCounter;
                                                            if (averageCounterScore != 1)
                                                                afterValidateTotalCounter = countTemp;
                                                            else afterValidateTotalCounter = countTemp / countCounter;
                                                            if (maxTemp == 0) maxTemp = 1
                                                            totalCounter += ((afterValidateTotalCounter / parseFloat(maxTemp)) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
                                                            if (compM != comp) {
                                                                var afterValidateTotalSub;
                                                                if (averageSubCounterScore != 1) {
                                                                    afterValidateTotalSub = totalCounter;
                                                                }
                                                                else afterValidateTotalSub = totalCounter / countSub;
                                                                totalComp += afterValidateTotalSub;
                                                                compM = comp;
                                                                countSub = 1;
                                                                totalCounter = 0;
                                                                if ($(e).val() != '') {
                                                                    if (_thisData.isProrateScore) {
                                                                        let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                        if (temp) {
                                                                            let subTemp = temp.subCompData.find(x => x.subComp == sub);
                                                                            if (subTemp) {
                                                                                let toProrateArray =
                                                                                {
                                                                                    'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                                }
                                                                                    ;
                                                                                prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == sub).val.push(toProrateArray);
                                                                            }
                                                                            else {
                                                                                let toProrateArray = {
                                                                                    'subComp': sub,
                                                                                    'averageCounter': averageCounterScore,
                                                                                    'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                    'val': [
                                                                                        {
                                                                                            'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                                        }
                                                                                    ]
                                                                                }
                                                                                prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                            }
                                                                        }
                                                                        else {
                                                                            let toProrateArray = {
                                                                                'comp': compM,
                                                                                'averageSubComp': averageSubCounterScore,
                                                                                'subCompData': [
                                                                                    {
                                                                                        'subComp': sub,
                                                                                        'averageCounter': averageCounterScore,
                                                                                        'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                        'val': [
                                                                                            {
                                                                                                'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            };
                                                                            prorateArray.push(toProrateArray);
                                                                        }
                                                                        SubweightSum += parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val());
                                                                    }
                                                                }
                                                            }
                                                            else {
                                                                countSub++;
                                                                if ($(e).val() != '') {
                                                                    if (_thisData.isProrateScore) {
                                                                        let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                        if (temp) {
                                                                            let subTemp = temp.subCompData.find(x => x.subComp == sub);
                                                                            if (subTemp) {
                                                                                let toProrateArray =
                                                                                {
                                                                                    'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                                }
                                                                                    ;
                                                                                prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == sub).val.push(toProrateArray);
                                                                            }
                                                                            else {
                                                                                let toProrateArray = {
                                                                                    'subComp': sub,
                                                                                    'averageCounter': averageCounterScore,
                                                                                    'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                    'val': [
                                                                                        {
                                                                                            'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                                        }
                                                                                    ]
                                                                                }
                                                                                prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                            }
                                                                        }
                                                                        else {
                                                                            let toProrateArray = {
                                                                                'comp': compM,
                                                                                'averageSubComp': averageSubCounterScore,
                                                                                'subCompData': [
                                                                                    {
                                                                                        'subComp': sub,
                                                                                        'averageCounter': averageCounterScore,
                                                                                        'subWeight': parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val()),
                                                                                        'val': [
                                                                                            {
                                                                                                'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + sub + "," + id[2] + ",weight']").val())),
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            };
                                                                            prorateArray.push(toProrateArray);
                                                                        }
                                                                        SubweightSum += parseFloat($("input[class='hid," + studentID + "," + sub + ",subweight']").val());
                                                                    }
                                                                }
                                                            }
                                                            subM = sub;
                                                            if ($(e).val() && parseFloat($(e).val()) >= 0) {
                                                                var optionValue = parseFloat($(e).val());
                                                                if (parseFloat($(e).val()) > parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) {
                                                                    optionValue = (parseFloat($(e).val()) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                }
                                                                let valueTemporary = optionValue = (parseFloat($(e).val()) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                                if(!isNaN(valueTemporary))
                                                                    countTemp = (optionValue / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                else
                                                                    countTemp = 0
                                                            }
                                                            else countTemp = 0;
                                                            if (!_thisData.isProrateScore || (_thisData.isProrateScore && $(e).val() != '')) {
                                                                maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                countCounter = 1;
                                                            }
                                                            else {
                                                                maxTemp = 0;
                                                                countCounter = 0;
                                                            }
                                                        }
                                                        /*
                                                         * else add the sub component before score to temporary total
                                                         */
                                                        else {
                                                            if ($(e).val() && parseFloat($(e).val()) >= 0) {
                                                                var optionValue = parseFloat($(e).val());
                                                                if (parseFloat($(e).val()) > parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) {
                                                                    optionValue = (parseFloat($(e).val()) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                }
                                                                let valueTemporary = optionValue = (parseFloat($(e).val()) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                                if (!isNaN(valueTemporary))
                                                                countTemp += (optionValue / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                            }
                                                            if (!_thisData.isProrateScore || (_thisData.isProrateScore && $(e).val() != '')) {
                                                                if (_thisData.isProrateScore) {
                                                                    let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                    if (temp) {
                                                                        let subTemp = temp.subCompData.find(x => x.subComp == subM);
                                                                        if (subTemp) {
                                                                            let toProrateArray =
                                                                            {
                                                                                'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                            }
                                                                                ;
                                                                            prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == subM).val.push(toProrateArray);
                                                                        }
                                                                        else {
                                                                            let toProrateArray = {
                                                                                'subComp': subM,
                                                                                'averageCounter': averageCounterScore,
                                                                                'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                                'val': [
                                                                                    {
                                                                                        'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                                    }
                                                                                ]
                                                                            }
                                                                            prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                        }
                                                                    }
                                                                    else {
                                                                        let toProrateArray = {
                                                                            'comp': compM,
                                                                            'averageSubComp': averageSubCounterScore,
                                                                            'subCompData': [
                                                                                {
                                                                                    'subComp': subM,
                                                                                    'averageCounter': averageCounterScore,
                                                                                    'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                                    'val': [
                                                                                        {
                                                                                            'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        };
                                                                        prorateArray.push(toProrateArray);
                                                                    }
                                                                    if (SubweightSum < 1)
                                                                        SubweightSum = parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val());
                                                                }
                                                                if (averageCounterScore != 1)
                                                                    maxTemp += parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                else
                                                                    maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                                countCounter++;
                                                            }
                                                        }
                                                    }
                                                    /*
                                                     * If sub component not yet defined, define the sub component
                                                     * and the component, then add the sub component score to
                                                     * temporary total
                                                     */
                                                    else {
                                                        compM = comp;
                                                        subM = sub;
                                                        if ($(e).val() && parseFloat($(e).val()) >= 0) {
                                                            var optionValue = parseFloat($(e).val());
                                                            if (parseFloat($(e).val()) > parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) {
                                                                optionValue = (parseFloat($(e).val()) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                            }
                                                            let valueTemporary = optionValue = (parseFloat($(e).val()) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())
                                                            if (!isNaN(valueTemporary))
                                                                countTemp = (optionValue / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                            else countTemp = 0
                                                        }
                                                        if (!_thisData.isProrateScore || (_thisData.isProrateScore && $(e).val() != '')) {
                                                            if (_thisData.isProrateScore) {
                                                                let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                                                if (temp) {
                                                                    let subTemp = temp.subCompData.find(x => x.subComp == subM);
                                                                    if (subTemp) {
                                                                        let toProrateArray =
                                                                        {
                                                                            'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                        }
                                                                            ;
                                                                        prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == subM).val.push(toProrateArray);
                                                                    }
                                                                    else {
                                                                        let toProrateArray = {
                                                                            'subComp': subM,
                                                                            'averageCounter': averageCounterScore,
                                                                            'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                            'val': [
                                                                                {
                                                                                    'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                                }
                                                                            ]
                                                                        }
                                                                        prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                                                    }
                                                                }
                                                                else {
                                                                    let toProrateArray = {
                                                                        'comp': compM,
                                                                        'averageSubComp': averageSubCounterScore,
                                                                        'subCompData': [
                                                                            {
                                                                                'subComp': subM,
                                                                                'averageCounter': averageCounterScore,
                                                                                'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                                                'val': [
                                                                                    {
                                                                                        'score': ((parseFloat($(e).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val())),
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    };
                                                                    prorateArray.push(toProrateArray);
                                                                }
                                                                SubweightSum = parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val());
                                                            }
                                                            if (averageCounterScore != 1)
                                                                maxTemp += parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                            else
                                                                maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] + ",weight']").val());
                                                            countCounter++;
                                                            countSub++;
                                                        }
                                                    }
                                                    /*
                                                     * If current index is the last index of entire table body or score
                                                     */
                                                    if (key == $(".input_score").length - 1) {
                                                        var afterValidateTotalCounter;
                                                        if (averageCounterScore != 1)
                                                            afterValidateTotalCounter = countTemp;
                                                        else afterValidateTotalCounter = countTemp / countCounter;
                                                        if (maxTemp == 0) maxTemp = 1
                                                        totalCounter += ((afterValidateTotalCounter / maxTemp) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
                                                        var afterValidateTotalSub;
                                                        if (averageSubCounterScore != 1) {
                                                            afterValidateTotalSub = totalCounter;
                                                        }
                                                        else afterValidateTotalSub = totalCounter / countSub;
                                                        totalComp += afterValidateTotalSub;
                                                        if (_thisData.isProrateScore) {
                                                            var afterValidateProrate;
                                                            totalComp = 0;
                                                            _.each(prorateArray, function (compScore, keySub) {
                                                                totalSubComp = 0;
                                                                var subProrateCount = compScore.subCompData.length;
                                                                var isSubProrateAverage = compScore.averageSubComp;
                                                                _.each(compScore.subCompData, function (score, keyscore) {
                                                                    var totalProrateScore = 0;
                                                                    var afterValidateProrateCounter = 0;
                                                                    var isCounterProrateAverage = score.averageCounter;
                                                                    var counterProrateCount = score.val.length;
                                                                    _.each(score.val, function (counterScore, keyCounter) {
                                                                        totalProrateScore += counterScore.score;
                                                                    });
                                                                    if (isCounterProrateAverage != "1") {
                                                                        afterValidateProrateCounter += totalProrateScore;
                                                                    }
                                                                    else {
                                                                        afterValidateProrateCounter += totalProrateScore / counterProrateCount;
                                                                    }
                                                                    totalSubComp += (afterValidateProrateCounter * score.subWeight) / SubweightSum;
                                                                });
                                                                if (isSubProrateAverage != "1") {
                                                                    afterValidateProrate = totalSubComp;
                                                                }
                                                                else afterValidateProrate = totalSubComp / subProrateCount;
                                                                totalComp += afterValidateProrate;
                                                            });
                                                        }
                                                        if (totalComp > 0) {
                                                            //$("input[id='" + studentID + ",total']").val((totalComp).toFixed(2));
                                                            //$("label[id='" + studentID + ",total']").html((totalComp).toFixed(2));
                                                        }
                                                        if (valueNotNullBefore)
                                                        _.each(_thisData.SubjectScoreLegendList, function (x) {
                                                            if (totalComp >= x.min && totalComp <= x.max) $("td[id='grade-for-" + studentID + "']").html(x.grade)
                                                        })
                                                    }

                                                    //Setting popup for update or delete
                                                    if (_thisDataGlobal.inPeriod == -2) {
                                                        $("a[id='" + id[0] + "," + id[1] + "," + id[2] + ",linkscore']").addClass('btn disabled').prop('disabled', true);
                                                        $("a[id='" + id[0] + "," + id[1] + "," + id[2] + ",linkapprovalscore']").addClass('btn disabled').prop('disabled', true);
                                                    }
                                                    $("a[id='" + id[0] + "," + id[1] + "," + id[2] + ",linkscore']").on('click', function () {
                                                        event.preventDefault();
                                                        if ($(this).attr('href') && _thisDataGlobal.inPeriod != -2) {
                                                            if ($(e).val() && !isNaN($(e).val())) {
                                                                optionValue = parseFloat($("input[id='" + id[0] + "," + id[1] + "," + id[2] + ",submittedrawscore']").val());
                                                            }
                                                            var counterValue = optionValue != '' && optionValue != null ? (parseFloat($("input[id='" + id[0] + "," + id[1] + "," + id[2] + ",realScore']").val())) : '';
                                                            var codesetting = $("input[id='" + id[0] + "," + id[1] + "," + id[2] + ",codesetting']").val();
                                                            var radopt = $("input[id='" + id[0] + "," + id[1] + "," + id[2] + ",radiooption']").val();
                                                            var radobject = $("input[id='" + id[0] + "," + id[1] + "," + id[2] + ",radiooptionobject']").val();
                                                            var radiooptionlist = [];
                                                            if (radopt) {
                                                                var radiooption = radopt.split(',');
                                                                _.each(radiooption, function (opt, key) {
                                                                    var optlist = opt.split(':');
                                                                    var stringOpt = "{\"code\":\"" + optlist[0] + "\",\"value\":\"" + optlist[1] + "\"}";
                                                                    radiooptionlist.push(JSON.parse(stringOpt));
                                                                });
                                                            }
                                                            var scoreoption = $("input[id='" + id[0] + "," + id[1] + "," + id[2] + ",scoreoption']").val();
                                                            var scoretype = $(this).attr("data-scoreoption");
                                                            if (scoretype == "Radio" || scoretype == "Option") {
                                                                if (scoretype == "Radio") {
                                                                    radobject = radobject.replaceAll("\\",'"');
                                                                    radobject = JSON.parse(radobject);
                                                                    var radioVal = _.find(radobject, function (x) { return x.value == optionValue });
                                                                    if (radioVal) counterValue = radioVal.code;
                                                                }
                                                                else if (scoretype == "Option") {
                                                                    var optlistsplit = scoreoption.split('/');
                                                                    optlistsplit = optlistsplit.slice(0, optlistsplit.length - 1);
                                                                    _.each(optlistsplit, function (elmopt, keyopt) {
                                                                        var tickfirst = elmopt.substring(elmopt.search("'") + 1);
                                                                        var code = tickfirst.substring(0, tickfirst.search("'"));
                                                                        var value = tickfirst.substring(tickfirst.search("'") + 2, tickfirst.length - 1);
                                                                        if (code == optionValue) counterValue = value;
                                                                    });

                                                                }
                                                            }
                                                            if (codesetting) {
                                                                var codesetsplit = codesetting.split('/');
                                                                codesetsplit = codesetsplit.slice(0, codesetsplit.length - 1);
                                                                _.each(codesetsplit, function (elmcod, keycod) {
                                                                    var tickfirst = elmcod.substring(elmcod.search("'") + 1);
                                                                    var code = tickfirst.substring(0, tickfirst.search("'"));
                                                                    var value = tickfirst.substring(tickfirst.search("'") + 2, tickfirst.length - 1);
                                                                    if (code == optionValue) counterValue = value;
                                                                });
                                                            }
                                                            var period;
                                                            if (!setPeriod) {
                                                                if (_thisData.inPeriod == 0 || _thisData.inPeriod == false) period = -1;
                                                                else if (_thisData.inPeriod == 1) period = 1;
                                                                else period = inPeriod
                                                            }
                                                            else {
                                                                if (inPeriod == 0 || inPeriod == false || inPeriod == "") period = -1;
                                                                else if (inPeriod == 1) period = 1;
                                                                else period = inPeriod
                                                            }
                                                            var data = {
                                                                period: period,
                                                                idtransaction: $("input[class='hid," + id[0] + "," + id[1] + "," + id[2] + ",idtransaction']").val(),
                                                                idscore: $("input[class='hid," + id[0] + "," + id[1] + "," + id[2] + ",idscore']").val(),
                                                                idstudent: id[0],
                                                                component: comp,
                                                                subcomponent: id[1],
                                                                counter: id[2],
                                                                scorelength: $("input[class='hid," + id[0] + "," + id[1] + "," + id[2] + ",maxscorelength']").val(),
                                                                showcode: $(this).attr('data-showcode'),
                                                                codesetting: codesetting,
                                                                radiooption: radiooptionlist,
                                                                scoreoption: scoreoption,
                                                                action: "DetailStudent",
                                                                value: counterValue,
                                                                maxraw: parseFloat($("input[class='hid," + id[0] + "," + id[1] + "," + id[2] + ",maxraw']").val()),
                                                                rawscore: optionValue,
                                                                needapproval: $(this).attr('data-approval'),
                                                                needapprovalcode: $(this).attr('data-approvalcode'),
                                                                inputtype: $(this).attr('data-inputtype'),
                                                                type: "Edit Score"
                                                            }
                                                            let $template = _.template($("#component-modal-update-score").html());

                                                            $("#modal-update-score").html($template({ data: data })).promise().done(function (e) {
                                                                if (data.inputtype == "Option") {
                                                                    $("#newScore").select2({ placeholder: "Select New Score" });
                                                                    $(".select2").width("100%");
                                                                }
                                                                UIkit.modal("#modal-update-score").show();
                                                            });
                                                        }
                                                    });

                                                    $("a[id='" + id[0] + "," + id[1] + "," + id[2] + ",linkapprovalscore']").on('click', function () {
                                                        event.preventDefault();
                                                        //if ($(this).attr('href') && _thisDataGlobal.inPeriod != -2) {
                                                        //    var _this = this;
                                                        //    var paramsApproval = {
                                                        //        idStudent: id[0],
                                                        //        idSubcomponentCounter: id[2]
                                                        //    }
                                                        //    binus.getReq("/Scoring/GetUpdateApproval", paramsApproval)
                                                        //        .then(function (response) {
                                                        //            if (response.payload) {
                                                        //                var approval = response.payload;
                                                        //                var codesetting = $("input[id='" + id[0] + "," + id[1] + "," + id[2] + ",codesetting']").val();
                                                        //                var radobject = $("input[id='" + id[0] + "," + id[1] + "," + id[2] + ",radiooptionobject']").val();
                                                        //                var radopt = $("input[id='" + id[0] + "," + id[1] + "," + id[2] + ",radiooption']").val();
                                                        //                var radiooptionlist = [];
                                                        //                if (radopt) {
                                                        //                    var radiooption = radopt.split(',');
                                                        //                    _.each(radiooption, function (opt, key) {
                                                        //                        var optlist = opt.split(':');
                                                        //                        var stringOpt = "{\"code\":\"" + optlist[0] + "\",\"value\":\"" + optlist[1] + "\"}";
                                                        //                        radiooptionlist.push(JSON.parse(stringOpt));
                                                        //                    });
                                                        //                }
                                                        //                var oldScore = $(_this).attr('data-oldScore');
                                                        //                var newScore = approval.newScore;
                                                        //                var newScoreDesc = '';
                                                        //                var oldScoreDesc = '';
                                                        //                var scoreoption = $("input[id='" + id[0] + "," + id[1] + "," + id[2] + ",scoreoption']").val();
                                                        //                var scoretype = $(_this).attr("data-scoreoption");
                                                        //                if (scoretype == "Radio" || scoretype == "Option") {
                                                        //                    if (scoretype == "Radio") {
                                                        //                        radobject = radobject.replaceAll("\\", '"');
                                                        //                        radobject = JSON.parse(radobject);
                                                        //                        var radVal = _.find(radobject, function (x) { return x.value == approval.newScore });
                                                        //                        if (radVal) {
                                                        //                            newScore = radVal.value;
                                                        //                            newScoreDesc = radVal.code;
                                                        //                        }
                                                        //                        var radOldVal = _.find(radobject, function (x) { return x.value == $(_this).attr('data-oldScore') });
                                                        //                        if (radOldVal) {
                                                        //                            oldScore = radOldVal.value;
                                                        //                            oldScoreDesc = radOldVal.code;
                                                        //                        }
                                                        //                    }
                                                        //                    else if (scoretype == "Option") {
                                                        //                        var optlistsplit = scoreoption.split('/');
                                                        //                        optlistsplit = optlistsplit.slice(0, optlistsplit.length - 1);
                                                        //                        _.each(optlistsplit, function (elmopt, keyopt) {
                                                        //                            var tickfirst = elmopt.substring(elmopt.search("'") + 1);
                                                        //                            var code = tickfirst.substring(0, tickfirst.search("'"));
                                                        //                            var value = tickfirst.substring(tickfirst.search("'") + 2, tickfirst.length - 1);
                                                        //                            if (code == approval.newScore) {
                                                        //                                newScore = code;
                                                        //                                newScoreDesc = value;
                                                        //                            }
                                                        //                            if (code == $(_this).attr('data-oldScore')) {
                                                        //                                oldScore = code;
                                                        //                                oldScoreDesc = value;
                                                        //                            }
                                                        //                        });

                                                        //                    }
                                                        //                }
                                                        //                if (codesetting) {
                                                        //                    var codesetsplit = codesetting.split('/');
                                                        //                    _.each(codesetsplit, function (elmcod, keycod) {
                                                        //                        var tickfirst = elmcod.substring(elmcod.search("'") + 1);
                                                        //                        var code = tickfirst.substring(0, tickfirst.search("'"));
                                                        //                        var value = tickfirst.substring(tickfirst.search("'") + 2, tickfirst.length - 1);
                                                        //                        if (code == approval.newScore) {
                                                        //                            newScore = code;
                                                        //                            newScoreDesc = value;
                                                        //                        }
                                                        //                        if (code == $(_this).attr('data-oldScore')) {
                                                        //                            oldScore = code;
                                                        //                            oldScoreDesc = value;
                                                        //                        }
                                                        //                    });
                                                        //                }
                                                        //                var data = {
                                                        //                    idtransaction: $("input[class='hid," + id[0] + "," + id[1] + "," + id[2] + ",idtransaction']").val(),
                                                        //                    idstudent: approval.idStudent,
                                                        //                    component: comp,
                                                        //                    subcomponent: id[1],
                                                        //                    counter: id[2],
                                                        //                    scorelength: $("input[class='hid," + id[0] + "," + id[1] + "," + id[2] + ",maxscorelength']").val(),
                                                        //                    idScore: approval.idScore,
                                                        //                    oldScore: oldScore,
                                                        //                    newScore: newScore,
                                                        //                    newScoreDesc: newScoreDesc,
                                                        //                    oldScoreDesc: oldScoreDesc,
                                                        //                    textScore: approval.textScore,
                                                        //                    tempTextScore: approval.tempTextScore,
                                                        //                    maxraw: parseFloat($("input[class='hid," + id[0] + "," + id[1] + "," + id[2] + ",maxraw']").val()),
                                                        //                    action: approval.action == 'edit' ? "Edit" : "Delete",
                                                        //                    status: approval.status,
                                                        //                    comment: approval.comment,
                                                        //                    needapproval: $(_this).attr('data-approval'),
                                                        //                    weight: parseFloat($("input[class='hid," + id[0] + "," + id[1] + "," + id[2] + ",weight']").val())
                                                        //                }
                                                        //                let $template = _.template($("#component-modal-approval").html());

                                                        //                $("#modal-approval").html($template({ data: data })).promise().done(function (e) {
                                                        //                    if (data.inputtype == "Option") {
                                                        //                        $("#newScore").select2({ placeholder: "Select New Score" });
                                                        //                        $(".select2").width("100%");
                                                        //                    }
                                                        //                    UIkit.modal("#modal-approval").show();
                                                        //                });
                                                        //            }
                                                        //            else {
                                                        //                toastr.error("Error occured, please contact IT team");
                                                        //            }
                                                        //        })
                                                        //        .catch(function (data) {

                                                        //        });
                                                        //}
                                                    });
                                                }
                                                averagesubbefore = averageSubCounterScore;
                                                averagecounterbefore = averageCounterScore;
                                                if (statuscounter && statuscounter != 1 && statuscounter != 4 && statuscounter != 6) {
                                                    if (e.type == "radio") {
                                                        $("input[name='" + e.attributes.name.value + "']").prop('disabled', true);
                                                    }
                                                    else {
                                                        $(e).prop("disabled", true);
                                                    }
                                                    $("select[id='opt," + id.join(",") + "']").prop("disabled", true);
                                                }

                                            });
                                            //$("input[id^='predicted']").each(function (key, e) {
                                            //    if (!periodForPredicted) $(e).prop('disabled', true)
                                            //})
                                            $(".btn-save-assessment").hide();
                                            if ((_thisData.inPeriod == 0 || _thisData.inPeriod == -1 || isNotEntry == 0 || _thisData.inPeriod == -2) && !counterHasperiod || settingGlobalScore.isLocked) {
                                                $("#btnSave").hide();
                                                $("#btnDraft").hide();
                                                $('.set-all-counter').prop('disabled', true)
                                                $('.set-all-radio').prop('disabled', true)
                                                $("input[id^='raw_']:not(:disabled)").prop('placeholder', '');
                                                $("input[id^='raw_']:not(:disabled)").prop('disabled', true);
                                                if (param.counter != "NEW" && settingGlobalScore.isAddCounter && !settingGlobalScore.isLocked)
                                                    $(".btn-save-assessment").show();
                                            }
                                            else {
                                                $("#btnSave").show();
                                                $("#btnDraft").show();
                                                $('.set-all-counter').prop('disabled', false)
                                                $('.set-all-radio').prop('disabled', false)
                                            }
                                            if (_thisData.IsScoreInOneGo) {
                                                checkAllCounter();
                                            }
                                            if (emptyScoreList) {
                                                toastr.error("No Data Available!");
                                                $(".notNewScore").hide();
                                                components.entry_score.methods.removeSpinnerButton("btnApply");
                                                return;
                                            }
                                            $("#hiddenFirst").removeClass("d-none");
                                            components.entry_score.methods.init();
                                            calculateCounter(_thisData.inPeriod);
                                            $("#label-total-incoming").html(incoming);
                                            components.entry_score.methods.removeSpinnerButton("btnApply");
                                        })
                                        .catch(function (data) {
                                            components.entry_score.methods.removeSpinnerButton("btnApply");
                                            console.info(data)
                                            KTApp.unblockPage();
                                        });

                                })
                                .catch(function (data) {
                                    components.entry_score.methods.removeSpinnerButton("btnApply");
                                    console.info(data)
                                    KTApp.unblockPage();
                                });
                        },
                    },
                    {
                        name: "click",
                        delegate: ".btn-save-score",
                        handler: async function (e) {
                            let _this = this
                            _thisData = components.entry_score.data._scoresetting;
                            if (!_this.checkMaxRawScore()) {
                                toastr.error("Please input all max raw score");
                                return;
                            }
                            var statusSave = $(e.current).attr('id').toLowerCase().includes('draft') ? 'draft' : 'submit';
                            if (_thisData.IsScoreInOneGo && !statusSave.includes('draft')) {
                                if (checkAllCounter()) {
                                    toastr.error("Please input all counter");
                                    return false;
                                }
                            }
                            var isaddNew = $("#isAddnewCounter").val();
                            if (isaddNew && !$("#NewComponentCounterWeight").val()) {
                                toastr.error("Please input new counter weight");
                                return false;
                            }
                            if (isaddNew && ($("#NewComponentCounterWeight").val() == '' || $("#NewComponentCounterWeight").val() == null)) {
                                toastr.error("Please select position");
                                return false;
                            }
                            if (isaddNew && ($("#NewCounterDescription").val() == '' || $("#NewCounterDescription").val() == null)) {
                                toastr.error("Please input Sub Component Counter Short Name");
                                return false;
                            }
                            var worfkFlow = _thisData.idApprovalWorkflow,
                                score = $("#formCreate").serializeArray(),
                                approvall = null,
                                studentScore = _.filter(score, function (x) { return x.name.toLowerCase().includes('score,') }),
                                maxrawscore = _.filter(score, function (x) { return x.name.toLowerCase().includes('maxraw') }),
                                idtransaction = _.filter(score, function (x) { return x.name.toLowerCase().includes('idtransaction') }),
                                idscore = _.filter(score, function (x) { return x.name.toLowerCase().includes('idscore') }),
                                counterstatus = _.filter(score, function (x) { return x.name.toLowerCase().includes('counterstatus') }),
                                maxscorelength = _.filter(score, function (x) { return x.name.toLowerCase().includes('maxscorelength') }),
                                newMaxScore = _.filter(score, function (x) { return x.name.toLowerCase().includes('raw_') }),
                                exitStudent = [],
                                isHasExitStudent = _this.exitStudent.length > 0 ? true : false;
                            //var predictedGrade = _.filter(score, function (x) {return x.name.toLowerCase().includes('predicted')})
                            var updateEntryScoreList = [], subcountlist = [], updateMaxRawScoreList = [], invalidMaxRawScore = false, invalidMaxRawWithCounter = false;

                            _.forEach(studentScore, function (val, key) {
                                var split = val.name.split(','),
                                    studentid = split[1],
                                    counter = split[2],
                                    subcounter = split[3],
                                    comp = split[4];
                                if (!subcountlist.includes(subcounter)) subcountlist.push(subcounter);
                                if (val.name.toLowerCase().includes('new') && val.value != '') {
                                    var split = val.name.split(','),
                                        studentid = split[1],
                                        counter = _.find(score, function (x) { return x.name == "NewComponentCounterNumber" }).value,
                                        counterfind = split[2],
                                        subcounter = split[3],
                                        comp = split[4],
                                        idtranscore = _.find(idtransaction, function (x) { return x.name.includes(studentid + ',' + subcounter + ',' + counterfind) }),
                                        idscorein = _.find(idscore, function (x) { return x.name.includes(studentid + ',' + subcounter + ',' + counterfind) }),
                                        maxrawin = _.find(maxrawscore, function (x) { return x.name.includes(studentid + ',' + subcounter + ',' + counterfind) }),
                                        maxscoreleng = _.find(maxscorelength, function (x) { return x.name.includes(studentid + ',' + subcounter + ',' + counterfind) });
                                    //let predictedGrd = _.find(predictedGrade, function (x) { return x.name.includes(studentid + ',predicted') })
                                    var tempscore = {
                                        idTransactionScore: idtranscore != undefined ? (idtranscore.value == '' ? null : idtranscore.value) : null,
                                        idScore: idscorein != undefined ? (idscorein.value == '' ? null : idscorein.value) : null,
                                        idStudent: studentid,
                                        idComponent: comp,
                                        idSubComponent: subcounter,
                                        idSubComponentCounter: counter,
                                        subComponentCounterScore: 0,
                                        oldSubComponentCounterScore: 0,
                                        subComponentMaxScoreLength: maxscoreleng != undefined ? (maxscoreleng.value == '' ? null : maxscoreleng.value) : null,
                                    }
                                    maxrawscore = _.filter(score, function (x) { return x.name.toLowerCase().includes('raw_') })
                                    var maxRawScoreInput = _.find(newMaxScore, function (x) { return x.name.includes('raw_' + counterfind) })
                                    if (maxRawScoreInput.value == '' || maxRawScoreInput.value == null) {
                                        invalidMaxRawScore = true
                                        return
                                    }
                                    if (parseFloat(maxRawScoreInput.value) < parseFloat(val.value)) {
                                        invalidMaxRawWithCounter = true
                                        return
                                    }
                                    if (val.value && isNaN(parseFloat(val.value))) {
                                        tempscore.textScore = val.value;
                                        tempscore.maxRawScore = 0;
                                        tempscore.rawScore = 0;
                                        tempscore.oldTextScore = null;
                                        tempscore.oldMaxRawScore = null;
                                        tempscore.oldRawScore = null;
                                    }
                                    else {
                                        tempscore.textScore = null;
                                        tempscore.maxRawScore = maxRawScoreInput != '' && maxRawScoreInput != null ? parseFloat(maxRawScoreInput.value) : (maxrawin != undefined ? maxrawin.value : '');
                                        tempscore.rawScore = val.value != null && val.value != "" ? parseFloat(val.value) : null;
                                        tempscore.oldTextScore = null;
                                        tempscore.oldMaxRawScore = null;
                                        tempscore.oldRawScore = null;
                                    }
                                    tempscore.needApproval = settingGlobalScore.needEntryApproval;
                                    tempscore.codeNeedApproval = settingGlobalScore.needEntryCodeApproval;

                                    //tempscore.predictedGrade = predictedGrd != undefined ? predictedGrd.value : ''
                                    updateEntryScoreList.push(tempscore);

                                }
                                else if (!val.name.toLowerCase().includes('submitted') && val.value != '') {
                                    var idtranscore = _.find(idtransaction, function (x) { return x.name.includes(studentid + ',' + subcounter + ',' + counter) }),
                                        idscorein = _.find(idscore, function (x) { return x.name.includes(studentid + ',' + subcounter + ',' + counter) }),
                                        maxrawin = _.find(maxrawscore, function (x) { return x.name.includes(studentid + ',' + subcounter + ',' + counter) }),
                                        maxscoreleng = _.find(maxscorelength, function (x) { return x.name.includes(studentid + ',' + subcounter + ',' + counter) });
                                    //let predictedGrd = _.find(predictedGrade, function (x) { return x.name.includes(studentid + ',predicted') })
                                    var tempscore = {
                                        idTransactionScore: idtranscore != undefined ? (idtranscore.value == '' ? null : idtranscore.value) : null,
                                        idScore: idscorein != undefined ? (idscorein.value == '' ? null : idscorein.value) : null,
                                        idStudent: studentid,
                                        idComponent: comp,
                                        idSubComponent: subcounter,
                                        idSubComponentCounter: counter,
                                        subComponentCounterScore: 0,
                                        oldSubComponentCounterScore: 0,
                                        needApproval: settingGlobalScore.needEntryApproval,
                                        codeNeedApproval: settingGlobalScore.needEntryCodeApproval,
                                        subComponentMaxScoreLength: maxscoreleng != undefined ? (maxscoreleng.value == '' ? null : maxscoreleng.value) : null,
                                    }
                                    var maxRawScoreInput = ''
                                    if (_.find(newMaxScore, function (x) { return x.name.includes('raw_' + counter) })) {
                                        maxRawScoreInput = _.find(newMaxScore, function (x) { return x.name.includes('raw_' + counter) })
                                        if (_.find(newMaxScoreObj, x => { return x['IdSubComponentCounter'] == counter }) == undefined) {
                                            if (maxRawScoreInput.value == '' || maxRawScoreInput.value == null) {
                                                invalidMaxRawScore = true
                                                return
                                            }
                                            if (parseFloat(maxRawScoreInput.value) < parseFloat(val.value)) {
                                                invalidMaxRawWithCounter = true
                                                return
                                            }
                                            var newMaxScoreObj = {
                                                IdSubComponentCounter: counter,
                                                MaxRawScore: parseFloat(maxRawScoreInput.value)
                                            }
                                            if (updateMaxRawScoreList.find(x => x.IdSubComponentCounter === newMaxScoreObj.IdSubComponentCounter) === undefined)
                                                updateMaxRawScoreList.push(newMaxScoreObj);
                                        }
                                    }
                                    if (invalidMaxRawScore) return
                                    if (isNaN(parseFloat(val.value))) {
                                        tempscore.textScore = val.value;
                                        tempscore.maxRawScore = 0;
                                        tempscore.rawScore = 0;
                                        tempscore.oldTextScore = null;
                                        tempscore.oldMaxRawScore = null;
                                        tempscore.oldRawScore = null;
                                    }
                                    else {
                                        tempscore.textScore = null;
                                        tempscore.maxRawScore = maxRawScoreInput != '' && maxRawScoreInput != null ? parseFloat(maxRawScoreInput.value) : (maxrawin != undefined ? maxrawin.value : '');
                                        tempscore.rawScore = parseFloat(val.value);
                                        tempscore.oldTextScore = null;
                                        tempscore.oldMaxRawScore = null;
                                        tempscore.oldRawScore = null;
                                    }
                                    //if (tempscore.rawScore >= 0) {
                                        //tempscore.needApproval = (approvall != null && approvall != '') ? true : false;
                                    //}
                                    //else tempscore.needApproval = true;
                                    //tempscore.predictedGrade = predictedGrd != undefined ? predictedGrd.value : ''
                                    updateEntryScoreList.push(tempscore);
                                }
                                // takeout Student Exit Score
                                //if (isHasExitStudent) {
                                //    var exitCounter = _.find(exitStudent, (eStd) => {
                                //        return eStd['idSubComponentCounter'] = counter
                                //    });
                                //    if (!exitCounter) {
                                //        _this.exitStudentData.map((x) => {
                                //            let scoreDetail = _.find(x.studentScoreList, (g) => { return g.idSubComponentCounter?.trim() === counter?.trim() });
                                //            var idtranscore = scoreDetail?.updateScore?.idTransactionScore,
                                //                idscorein = scoreDetail?.idScore,
                                //                maxrawin = _.find(maxrawscore, function (y) { return y.name.includes(studentid + ',' + subcounter + ',' + counter) }),
                                //                maxscoreleng = _.find(maxscorelength, function (y) { return y.name.includes(studentid + ',' + subcounter + ',' + counter) });
                                //            var tempscore = {
                                //                idTransactionScore: idtranscore != undefined ? idtranscore : null,
                                //                idScore: idscorein != undefined ? idscorein : null,
                                //                idStudent: x.idStudent,
                                //                idComponent: comp,
                                //                idSubComponent: subcounter,
                                //                idSubComponentCounter: counter,
                                //                subComponentCounterScore: 0,
                                //                oldSubComponentCounterScore: 0,
                                //                needApproval: false,
                                //                subComponentMaxScoreLength: maxscoreleng != undefined ? (maxscoreleng.value == '' ? null : maxscoreleng.value) : null,
                                //            },
                                //                maxRawScoreInput = maxRawScoreInput = _.find(newMaxScore, function (y) { return y.name.includes('raw_' + counter) });
                                //            tempscore.textScore = null;
                                //            tempscore.maxRawScore = maxRawScoreInput != '' && maxRawScoreInput != null ? parseFloat(maxRawScoreInput.value) : (maxrawin != undefined ? maxrawin.value : '');
                                //            tempscore.rawScore = -4;
                                //            tempscore.oldTextScore = null;
                                //            tempscore.oldMaxRawScore = null;
                                //            tempscore.oldRawScore = null;
                                //            exitStudent.push(
                                //                tempscore
                                //            );
                                //        })
                                //    }
                                //}
                            });
                            //if (isHasExitStudent) {
                            //    updateEntryScoreList = [...updateEntryScoreList, ...exitStudent]
                            //}
                            if (invalidMaxRawScore) {
                                toastr.error("Please input all max raw score");
                                return;
                            }
                            if (invalidMaxRawWithCounter) {
                                toastr.error("Max Raw Score must be greater or equals to counter score");
                                return;
                            }
                            if ($("#selectedCounter").val().toLowerCase().includes('new') && updateEntryScoreList.length < 1) {
                                toastr.error("At least input one student score!");
                                return;
                            }
                            var insertNewCounter = {};
                            if (isaddNew) {
                                insertNewCounter.idTeacherPosition = _.find(score, function (x) { return x.name == "NewCounterPosition" }).value;
                                insertNewCounter.idCounter = _.find(score, function (x) { return x.name == "NewComponentCounterNumber" }).value;
                                insertNewCounter.longDesc = _.find(score, function (x) { return x.name == "NewCounterDescription" }).value;
                                insertNewCounter.idCounterCategory = $("#ddlCounterCategory").val();
                                insertNewCounter.weight = $("#NewComponentCounterWeight").val();
                                insertNewCounter.idLesson = _this.selectedClassID;
                                insertNewCounter.maxRawScore = maxrawscore[0].value;
                                insertNewCounter.dateCounter = moment(new Date(_.find(score, function (x) { return x.name == "NewComponentNameDate" }).value)).locale("en").format("YYYY-MM-DD");
                            }
                            var UpdateScoreModel = {
                                UpdateEntryScores: updateEntryScoreList.length == 0 ? null : updateEntryScoreList,
                                InsertNewCounter: insertNewCounter,
                                IdSubComponentList: subcountlist,
                                UpdateMaxRawScoreList: updateMaxRawScoreList
                            }
                            //if (updateEntryScoreList.length > 0)
                            //return;
                            await binus.postReq("/Scoring/UpdateScore?status=" + statusSave + "&workflow=" + worfkFlow + "&insertnewcounter=" + isaddNew, UpdateScoreModel)
                                .then(async function (response) {
                                    //console.log(JSON.stringify(response));
                                    //return
                                    if (response == 200) {
                                        if (statusSave.includes('draft'))
                                            toastr.success("Draft saved Successfully.");
                                        else
                                            toastr.success("Score saved Successfully. It will take approx. 15 Min to calculate Semester Score.");
                                        $("#NewComponentCounterWeight").val('');
                                        $("#ddlCounterCategory").val('');
                                        $("#NewComponentCounterNumber").val('');
                                        $("#NewCounterDescription").val('');
                                        $("#NewCounterPosition").empty()
                                        if ($("#IdCounterAssessment").val() !== null && $("#IdCounterAssessment").val() !== '') {
                                            var paramAssessment = {
                                                IdApprovalWorkflow: settingGlobalScore.idApprovalWorkflow,
                                                IsUpdateAssessment: true,
                                                Assessment: {
                                                    IdCounter: $("#IdCounterAssessment").val(),
                                                    DateCounter: $("#assessmentDate").val(),
                                                    IdCounterCategory: $("#assessmentType").val(),
                                                    LongDesc: $("#assessmentDescription").val()
                                                }
                                            }
                                            await binus.postReq("/Scoring/UpdateAssessmentScore", paramAssessment)
                                                .then(function (response) {
                                                    if (response.statusCode !== 200) {
                                                        console.info(response);
                                                        return toastr.error(response.message);
                                                    }
                                                    toastr.success("Assessment Updated Successfully");
                                                })
                                                .catch(function (error) {
                                                    console.info(error);
                                                    toastr.error(`Error occured with code [S/ES/UAS], please contact administrator`);
                                                })
                                        }

                                        setTimeout(async function () {
                                            let selectedCounter = "";
                                            if (isaddNew) {
                                                selectedCounter = "All";
                                            }
                                            else {
                                                selectedCounter = $("#filterCounter").val();
                                            }

                                            $("#filterSubComponent").empty();
                                            $("#filterCounter").empty();

                                            await components.entry_score.methods.bindInnerDDL("subcomponent");
                                            await components.entry_score.methods.bindInnerDDL("counter", settingGlobalScore.isAddCounter, selectedCounter);
                                            $("#btnApply").click();
                                        }, 1000);
                                    }
                                    else {
                                        toastr.error("Error occured when saving");
                                        KTApp.unblockPage();
                                    }
                                }).catch(function (data) {
                                    binus.showerror(data)
                                });

                        }
                    },
                    {
                        name: "change_reference",
                        delegate: "#filterAcadYear",
                        handler: function (e, data) {
                            let _this = this
                            $("#filterGrade").empty();
                            $("#filterSemester").empty();
                            $("#filterTerm").empty();
                            $("#filterStreaming").empty();
                            $("#filterSubjectType").empty();
                            $("#filterSubject").empty();
                            $("#filterSubjectLevel").empty();
                            $("#filterClassID").empty();
                            $("#filterComponent").empty();
                            $("#filterSubComponent").empty();
                            $("#filterCounter").empty();

                            $("#filterGrade").attr("disabled", true);
                            $("#filterSemester").attr("disabled", true);
                            $("#filterTerm").attr("disabled", true);
                            $("#filterStreaming").attr("disabled", true);
                            $("#filterSubjectType").attr("disabled", true);
                            $("#filterSubject").attr("disabled", true);
                            $("#filterSubjectLevel").attr("disabled", true);
                            $("#filterClassID").attr("disabled", true);
                            $("#filterComponent").attr("disabled", true);
                            $("#filterSubComponent").attr("disabled", true);
                            $("#filterCounter").attr("disabled", true);

                            $("#filterLevel").empty();
                            components.entry_score.methods.initDdl();
                            var params = {
                                AcadYear: $("#filterAcadYear").val()
                            }
                            $.ajax({
                                type: 'GET',
                                url: "/Scoring/DropDownSetting?AcadYear=" + params.AcadYear,
                                beforeSend: function (e) {
                                    KTApp.blockPage({
                                        overlayColor: '#000000',
                                        state: 'danger',
                                        message: 'Please wait...'
                                    });
                                },
                                error: function (e) {
                                    KTApp.unblockPage();
                                },
                                complete: function () {
                                    KTApp.unblockPage();
                                },
                                success: function (response2) {
                                    _this._dropdownsetting = response2.payload;
                                    _this._idTeacherPosition = response2.idTeacherPosition
                                    _this.listTeacherPosition = response2.listPosition
                                    var option = new Option("", "", false, false);
                                    //$("#filterLevel").append(option);
                                    //_.each(response2.levels, function (val, key) {
                                    //    var selected = key == 0 ? true : false
                                    //    var option = new Option(val.description, val.id, selected, selected);
                                    //    $(option).html(val.description);
                                    //    $("#filterLevel").append(option);
                                    //});
                                    //$("#filterLevel").select2({
                                    //    placeholder: 'Search Level'
                                    //});
                                    //$("#filterLevel").attr("disabled", false);
                                    //$(".select2").width("100%");
                                    //$("#filterLevel").trigger('change');
                                    $("#filterGrade").append(option);
                                    _.each(response2.grades, function (val, key) {
                                        var selected = _this._viewModel == null ? (key == 0 ? true : false) : (_this._viewModel.grade == val.id ? true : false)
                                        var option = new Option(val.description, val.id, selected, selected);
                                        $(option).html(val.description);
                                        $("#filterGrade").append(option);
                                    });
                                    $("#filterGrade").select2({
                                        placeholder: 'Search Grade'
                                    });
                                    $("#filterGrade").attr("disabled", false);
                                    $(".select2").width("100%");
                                    $("#filterGrade").trigger('change');
                                    //if (_this._viewModel != null) {
                                        //let viewModel = _this._viewModel
                                        //$.when($("#filterLevel").val(viewModel.level).trigger('change'))
                                        //    .done($.when($("#filterGrade").val(viewModel.grade).trigger('change'))
                                        //        .done($.when($("#filterSemester").val(viewModel.semester).trigger('change'))
                                        //            .done($.when($("#filterTerm").val(viewModel.term).trigger('change'))
                                        //                .done($.when($("#filterStreaming").val(viewModel.streaming).trigger('change'))
                                        //                    .done($.when($("#filterSubjectType").val(viewModel.subjectType).trigger('change'))
                                        //                        .done($.when($("#filterSubject").val(viewModel.subject).trigger('change'))
                                        //                            .done(function () {
                                        //                                if (viewModel.subjectLevel) $.when($("#filterSubjectLevel").val(viewModel.subjectLevel).trigger('change')).done($.when($("#filterClassID").val(viewModel.classId).trigger('change'))
                                        //                                    .done($("#btnApply").click()));
                                        //                                else $.when($("#filterClassID").val(viewModel.classId).trigger('change'))
                                        //                                    .done($("#btnApply").click());
                                        //                            })))))))
                                        //$.when($("#filterSemester").val(viewModel.semester).trigger('change'))
                                        //    .done($.when($("#filterTerm").val(viewModel.term).trigger('change'))
                                        //        .done($.when($("#filterSubject").val(viewModel.subject).trigger('change'))
                                        //            .done($.when($("#filterClassID").val(viewModel.classId).trigger('change'))
                                        //                .done(function () {
                                        //                    //$("#btnApply").click()
                                        //                }))))
                                    //}
                                },
                                contentType: "application/json"
                            });
                        }
                    },
                    {
                        name: 'click',
                        delegate: '#pendingScore',
                        handler: function (e) {
                            var form = document.createElement("form");
                            form.setAttribute("method", "POST");
                            form.setAttribute("action", "/Scoring/Redirect");

                            var acadYear = document.createElement("input");
                            acadYear.setAttribute("name", "acadyear");
                            acadYear.setAttribute("value", $("#selectedAcadYear").val() + ',' + $("#selectedAcadYearDesc").val());


                            var level = document.createElement("input");
                            level.setAttribute("name", "level");
                            level.setAttribute("value", $("#selectedLevel").val() + ',' + $("#selectedLevelDesc").val());

                            var grade = document.createElement("input");
                            grade.setAttribute("name", "grade");
                            grade.setAttribute("value", $("#selectedGrade").val() + ',' + $("#selectedGradeDesc").val());

                            var semester = document.createElement("input");
                            semester.setAttribute("name", "semester");
                            semester.setAttribute("value", $("#selectedSemester").val() + ',' + $("#selectedSemesterDesc").val());

                            var term = document.createElement("input");
                            term.setAttribute("name", "term");
                            term.setAttribute("value", $("#selectedTerm").val() + ',' + $("#selectedTermDesc").val());

                            //var streaming = document.createElement("input");
                            //streaming.setAttribute("name", "streaming");
                            //streaming.setAttribute("value", $("#selectedStreaming").val() + ',' + $("#selectedStreamingDesc").val());

                            var streaming = document.createElement("input");
                            streaming.setAttribute("name", "streaming");
                            streaming.setAttribute("value", $("#selectedClassID").val().split('/')[1] + ',' + $("#selectedClassID").val());

                            //var subjecttype = document.createElement("input");
                            //subjecttype.setAttribute("name", "subjecttype");
                            //subjecttype.setAttribute("value", $("#selectedSubjectType").val() + ',' + $("#selectedSubjectTypeDesc").val());

                            var subject = document.createElement("input");
                            subject.setAttribute("name", "subject");
                            subject.setAttribute("value", $("#selectedSubject").val().split('/')[0] + ',' + $("#selectedSubjectDesc").val());

                            //var subjectlevel = document.createElement("input");
                            //subjectlevel.setAttribute("name", "subjectlevel");
                            //subjectlevel.setAttribute("value", $("#selectedSubjectLevel").val() + ',' + $("#selectedSubjectLevelDesc").val());

                            var subjectlevel = document.createElement("input");
                            subjectlevel.setAttribute("name", "subjectlevel");
                            subjectlevel.setAttribute("value", $("#selectedSubject").val().split('/')[1] + ',' + $("#selectedSubjectDesc").val());

                            //var classid = document.createElement("input");
                            //classid.setAttribute("name", "classid");
                            //classid.setAttribute("value", $("#selectedClassID").val() + ',' + $("#selectedClassIDDesc").val());

                            var classid = document.createElement("input");
                            classid.setAttribute("name", "classid");
                            classid.setAttribute("value", $("#selectedClassID").val().split('/')[0] + ',' + $("#selectedClassIDDesc").val());

                            var component = document.createElement("input");
                            component.setAttribute("name", "component");
                            component.setAttribute("value", $("#selectedComponent").val().toLowerCase().includes('all') ? '' : $("#selectedComponent").val() + ',' + $("#selectedComponentDesc").val());

                            var subcomponent = document.createElement("input");
                            subcomponent.setAttribute("name", "subcomponent");
                            subcomponent.setAttribute("value", $("#selectedSubComponent").val().toLowerCase().includes('all') ? '' : $("#selectedSubComponent").val() + ',' + $("#selectedSubComponentDesc").val());

                            var counter = document.createElement("input");
                            counter.setAttribute("name", "counter");
                            counter.setAttribute("value", $("#selectedCounter").val().toLowerCase().includes('all') ? '' : $("#selectedCounter").val() + ',' + $("#selectedCounterDesc").val());

                            var to = document.createElement("input");
                            to.setAttribute("name", "to");
                            to.setAttribute("value", 'pending');

                            var s = document.createElement("input");
                            s.setAttribute("type", "submit");
                            s.setAttribute("value", "Submit");

                            form.appendChild(acadYear);
                            form.appendChild(level);
                            form.appendChild(grade);
                            form.appendChild(semester);
                            form.appendChild(term);
                            form.appendChild(streaming);
                            //form.appendChild(subjecttype);
                            form.appendChild(subject);
                            //form.appendChild(subjectlevel);
                            form.appendChild(classid);
                            form.appendChild(component);
                            form.appendChild(subcomponent);
                            form.appendChild(counter);
                            form.appendChild(to);
                            form.appendChild(s);


                            $("#forFormTemp").append(form);
                            s.click();
                        }
                    },
                    {
                        name: 'click',
                        delegate: '#unsubmittedScore',
                        handler: function (e) {
                            var form = document.createElement("form");
                            form.setAttribute("method", "POST");
                            form.setAttribute("action", "/Scoring/Redirect");

                            var acadYear = document.createElement("input");
                            acadYear.setAttribute("name", "acadyear");
                            acadYear.setAttribute("value", $("#selectedAcadYear").val() + ',' + $("#selectedAcadYearDesc").val());


                            var level = document.createElement("input");
                            level.setAttribute("name", "level");
                            level.setAttribute("value", $("#selectedLevel").val() + ',' + $("#selectedLevelDesc").val());

                            var grade = document.createElement("input");
                            grade.setAttribute("name", "grade");
                            grade.setAttribute("value", $("#selectedGrade").val() + ',' + $("#selectedGradeDesc").val());

                            var semester = document.createElement("input");
                            semester.setAttribute("name", "semester");
                            semester.setAttribute("value", $("#selectedSemester").val() + ',' + $("#selectedSemesterDesc").val());

                            var term = document.createElement("input");
                            term.setAttribute("name", "term");
                            term.setAttribute("value", $("#selectedTerm").val() + ',' + $("#selectedTermDesc").val());

                            //var streaming = document.createElement("input");
                            //streaming.setAttribute("name", "streaming");
                            //streaming.setAttribute("value", $("#selectedStreaming").val() + ',' + $("#selectedStreamingDesc").val());

                            var streaming = document.createElement("input");
                            streaming.setAttribute("name", "streaming");
                            streaming.setAttribute("value", $("#selectedClassID").val().split('/')[1] + ',' + $("#selectedClassID").val());

                            //var subjecttype = document.createElement("input");
                            //subjecttype.setAttribute("name", "subjecttype");
                            //subjecttype.setAttribute("value", $("#selectedSubjectType").val() + ',' + $("#selectedSubjectTypeDesc").val());

                            var subject = document.createElement("input");
                            subject.setAttribute("name", "subject");
                            subject.setAttribute("value", $("#selectedSubject").val().split('/')[0] + ',' + $("#selectedSubjectDesc").val());

                            //var subjectlevel = document.createElement("input");
                            //subjectlevel.setAttribute("name", "subjectlevel");
                            //subjectlevel.setAttribute("value", $("#selectedSubjectLevel").val() + ',' + $("#selectedSubjectLevelDesc").val());

                            var subjectlevel = document.createElement("input");
                            subjectlevel.setAttribute("name", "subjectlevel");
                            subjectlevel.setAttribute("value", $("#selectedSubject").val().split('/')[1] + ',' + $("#selectedSubjectDesc").val());

                            //var classid = document.createElement("input");
                            //classid.setAttribute("name", "classid");
                            //classid.setAttribute("value", $("#selectedClassID").val() + ',' + $("#selectedClassIDDesc").val());

                            var classid = document.createElement("input");
                            classid.setAttribute("name", "classid");
                            classid.setAttribute("value", $("#selectedClassID").val().split('/')[0] + ',' + $("#selectedClassIDDesc").val());

                            var component = document.createElement("input");
                            component.setAttribute("name", "component");
                            component.setAttribute("value", $("#selectedComponent").val().toLowerCase().includes('all') ? '' : $("#selectedComponent").val() + ',' + $("#selectedComponentDesc").val());

                            var subcomponent = document.createElement("input");
                            subcomponent.setAttribute("name", "subcomponent");
                            subcomponent.setAttribute("value", $("#selectedSubComponent").val().toLowerCase().includes('all') ? '' : $("#selectedSubComponent").val() + ',' + $("#selectedSubComponentDesc").val());

                            var counter = document.createElement("input");
                            counter.setAttribute("name", "counter");
                            counter.setAttribute("value", $("#selectedCounter").val().toLowerCase().includes('all') ? '' : $("#selectedCounter").val() + ',' + $("#selectedCounterDesc").val());

                            var to = document.createElement("input");
                            to.setAttribute("name", "to");
                            to.setAttribute("value", 'unsubmitted');

                            var s = document.createElement("input");
                            s.setAttribute("type", "submit");
                            s.setAttribute("value", "Submit");

                            form.appendChild(acadYear);
                            form.appendChild(level);
                            form.appendChild(grade);
                            form.appendChild(semester);
                            form.appendChild(term);
                            form.appendChild(streaming);
                            //form.appendChild(subjecttype);
                            form.appendChild(subject);
                            //form.appendChild(subjectlevel);
                            form.appendChild(classid);
                            form.appendChild(component);
                            form.appendChild(subcomponent);
                            form.appendChild(counter);
                            form.appendChild(to);
                            form.appendChild(s);


                            $("#forFormTemp").append(form);
                            s.click();
                        }
                    },
                    {
                        name: 'click',
                        delegate: '#btnTeacherJudgment',
                        handler: function (e) {
                            var form = document.createElement("form");
                            form.setAttribute("method", "POST");
                            form.setAttribute("action", "/Scoring/Redirect");

                            var acadYear = document.createElement("input");
                            acadYear.setAttribute("name", "acadyear");
                            acadYear.setAttribute("value", $("#selectedAcadYear").val() + ',' + $("#selectedAcadYearDesc").val());

                            var level = document.createElement("input");
                            level.setAttribute("name", "level");
                            level.setAttribute("value", $("#selectedLevel").val() + ',' + $("#selectedLevelDesc").val());

                            var grade = document.createElement("input");
                            grade.setAttribute("name", "grade");
                            grade.setAttribute("value", $("#selectedGrade").val() + ',' + $("#selectedGradeDesc").val());

                            var semester = document.createElement("input");
                            semester.setAttribute("name", "semester");
                            semester.setAttribute("value", $("#selectedSemester").val() + ',' + $("#selectedSemesterDesc").val());

                            var term = document.createElement("input");
                            term.setAttribute("name", "term");
                            term.setAttribute("value", $("#selectedTerm").val() + ',' + $("#selectedTermDesc").val());

                            //var streaming = document.createElement("input");
                            //streaming.setAttribute("name", "streaming");
                            //streaming.setAttribute("value", $("#selectedStreaming").val() + ',' + $("#selectedStreamingDesc").val());

                            var streaming = document.createElement("input");
                            streaming.setAttribute("name", "streaming");
                            streaming.setAttribute("value", $("#selectedClassID").val().split('/')[1] + ',' + $("#selectedClassID").val());

                            //var subjecttype = document.createElement("input");
                            //subjecttype.setAttribute("name", "subjecttype");
                            //subjecttype.setAttribute("value", $("#selectedSubjectType").val() + ',' + $("#selectedSubjectTypeDesc").val());

                            var subject = document.createElement("input");
                            subject.setAttribute("name", "subject");
                            subject.setAttribute("value", $("#selectedSubject").val().split('/')[0] + ',' + $("#selectedSubjectDesc").val());

                            //var subjectlevel = document.createElement("input");
                            //subjectlevel.setAttribute("name", "subjectlevel");
                            //subjectlevel.setAttribute("value", $("#selectedSubjectLevel").val() + ',' + $("#selectedSubjectLevelDesc").val());

                            var subjectlevel = document.createElement("input");
                            subjectlevel.setAttribute("name", "subjectlevel");
                            subjectlevel.setAttribute("value", $("#selectedSubject").val().split('/')[1] + ',' + $("#selectedSubjectDesc").val());

                            //var classid = document.createElement("input");
                            //classid.setAttribute("name", "classid");
                            //classid.setAttribute("value", $("#selectedClassID").val() + ',' + $("#selectedClassIDDesc").val());

                            var classid = document.createElement("input");
                            classid.setAttribute("name", "classid");
                            classid.setAttribute("value", $("#selectedClassID").val().split('/')[0] + ',' + $("#selectedClassIDDesc").val());

                            var to = document.createElement("input");
                            to.setAttribute("name", "to");
                            to.setAttribute("value", 'judgment');

                            var s = document.createElement("input");
                            s.setAttribute("type", "submit");
                            s.setAttribute("value", "Submit");

                            form.appendChild(acadYear);
                            form.appendChild(level);
                            form.appendChild(grade);
                            form.appendChild(semester);
                            form.appendChild(term);
                            form.appendChild(streaming);
                            //form.appendChild(subjecttype);
                            form.appendChild(subject);
                            //form.appendChild(subjectlevel);
                            form.appendChild(classid);
                            form.appendChild(to);
                            form.appendChild(s);


                            $("#forFormTemp").append(form);
                            s.click();
                        }
                    },
                    {
                        name: 'click',
                        delegate: '#btnPredictedGrade',
                        handler: function (e) {
                            var form = document.createElement("form");
                            form.setAttribute("method", "POST");
                            form.setAttribute("action", "/Scoring/Redirect");

                            var acadYear = document.createElement("input");
                            acadYear.setAttribute("name", "acadyear");
                            acadYear.setAttribute("value", $("#selectedAcadYear").val() + ',' + $("#selectedAcadYearDesc").val());

                            var level = document.createElement("input");
                            level.setAttribute("name", "level");
                            level.setAttribute("value", $("#selectedLevel").val() + ',' + $("#selectedLevelDesc").val());

                            var grade = document.createElement("input");
                            grade.setAttribute("name", "grade");
                            grade.setAttribute("value", $("#selectedGrade").val() + ',' + $("#selectedGradeDesc").val());

                            var semester = document.createElement("input");
                            semester.setAttribute("name", "semester");
                            semester.setAttribute("value", $("#selectedSemester").val() + ',' + $("#selectedSemesterDesc").val());

                            var term = document.createElement("input");
                            term.setAttribute("name", "term");
                            term.setAttribute("value", $("#selectedTerm").val() + ',' + $("#selectedTermDesc").val());

                            //var streaming = document.createElement("input");
                            //streaming.setAttribute("name", "streaming");
                            //streaming.setAttribute("value", $("#selectedStreaming").val() + ',' + $("#selectedStreamingDesc").val());

                            var streaming = document.createElement("input");
                            streaming.setAttribute("name", "streaming");
                            streaming.setAttribute("value", $("#selectedClassID").val().split('/')[1] + ',' + $("#selectedClassID").val());

                            //var subjecttype = document.createElement("input");
                            //subjecttype.setAttribute("name", "subjecttype");
                            //subjecttype.setAttribute("value", $("#selectedSubjectType").val() + ',' + $("#selectedSubjectTypeDesc").val());

                            var subject = document.createElement("input");
                            subject.setAttribute("name", "subject");
                            subject.setAttribute("value", $("#selectedSubject").val().split('/')[0] + ',' + $("#selectedSubjectDesc").val());

                            //var subjectlevel = document.createElement("input");
                            //subjectlevel.setAttribute("name", "subjectlevel");
                            //subjectlevel.setAttribute("value", $("#selectedSubjectLevel").val() + ',' + $("#selectedSubjectLevelDesc").val());

                            var subjectlevel = document.createElement("input");
                            subjectlevel.setAttribute("name", "subjectlevel");
                            subjectlevel.setAttribute("value", $("#selectedSubject").val().split('/')[1] + ',' + $("#selectedSubjectDesc").val());

                            //var classid = document.createElement("input");
                            //classid.setAttribute("name", "classid");
                            //classid.setAttribute("value", $("#selectedClassID").val() + ',' + $("#selectedClassIDDesc").val());

                            var classid = document.createElement("input");
                            classid.setAttribute("name", "classid");
                            classid.setAttribute("value", $("#selectedClassID").val().split('/')[0] + ',' + $("#selectedClassIDDesc").val());

                            var to = document.createElement("input");
                            to.setAttribute("name", "to");
                            to.setAttribute("value", 'predicted');

                            var s = document.createElement("input");
                            s.setAttribute("type", "submit");
                            s.setAttribute("value", "Submit");

                            form.appendChild(acadYear);
                            form.appendChild(level);
                            form.appendChild(grade);
                            form.appendChild(semester);
                            form.appendChild(term);
                            form.appendChild(streaming);
                            //form.appendChild(subjecttype);
                            form.appendChild(subject);
                            form.appendChild(subjectlevel);
                            form.appendChild(classid);
                            form.appendChild(to);
                            form.appendChild(s);


                            $("#forFormTemp").append(form);
                            s.click();
                        }
                    },
                    {
                        name: 'change',
                        delegate: '.set-all-counter',
                        handler: function (e) {
                            var elm = e.srcElement
                            var counterid = $(elm).attr('counterid')
                            var selectedValue = $(elm).val()
                            $("select[name*='," + counterid + ",']").each(function (idx, elmchild) {
                                $(elmchild).find(':selected').prop('selected', false)
                                $(elmchild).val(selectedValue)
                            })
                        }
                    },
                    {
                        name: 'click',
                        delegate: '.btn-delete-counter',
                        handler: function (e) {
                            let _this = this;
                            let workflow = _thisDataGlobal.idApprovalWorkflow;
                            let confirm = false;
                            let list = _this.entryScoreStudentList.map((val, idx) => {
                                if (val.studentScoreList[0].updateScore !== null && (val.studentScoreList[0].updateScore.statusAction === 1 || val.studentScoreList[0].updateScore.statusAction === 3)) confirm = true;
                                return {
                                    IdStudent: val.idStudent,
                                    IdSubComponentCounter: val.studentScoreList[0].idSubComponentCounter,
                                    IdTransactionScore: val.studentScoreList[0].updateScore === null ? null : val.studentScoreList[0].updateScore.idTransactionScore
                                };
                            })
                            var param = {
                                IdApprovalWorkflow: workflow,
                                StudentScores: list
                            }
                            $.confirm({
                                title: 'Delete Counter Score',
                                content: 'Are you sure to delete this Counter Score? ' + (confirm ? 'All approval will be canceled' : ''),
                                buttons:
                                {
                                    Cancel: {
                                        text: 'Cancel',
                                        btnClass: 'btn-gray',
                                        action: function () { }
                                    },
                                    OK: {
                                        text: 'Delete',
                                        btnClass: 'btn-warning',
                                        keys: ['enter', 'shift'],
                                        action: function () {
                                            binus.postReq("/Scoring/DeleteStudentCounterScore", param)
                                                .then(function (response) {
                                                    if (response.statusCode !== 200) {
                                                        KTApp.unblockPage();
                                                        toastr.error(response.message);
                                                        return console.info(response);
                                                    }
                                                    toastr.success('Score deleted sucessfully');
                                                    window.setTimeout(function () {
                                                        $("#btnApply").click();
                                                    }, 1000)

                                                })
                                                .catch(function (error) {
                                                    KTApp.unblockPage();
                                                    toastr.error(`Error occured with code [SC/ES-501], please contact Administrator!`);
                                                    return console.info(error);
                                                })
                                        }
                                    },
                                }
                            });
                        }
                    },
                    {
                        name: 'click',
                        delegate: '.edit-spesific-element',
                        handler: function (e) {
                            var template = _.template($(`#component-modal-edit-assessment`).html())
                            $("#modal-edit-assessment").html(template({})).promise().done(function () {
                                var counterData = JSON.parse(atob($(e.target).data("counter")));
                                $("#assessmentNameModal").val(counterData.subComponentCounterData.longDesc);
                                $("#assessmentTypeModal").empty();
                                var selectedCounterCategory = counterData.subComponentCounterData.counterCategory;
                                $("#assessmentTypeModal").append(new Option(selectedCounterCategory.description, selectedCounterCategory.id, true, true)).val(selectedCounterCategory.id).trigger('change');
                                if (counterData.subComponentCounterData.dateCounter !== null)
                                    $("#assessmentDateModal").val(moment(new Date(counterData.subComponentCounterData.dateCounter)).locale('en').format("DD-MMM-YYYY"));
                                $(".btn-delete-modal").data("id", counterData.subComponentCounterData.idSubComponentCounter);
                                $("#idCounterModal").val(counterData.subComponentCounterData.idSubComponentCounter);
                                UIkit.modal("#modal-edit-assessment").show();
                            })
                        }
                    },
                    {
                        name: 'mousedown',
                        delegate: '.select-datepicker',
                        handler: function (e) {
                            $(e.target).datepicker({
                                dateFormat: "dd-M-yy",
                                orientation: "bottom left",
                                changeMonth: true,
                                changeYear: true,
                            });
                        }
                    },
                    {
                        name: 'click',
                        delegate: '.btn-delete-assessment',
                        handler: function (e) {
                            $.confirm({
                                title: 'Delete Assessment ?',
                                content: 'Are you sure you want to delete this assessment ?',
                                buttons:
                                {
                                    Cancel: {
                                        text: 'Cancel',
                                        btnClass: 'btn-gray',
                                        action: function () { }
                                    },
                                    OK: {
                                        text: 'Delete',
                                        btnClass: 'btn-danger',
                                        keys: ['enter', 'shift'],
                                        action: async function () {
                                            var paramAssessment = {
                                                IdApprovalWorkflow: settingGlobalScore.idApprovalWorkflow,
                                                IsDeleteAssessment: true,
                                                Assessment: {
                                                    IdCounter: $("#IdCounterAssessment").val(),
                                                }
                                            }
                                            await binus.postReq("/Scoring/UpdateAssessmentScore", paramAssessment)
                                                .then(function (response) {
                                                    if (response.statusCode !== 200) {
                                                        console.info(response);
                                                        return toastr.error(response.message);
                                                    }
                                                    toastr.success("Assessment Deleted Successfully");
                                                    setTimeout(function () {
                                                        $("#filterSubComponent").trigger('change');
                                                        $("#filterCounter").val('All');
                                                        $("#filterCounter").trigger('change');
                                                        $("#btnApply").click();
                                                    }, 1000);
                                                })
                                                .catch(function (error) {
                                                    console.info(error);
                                                    toastr.error(`Error occured with code [S/ES/UAS], please contact administrator`);
                                                })
                                        }
                                    },
                                }
                            });
                        }
                    },
                    {
                        name: 'click',
                        delegate: '.btn-save-assessment',
                        handler: async function (e) {
                            var paramAssessment = {
                                IdApprovalWorkflow: settingGlobalScore.idApprovalWorkflow,
                                IsUpdateAssessment: true,
                                Assessment: {
                                    IdCounter: $("#IdCounterAssessment").val(),
                                    DateCounter: $("#assessmentDate").val(),
                                    IdCounterCategory: $("#assessmentType").val(),
                                    LongDesc: $("#assessmentDescription").val()
                                }
                            }
                            await binus.postReq("/Scoring/UpdateAssessmentScore", paramAssessment)
                                .then(function (response) {
                                    if (response.statusCode !== 200) {
                                        console.info(response);
                                        return toastr.error(response.message);
                                    }
                                    toastr.success("Assessment Updated Successfully");
                                    setTimeout(async function () {
                                        $("#filterSubComponent").empty();
                                        $("#filterCounter").empty();

                                        await components.entry_score.methods.bindInnerDDL("subcomponent");
                                        await components.entry_score.methods.bindInnerDDL("counter", settingGlobalScore.isAddCounter, $("#IdCounterAssessment").val());
                                        $("#btnApply").click();
                                    }, 1000);
                                })
                                .catch(function (error) {
                                    console.info(error);
                                    toastr.error(`Error occured with code [S/ES/UAS], please contact administrator`);
                                })
                        }
                    }
                ],

            }

            components.modal_update_score =
            {
                events:
                    [
                        {
                            name: "click",
                            delegate: ".btn-close-modal",
                            handler: function (e) {
                                UIkit.modal("#modal-update-score").hide();
                            }
                        },
                        {
                            name: "change",
                            delegate: "[name='newscore']",
                            handler: function (e) {
                                if (e.current.type != "radio") {
                                    var id = e.current.attributes.id.value;
                                    if (e.current.type == "select-one" && id.includes("opt")) {
                                        var input = $("input[id='newScore']");
                                        var inputrad = $("input[getId='newScore_radio']");
                                        if (input.length == 1) {
                                            input.val('');
                                        }
                                        else if (inputrad.length > 1){
                                            $("input[getId='newScore_radio']:checked").prop("checked", false);
                                        }
                                        var disabled = false;
                                        if ($(e.current).val()) disabled = true;
                                        if (inputrad.length > 1) $("input[getId='newScore_radio']").prop("disabled", disabled);
                                        else input.prop("disabled", disabled);

                                    }
                                    else {
                                        var codesetting = $("select[id='newScore_opt']");
                                        codesetting.val('');
                                        if ($(e.current).val())
                                            codesetting.prop("disabled", true);
                                        else codesetting.prop("disabled", false);
                                    }
                                }
                            }
                        },
                        {
                            name: "click",
                            delegate: "input[getid='newScore_radio']",
                            handler: function (e) {
                                if (e.srcElement.nodeName == "INPUT") {
                                    let _thisRadio = e.srcElement;
                                    let radioname = e.srcElement.attributes.name.value;
                                    let radio = $("input[name='" + radioname + "']");
                                    if ($(radio).attr('previousValue') == $(_thisRadio).val()) {
                                        $(_thisRadio).prop('checked', false);
                                    }
                                    else {
                                        $(radio).attr('previousValue', 'null');
                                        $(_thisRadio).prop('checked', true);
                                    }
                                    var checkedradio1 = $(_thisRadio).val();
                                    if (!$(_thisRadio).prop('checked'))
                                        checkedradio1 = 'null';
                                    $(radio).attr('previousValue', checkedradio1);
                                    if (!$(_thisRadio).prop('checked')) $("select[id='newScore_opt']").prop("disabled", false);
                                    else $("select[id='newScore_opt']").prop("disabled", true);
                                }
                            }
                        },
                        {
                            name: "change",
                            delegate: "input[name='action-choice']",
                            handler: function (e) {
                                if ($(e.current).val().toLowerCase() === 'delete') {
                                    $("#newScoreDiv").hide();
                                }
                                else {
                                    $("#newScoreDiv").show();
                                }
                            }
                        },
                        {
                            name: 'click',
                            delegate: '#btnEditScore',
                            handler: function (e) {
                                var worfkFlow = _thisDataGlobal.idApprovalWorkflow;
                                var score = $("#formEditscore").serializeArray();
                                var action = _.find(score, function (x) { return x.name == "action-choice" }).value;
                                var idscore = _.find(score, function (x) { return x.name == "idscore" }).value;
                                var idstudent = _.find(score, function (x) { return x.name == "idstudent" }).value;
                                var idcomponent = _.find(score, function (x) { return x.name == "component" }).value;
                                var idsubcomponent = _.find(score, function (x) { return x.name == "subcomponent" }).value;
                                var idsubcomponentcounter = _.find(score, function (x) { return x.name == "counter" }).value;
                                var maxrawscore = _.find(score, function (x) { return x.name == "maxraw" }).value;
                                var rawscore = _.find(score, function (x) { return x.name == "newscore" }).value;
                                var oldrawscore = _.find(score, function (x) { return x.name == "oldrawscore" }).value;
                                var needapprovall = _.find(score, function (x) { return x.name == "needApprovalUpdate" }).value;
                                var needapprovalcodel = _.find(score, function (x) { return x.name == "needCodeApprovalUpdate" }).value;
                                var period = _.find(score, function (x) { return x.name == "period" }).value;
                                var subcomponentmaxscorelength = _.find(score, function (x) { return x.name == "counterlength" }).value;
                                var updateScoreStudent = {
                                    idScore: idscore,
                                    idStudent: idstudent,
                                    idComponent: idcomponent,
                                    idSubComponent: idsubcomponent,
                                    idSubComponentCounter: idsubcomponentcounter,
                                    textScore: isNaN(rawscore) ? rawscore : '',
                                    maxRawScore: maxrawscore,
                                    rawScore: rawscore,
                                    oldTextScore: isNaN(oldrawscore) ? oldrawscore : '',
                                    //oldMaxRawScore: '',
                                    oldRawScore: oldrawscore,
                                    needApprovalUpdate: needapprovall,
                                    needCodeApprovalUpdate: needapprovalcodel,
                                    subComponentMaxScoreLength: subcomponentmaxscorelength,
                                };
                                if ((updateScoreStudent.rawScore === null || updateScoreStudent.rawScore === undefined || updateScoreStudent.rawScore === '') && action.toLowerCase() !== 'delete') {
                                    toastr.error('Please input new score!');
                                    return;
                                }
                                binus.postReq("/Scoring/UpdateCounterScore?workflow=" + worfkFlow + "&comment=" + encodeURIComponent(_.find(score, function (x) { return x.name == "reasonupdate" }).value) + "&status=" + status + "&actionScore=" + action + "&period=" + period, updateScoreStudent)
                                    .then(function (response) {
                                        //return console.log(JSON.stringify(response))
                                        //return
                                        if (response == 200) {
                                            UIkit.modal("#modal-update-score").hide();
                                            toastr.success("Score updated Successfully. It will take approx. 15 Min to calculate Semester Score.");
                                            setTimeout(function () {
                                                $("#btnApply").click();
                                            }, 1000);
                                        }
                                        else {
                                            toastr.error("Error occured when updating");
                                            KTApp.unblockPage();
                                        }
                                    })
                                    .catch(function (data) {
                                        binus.showerror(data);
                                        KTApp.unblockPage;
                                    });
                            }
                        }
                    ]
            }

            components.modal_approval =
            {
                events:
                    [
                        {
                            name: "click",
                            delegate: ".btn-close-modal",
                            handler: function (e) {
                                UIkit.modal("#modal-approval").hide();
                            }
                        },
                        {
                            name: "click",
                            delegate: "#btnApprove",
                            handler: function (e) {
                                var worfkFlow = _thisDataGlobal.idApprovalWorkflow;
                                var score = $("#formComponent").serializeArray();
                                var actionScore = _.find(score, function (x) { return x.name == "action-choice" }).value;
                                var idtranscore = _.find(score, function (x) { return x.name == "transcore" }).value;
                                var idscore = _.find(score, function (x) { return x.name == "idscore" }).value;
                                var idstudent = _.find(score, function (x) { return x.name == "idstudent" }).value;
                                var idcomponent = _.find(score, function (x) { return x.name == "component" }).value;
                                var idsubcomponent = _.find(score, function (x) { return x.name == "subcomponent" }).value;
                                var idsubcomponentcounter = _.find(score, function (x) { return x.name == "counter" }).value;
                                var maxrawscore = _.find(score, function (x) { return x.name == "maxraw" }).value;
                                var rawscore = _.find(score, function (x) { return x.name == "newscore" }).value;
                                var oldrawscore = _.find(score, function (x) { return x.name == "oldrawscore" }).value;
                                var needapprovall = _.find(score, function (x) { return x.name == "needApproval" }).value;
                                var status = needapprovall == "true" ? "yes" : "no";
                                var subcomponentmaxscorelength = _.find(score, function (x) { return x.name == "counterlength" }).value;
                                var note = _.find(score, function (x) { return x.name == "approvalNote" }).value;
                                var approved = _.find(score, function (x) { return x.name == "Level" }).value;
                                var weight = _.find(score, function (x) { return x.name == "weight" }).value;
                                if (rawscore && !isNaN(rawscore) && parseFloat(rawscore) > parseFloat(maxrawscore)) rawscore = (parseFloat(rawscore) * parseFloat(maxrawscore)) / parseFloat(weight);
                                if (oldrawscore && !isNaN(oldrawscore) && parseFloat(oldrawscore) > parseFloat(oldrawscore)) oldrawscore = (parseFloat(oldrawscore) * parseFloat(maxrawscore)) / parseFloat(weight);
                                var approvalUpdateScoreStudent = {
                                    idTransactionScore: idtranscore,
                                    idScore: idscore,
                                    idStudent: idstudent,
                                    idComponent: idcomponent,
                                    idSubComponent: idsubcomponent,
                                    idSubComponentCounter: idsubcomponentcounter,
                                    textScore: isNaN(rawscore) ? rawscore : '',
                                    maxRawScore: maxrawscore,
                                    rawScore: rawscore ? rawscore : (oldrawscore ? oldrawscore : 0),
                                    oldTextScore: isNaN(oldrawscore) ? oldrawscore : '',
                                    oldMaxRawScore: '',
                                    oldRawScore: oldrawscore,
                                    needApproval: needapprovall,
                                    subComponentMaxScoreLength: subcomponentmaxscorelength
                                };
                                binus.postReq("/Scoring/ApprovalUpdateScore?workflow=" + worfkFlow + "&note=" + note + "&status=" + status + "&actionScore=" + approved, approvalUpdateScoreStudent)
                                    .then(function (response) {
                                        if (response == 200) {
                                            UIkit.modal("#modal-approval").hide();
                                            if (approved == 1)
                                                toastr.success("Approval sent");
                                            else if (approved == 2)
                                                toastr.success("Approval rejected");
                                            setTimeout(function () {
                                                $("#btnApply").click();
                                            }, 1000);
                                        }
                                        else {
                                            toastr.error("Error occured when updating");
                                            KTApp.unblockPage();
                                        }
                                    })
                                    .catch(function (data) {
                                        binus.showerror(data);
                                        KTApp.unblockPage;
                                    });
                            }
                        },
                    ]
            }

            components.modal_edit_assessment = {
                connected: function () {
                    $("#modal-edit-assessment").on("shown.bs.modal", function () {
                        $("#formAssessmentUpdate").validate({
                            errorElement: "em",
                            errorPlacement: function (error, element) {
                                var placement = $(element).data('error');
                                if (placement) {
                                    $(placement).append(error)
                                } else {
                                    error.insertAfter(element);
                                }
                            }
                        })
                    })
                },
                events: [
                    {
                        name: "click",
                        delegate: ".btn-close-modal",
                        handler: function (e) {
                            UIkit.modal("#modal-edit-assessment").hide();
                        }
                    },
                    {
                        name: 'mousedown',
                        delegate: '.select-datepicker',
                        handler: function (e) {
                            moment.locale('en');
                            $(e.target).daterangepicker({
                                showDropdowns: true,
                                singleDatePicker: true,
                                autoApply: true,
                                locale: {
                                    format: "DD-MMM-YYYY"
                                }
                            }, function (start, end, label) {
                                $(this.element).val(start.format('DD-MMM-YYYY'))
                            });
                        }
                    },
                    {
                        name: 'click',
                        delegate: '.btn-delete-modal',
                        handler: function (e) {
                            $.confirm({
                                    title: 'Delete Assessment ?',
                                    content: 'Are you sure you want to delete this assessment ?',
                                    buttons:
                                    {
                                        Cancel: {
                                            text: 'Cancel',
                                            btnClass: 'btn-gray',
                                            action: function() { }
                                        },
                                        OK: {
                                            text: 'Delete',
                                            btnClass: 'btn-danger',
                                            keys: ['enter', 'shift'],
                                            action: async function () {
                                                var id = $(e.target).data('id');
                                                var dataAssessment = $("#formAssessmentUpdate").serializeJSON();
                                                dataAssessment.AssessmentDateModal = moment(new Date(dataAssessment.AssessmentDateModal)).locale('en').format("YYYY-MM-DD");
                                                var param = {
                                                    IdApprovalWorkflow: settingGlobalScore.idApprovalWorkflow,
                                                    IsDeleteAssessment: true,
                                                    Assessment: {
                                                        IdCounter: dataAssessment.IdCounter,
                                                    }
                                                }
                                                await binus.postReq("/Scoring/UpdateAssessmentScore", param)
                                                    .then(function (response) {
                                                        if (response.statusCode !== 200) {
                                                            return toastr.error(response.message);
                                                        }
                                                        UIkit.modal("#modal-edit-assessment").hide();
                                                        toastr.success("Assessment Deleted Successfully");
                                                        $("#filterSubComponent").trigger('change');
                                                        $("#btnApply").click();
                                                    })
                                                    .catch(function (error) {
                                                        console.info(error);
                                                        toastr.error(`Error occured with code [S/ES/UAS], please contact administrator`);
                                                    })
                                            }
                                        },
                                    }
                                });
                        }
                    },
                    {
                        name: 'click',
                        delegate: '.btn-save-modal',
                        handler: async function (e) {
                            if (!$("#formAssessmentUpdate").valid()) return;
                            var dataAssessment = $("#formAssessmentUpdate").serializeJSON();
                            dataAssessment.AssessmentDateModal = moment(new Date(dataAssessment.AssessmentDateModal)).locale('en').format("YYYY-MM-DD");
                            var param = {
                                IdApprovalWorkflow: settingGlobalScore.idApprovalWorkflow,
                                IsUpdateAssessment: true,
                                Assessment: {
                                    IdCounter: dataAssessment.IdCounter,
                                    DateCounter: dataAssessment.AssessmentDateModal,
                                    IdCounterCategory: dataAssessment.AssessmentTypeModal,
                                    LongDesc: dataAssessment.AssessmentNameModal
                                }
                            }
                            await binus.postReq("/Scoring/UpdateAssessmentScore", param)
                                .then(function (response) {
                                    if (response.statusCode !== 200) {
                                        return toastr.error(response.message);
                                    }
                                    toastr.success("Assessment Updated Successfully");
                                    UIkit.modal("#modal-edit-assessment").hide();
                                    $("#filterSubComponent").trigger('change');
                                    $("#btnApply").click();
                                })
                                .catch(function (error) {
                                    console.info(error);
                                    toastr.error(`Error occured with code [S/ES/UAS], please contact administrator`);
                                })
                        }
                    }
                ]
            }


            UIkit.component("entry_score", components.entry_score);
            UIkit.component("modal_update_score", components.modal_update_score);
            UIkit.component("modal_approval", components.modal_approval);
            UIkit.component("modal_edit_assessment", components.modal_edit_assessment);

            var setDropdown = (id, arr, selectedVal, placeholder) => {
                var option = new Option("", "", false, false);
                $("#" + id).append(option);
                _.each(arr, function (val, key) {
                    var selected = selectedVal == null ? (key == 0 ? true : false) : (selectedVal == val.id ? true : false)
                    var option = new Option(val.description, val.id, selected, selected);
                    $(option).html(val.description);
                    if (id === 'filterSubject') $(option).attr('iscla', val.isSubjectCLA);
                    $("#" + id).append(option);
                });
                $("#" + id).select2({
                    placeholder: 'Search ' + placeholder
                })
                $("#" + id).attr("disabled", false);
                $(".select2").width("100%");
            }

            $("#filterLevel").on('change', function () {
                $("#filterSemester").empty();
                $("#filterTerm").empty();
                $("#filterStreaming").empty();
                $("#filterSubjectType").empty();
                $("#filterSubject").empty();
                $("#filterSubjectLevel").empty();
                $("#filterClassID").empty();
                $("#filterComponent").empty();
                $("#filterSubComponent").empty();
                $("#filterCounter").empty();

                $("#filterSemester").attr("disabled", true);
                $("#filterTerm").attr("disabled", true);
                $("#filterStreaming").attr("disabled", true);
                $("#filterSubjectType").attr("disabled", true);
                $("#filterSubject").attr("disabled", true);
                $("#filterSubjectLevel").attr("disabled", true);
                $("#filterClassID").attr("disabled", true);
                $("#filterComponent").attr("disabled", true);
                $("#filterSubComponent").attr("disabled", true);
                $("#filterCounter").attr("disabled", true);

                $("#filterGrade").empty();
                let _this = UIkit.getComponent(UIkit.util.$("#entry_score"), "entry_score");

                $.ajax({
                    contentType: 'application/json',
                    type: 'POST',
                    async: false,
                    url: "/Scoring/Grade?idLevel=" + $("#filterLevel").val(),
                    data: JSON.stringify(_this._dropdownsetting),
                    dataType: 'json',
                    success: function (response2) {
                        var option = new Option("", "", false, false);
                        $("#filterGrade").append(option);
                        _.each(response2, function (val, key) {
                            var selected = key == 0 ? true : false
                            var option = new Option(val.description, val.id, selected, selected);
                            $(option).html(val.description);
                            $("#filterGrade").append(option);
                        });
                        $("#filterGrade").select2({
                            placeholder: 'Search Grade'
                        });
                        $("#filterGrade").attr("disabled", false);
                        $(".select2").width("100%");
                        $("#filterGrade").trigger('change');
                    }
                });

            });
            $("#filterGrade").on('change', function () {
                $("#filterTerm").empty();
                $("#filterStreaming").empty();
                $("#filterSubjectType").empty();
                $("#filterSubject").empty();
                $("#filterSubjectLevel").empty();
                $("#filterClassID").empty();
                $("#filterComponent").empty();
                $("#filterSubComponent").empty();
                $("#filterCounter").empty();

                $("#filterTerm").attr("disabled", true);
                $("#filterStreaming").attr("disabled", true);
                $("#filterSubjectType").attr("disabled", true);
                $("#filterSubject").attr("disabled", true);
                $("#filterSubjectLevel").attr("disabled", true);
                $("#filterClassID").attr("disabled", true);
                $("#filterComponent").attr("disabled", true);
                $("#filterSubComponent").attr("disabled", true);
                $("#filterCounter").attr("disabled", true);

                $("#filterSemester").empty();

                let _this = UIkit.getComponent(UIkit.util.$("#entry_score"), "entry_score");

                //$.ajax({
                //    contentType: 'application/json',
                //    type: 'POST',
                //    async: false,
                //    url: "/Scoring/Semester?idLevel=" + $("#filterLevel").val() + "&idGrade=" + $("#filterGrade").val(),
                //    data: JSON.stringify(_this._dropdownsetting),
                //    dataType: 'json',
                //    success: function (response2) {
                //        var option = new Option("", "", false, false);
                //        $("#filterSemester").append(option);
                //        _.each(response2, function (val, key) {
                //            var selected = key == 0 ? true : false
                //            var option = new Option(val.description, val.id, selected, selected);
                //            $(option).html(val.description);
                //            $("#filterSemester").append(option);
                //        });
                //        $("#filterSemester").select2({
                //            placeholder: 'Search Semester'
                //        });
                //        $("#filterSemester").attr("disabled", false);
                //        $(".select2").width("100%");
                //        $("#filterSemester").trigger('change');
                //    }
                //});
                $.ajax({
                    contentType: 'application/json',
                    type: 'POST',
                    async: false,
                    url: "/Scoring/Semester?idGrade=" + $("#filterGrade").val(),
                    data: JSON.stringify(_this._dropdownsetting),
                    dataType: 'json',
                    success: function (response2) {
                        if (_this._viewModel == null) {
                            setDropdown("filterSemester", response2, null, "Semester")
                        }
                        else {
                            setDropdown("filterSemester", response2, _this._viewModel.semester, "Semester")
                        }
                        $("#filterSemester").trigger('change');
                    }
                });
            });
            $("#filterSemester").on('change', function () {
                $("#filterStreaming").empty();
                $("#filterSubjectType").empty();
                $("#filterSubject").empty();
                $("#filterSubjectLevel").empty();
                $("#filterClassID").empty();
                $("#filterComponent").empty();
                $("#filterSubComponent").empty();
                $("#filterCounter").empty();

                $("#filterStreaming").attr("disabled", true);
                $("#filterSubjectType").attr("disabled", true);
                $("#filterSubject").attr("disabled", true);
                $("#filterSubjectLevel").attr("disabled", true);
                $("#filterClassID").attr("disabled", true);
                $("#filterComponent").attr("disabled", true);
                $("#filterSubComponent").attr("disabled", true);
                $("#filterCounter").attr("disabled", true);

                $("#filterTerm").empty();

                let _this = UIkit.getComponent(UIkit.util.$("#entry_score"), "entry_score");

                //$.ajax({
                //    contentType: 'application/json',
                //    type: 'POST',
                //    async: false,
                //    url: "/Scoring/Term?idLevel=" + $("#filterLevel").val() + "&idGrade=" + $("#filterGrade").val() + "&semester=" + $("#filterSemester").val(),
                //    data: JSON.stringify(_this._dropdownsetting),
                //    dataType: 'json',
                //    success: function (response2) {
                //        var option = new Option("", "", false, false);
                //        $("#filterTerm").append(option);
                //        _.each(response2, function (val, key) {
                //            var selected = key == 0 ? true : false
                //            var option = new Option(val.description, val.id, selected, selected);
                //            $(option).html(val.description);
                //            $("#filterTerm").append(option);
                //        });
                //        $("#filterTerm").select2({
                //            placeholder: 'Search Term'
                //        });
                //        $("#filterTerm").attr("disabled", false);
                //        $(".select2").width("100%");
                //        $("#filterTerm").trigger('change');
                //    }
                //});
                $.ajax({
                    contentType: 'application/json',
                    type: 'POST',
                    async: false,
                    url: "/Scoring/Term?idGrade=" + $("#filterGrade").val() + "&semester=" + $("#filterSemester").val(),
                    data: JSON.stringify(_this._dropdownsetting),
                    dataType: 'json',
                    success: function (response2) {
                        if (_this._viewModel == null) {
                            setDropdown("filterTerm", response2, null, "Term")
                        }
                        else {
                            setDropdown("filterTerm", response2, _this._viewModel.term, "Term")
                        }
                        $("#filterTerm").trigger('change');
                    }
                });
            });
            $("#filterTerm").on('change', function () {
                $("#filterSubjectType").empty();
                $("#filterSubject").empty();
                $("#filterSubjectLevel").empty();
                $("#filterClassID").empty();
                $("#filterComponent").empty();
                $("#filterSubComponent").empty();
                $("#filterCounter").empty();

                $("#filterSubjectType").attr("disabled", true);
                $("#filterSubject").attr("disabled", true);
                $("#filterSubjectLevel").attr("disabled", true);
                $("#filterClassID").attr("disabled", true);
                $("#filterComponent").attr("disabled", true);
                $("#filterSubComponent").attr("disabled", true);
                $("#filterCounter").attr("disabled", true);

                //$("#filterStreaming").empty();
                $("#filterSubject").empty();

                let _this = UIkit.getComponent(UIkit.util.$("#entry_score"), "entry_score");
                $.ajax({
                    contentType: 'application/json',
                    type: 'POST',
                    async: false,
                    url: "/Scoring/Subject?idGrade=" + $("#filterGrade").val() + "&semester=" + $("#filterSemester").val() + "&idTerm=" + $("#filterTerm").val(),
                    data: JSON.stringify(_this._dropdownsetting),
                    dataType: 'json',
                    success: function (response2) {
                        if (_this._viewModel == null) {
                            setDropdown("filterSubject", response2, null, "Subject")
                        }
                        else {
                            setDropdown("filterSubject", response2, _this._viewModel.subject, "Subject")
                        }
                        $("#filterSubject").trigger('change');
                    }
                });
                //$.ajax({
                //    contentType: 'application/json',
                //    type: 'POST',
                //    async: false,
                //    url: "/Scoring/Streaming?idLevel=" + $("#filterLevel").val() + "&idGrade=" + $("#filterGrade").val() + "&semester=" + $("#filterSemester").val() + "&idTerm=" + $("#filterTerm").val(),
                //    data: JSON.stringify(_this._dropdownsetting),
                //    dataType: 'json',
                //    success: function (response2) {
                //        var option = new Option("", "", false, false);
                //        $("#filterStreaming").append(option);
                //        _.each(response2, function (val, key) {
                //            var selected = key == 0 ? true : false
                //            var option = new Option(val.description, val.id, selected, selected);
                //            $(option).html(val.description);
                //            $("#filterStreaming").append(option);
                //        });
                //        $("#filterStreaming").select2({
                //            placeholder: 'Search Streaming'
                //        });
                //        $("#filterStreaming").attr("disabled", false);
                //        $(".select2").width("100%");
                //    }
                //});
            });
            $("#filterStreaming").on('change', function () {
                $("#filterSubject").empty();
                $("#filterSubjectLevel").empty();
                $("#filterClassID").empty();
                $("#filterComponent").empty();
                $("#filterSubComponent").empty();
                $("#filterCounter").empty();

                $("#filterSubject").attr("disabled", true);
                $("#filterSubjectLevel").attr("disabled", true);
                $("#filterClassID").attr("disabled", true);
                $("#filterComponent").attr("disabled", true);
                $("#filterSubComponent").attr("disabled", true);
                $("#filterCounter").attr("disabled", true);

                $("#filterSubjectType").empty();

                let _this = UIkit.getComponent(UIkit.util.$("#entry_score"), "entry_score");

                $.ajax({
                    contentType: 'application/json',
                    type: 'POST',
                    async: false,
                    url: "/Scoring/SubjectType?idLevel=" + $("#filterLevel").val() + "&idGrade=" + $("#filterGrade").val() + "&semester=" + $("#filterSemester").val() + "&idTerm=" + $("#filterTerm").val() + "&idStreaming=" + $("#filterStreaming").val(),
                    data: JSON.stringify(_this._dropdownsetting),
                    dataType: 'json',
                    success: function (response2) {
                        var option = new Option("", "", false, false);
                        $("#filterSubjectType").append(option);
                        _.each(response2, function (val, key) {
                            var option = new Option(val.description, val.id, false, false);
                            $(option).html(val.description);
                            $("#filterSubjectType").append(option);
                        });
                        $("#filterSubjectType").select2({
                            placeholder: 'Search Subject Type'
                        });
                        $("#filterSubjectType").attr("disabled", false);
                        $(".select2").width("100%");
                    }
                });
            });
            $("#filterSubjectType").on('change', function () {
                $("#filterSubjectLevel").empty();
                $("#filterClassID").empty();
                $("#filterComponent").empty();
                $("#filterSubComponent").empty();
                $("#filterCounter").empty();

                $("#filterSubjectLevel").attr("disabled", true);
                $("#filterClassID").attr("disabled", true);
                $("#filterComponent").attr("disabled", true);
                $("#filterSubComponent").attr("disabled", true);
                $("#filterCounter").attr("disabled", true);

                $("#filterSubject").empty();

                let _this = UIkit.getComponent(UIkit.util.$("#entry_score"), "entry_score");

                $.ajax({
                    contentType: 'application/json',
                    type: 'POST',
                    async: false,
                    url: "/Scoring/Subject?idLevel=" + $("#filterLevel").val() + "&idGrade=" + $("#filterGrade").val() + "&semester=" + $("#filterSemester").val() + "&idTerm=" + $("#filterTerm").val() + "&idStreaming=" + $("#filterStreaming").val() + "&idSubjectType=" + $("#filterSubjectType").val(),
                    data: JSON.stringify(_this._dropdownsetting),
                    dataType: 'json',
                    success: function (response2) {
                        var option = new Option("", "", false, false);
                        $("#filterSubject").append(option);
                        _.each(response2, function (val, key) {
                            var option = new Option(val.description, val.id, false, false);
                            $(option).html(val.description);
                            $(option).attr('data-iscla', val.isSubjectCLA)
                            $("#filterSubject").append(option);
                        });
                        $("#filterSubject").select2({
                            placeholder: 'Search Subject'
                        });
                        $("#filterSubject").attr("disabled", false);
                        $(".select2").width("100%");
                    }
                });
            });
            $("#filterSubject").on('change', function () {
                $("#filterComponent").empty();
                $("#filterSubComponent").empty();
                $("#filterCounter").empty();

                $("#filterComponent").attr("disabled", true);
                $("#filterSubComponent").attr("disabled", true);
                $("#filterCounter").attr("disabled", true);

                $("#filterSubjectLevel").empty();
                $("#filterClassID").empty();
                //if (false)
                //    $("#filterClassID").attr("disabled", true);

                let _this = UIkit.getComponent(UIkit.util.$("#entry_score"), "entry_score");

                //$.ajax({
                //    contentType: 'application/json',
                //    type: 'POST',
                //    async: false,
                //    url: "/Scoring/SubjectLevel?idLevel=" + $("#filterLevel").val() + "&idGrade=" + $("#filterGrade").val() + "&semester=" + $("#filterSemester").val() + "&idTerm=" + $("#filterTerm").val() + "&idStreaming=" + $("#filterStreaming").val() + "&idSubjectType=" + $("#filterSubjectType").val() + "&idSubject=" + $("#filterSubject").val(),
                //    data: JSON.stringify(_this._dropdownsetting),
                //    dataType: 'json',
                //    success: function (response2) {
                //        var option = new Option("", "", false, false);
                //        $("#filterSubjectLevel").append(option);
                //        _.each(response2, function (val, key) {
                //            var option = new Option(val.description, val.id, false, false);
                //            $(option).html(val.description);
                //            $("#filterSubjectLevel").append(option);
                //        });
                //        $("#filterSubjectLevel").select2({
                //            placeholder: 'Search Subject Level'
                //        });
                //        $("#filterSubjectLevel").attr("disabled", false);
                //        $(".select2").width("100%");
                //    }
                //});
                if (!$(this).attr('data-iscla'))
                    //$.ajax({
                    //    contentType: 'application/json',
                    //    type: 'POST',
                    //    async: false,
                    //    url: "/Scoring/ClassID?idLevel=" + $("#filterLevel").val() + "&idGrade=" + $("#filterGrade").val() + "&semester=" + $("#filterSemester").val() + "&idTerm=" + $("#filterTerm").val() + "&idStreaming=" + $("#filterStreaming").val() + "&idSubjectType=" + $("#filterSubjectType").val() + "&idSubject=" + $("#filterSubject").val() + "&idSubjectLevel=",
                    //    data: JSON.stringify(_this._dropdownsetting),
                    //    dataType: 'json',
                    //    success: function (response2) {
                    //        var option = new Option("", "", false, false);
                    //        $("#filterClassID").append(option);
                    //        _.each(response2, function (val, key) {
                    //            var option = new Option(val.description, val.id, false, false);
                    //            $(option).html(val.description);
                    //            $("#filterClassID").append(option);
                    //        });
                    //        $("#filterClassID").select2({
                    //            placeholder: 'Search Class ID'
                    //        });
                    //        $("#filterClassID").attr("disabled", false);
                    //        $(".select2").width("100%");
                    //    }
                    //});
                    $.ajax({
                        contentType: 'application/json',
                        type: 'POST',
                        async: false,
                        url: "/Scoring/ClassID?idGrade=" + $("#filterGrade").val() + "&semester=" + $("#filterSemester").val() + "&idTerm=" + $("#filterTerm").val() + "&idSubject=" + $("#filterSubject").val(),
                        data: JSON.stringify(_this._dropdownsetting),
                        dataType: 'json',
                        success: function (response2) {
                            if (_this._viewModel == null) {
                                setDropdown("filterClassID", response2, null, "Homeroom / Class")
                            }
                            else {
                                setDropdown("filterClassID", response2, _this._viewModel.classId, "Homeroom / Class")
                            }
                            $("#filterClassID").trigger('change');
                        }
                    });
                else {
                    IsCurrentCLA = true
                }

            });
            $("#filterSubjectLevel").on('change', function () {
                $("#filterComponent").empty();
                $("#filterSubComponent").empty();
                $("#filterCounter").empty();

                $("#filterComponent").attr("disabled", true);
                $("#filterSubComponent").attr("disabled", true);
                $("#filterCounter").attr("disabled", true);

                $("#filterClassID").empty();

                let _this = UIkit.getComponent(UIkit.util.$("#entry_score"), "entry_score");

                if (!IsCurrentCLA)
                    $.ajax({
                        contentType: 'application/json',
                        type: 'POST',
                        async: false,
                        url: "/Scoring/ClassID?idLevel=" + $("#filterLevel").val() + "&idGrade=" + $("#filterGrade").val() + "&semester=" + $("#filterSemester").val() + "&idTerm=" + $("#filterTerm").val() + "&idStreaming=" + $("#filterStreaming").val() + "&idSubjectType=" + $("#filterSubjectType").val() + "&idSubject=" + $("#filterSubject").val() + "&idSubjectLevel=" + $("#filterSubjectLevel").val(),
                        data: JSON.stringify(_this._dropdownsetting),
                        dataType: 'json',
                        success: function (response2) {
                            var option = new Option("", "", false, false);
                            $("#filterClassID").append(option);
                            _.each(response2, function (val, key) {
                                var option = new Option(val.description, val.id, false, false);
                                $(option).html(val.description);
                                $("#filterClassID").append(option);
                            });
                            $("#filterClassID").select2({
                                placeholder: 'Search Class ID'
                            });
                            $("#filterClassID").attr("disabled", false);
                            $(".select2").width("100%");
                        }
                    });
                else {
                    IsCurrentCLA = false
                    $.ajax({
                        contentType: 'application/json',
                        type: 'GET',
                        async: false,
                        url: "/Scoring/CAGetClassIDAsync?Grade=" + + $("#filterGrade").val() + "&Subject=" + $("#filterSubject").val() + "&SubjectLevel=" + $("#filterSubjectLevel").val(),
                        //data: JSON.stringify(_this._dropdownsetting),
                        dataType: 'json',
                        success: function (response2) {
                            //console.log(response2)
                            //var option = new Option("", "", false, false);
                            //$("#filterClassID").append(option);
                            //_.each(response2, function (val, key) {
                            //    var option = new Option(val.description, val.id, false, false);
                            //    $(option).html(val.description);
                            //    $("#filterClassID").append(option);
                            //});
                            //$("#filterClassID").select2({
                            //    placeholder: 'Search Class ID'
                            //});
                            //$("#filterClassID").attr("disabled", false);
                            //$(".select2").width("100%");
                        }
                    });
                }
            });
            $("#filterClassID").on('change', function () {
                $("#btnApply").prop("disabled", false);
                $("#filterComponent").empty();
                $("#filterSubComponent").empty();
                $("#filterCounter").empty();
                let isSubjectCla = $("#filterSubject").find(':selected').attr('isCla');
                var paramScoreSetting = {
                    Term: $("#filterTerm").val(),
                    Subject: $("#filterSubject").val().split('/')[0],
                    //SubjectLevel: $("#filterSubjectLevel").val(),
                    //SubjectLevel: isSubjectCla === 'true' ? '' : $("#filterSubject").val().split('/')[1],
                    SubjectLevel: $("#filterSubject").val().split('/')[1],
                }
                //var paramScoreSetting = {
                //    Subject: "11BI",
                //    Term: "P_2020_11",
                //    SubjectLevel: "",
                //}
                binus.getReq("/Scoring/ScoreSetting", paramScoreSetting)
                    .then(function (response) {
                        //if (response == "EMPTY") {
                        //    toastr.error("Subject Score Setting not set yet");
                        //    $("#btnApply").prop("disabled", true);
                        //    KTApp.unblockPage();
                        //    return;
                        //}
                        settingGlobalScore.IsScoreInOneGo = response.isScoreInOneGo;
                        settingGlobalScore.idApprovalWorkflow = response.idApprovalWorkflow;
                        settingGlobalScore.codeList = "";
                        _.each(response.scoreAdditionalCodeList, function (val, key) {
                            var optionCodeList = "<option value='" + val.key + "'>";
                            optionCodeList += val.longDesc;
                            optionCodeList += "</option>";
                            settingGlobalScore.codeList += optionCodeList;
                        });
                        settingGlobalScore.codeListObject = response.scoreAdditionalCodeList;
                        settingGlobalScore.isAddCounter = response.canAddCounter;
                        settingGlobalScore.periodLabel = response.periodLabel;
                        settingGlobalScore.inPeriod = response.inPeriod;
                        settingGlobalScore.enableTeacherJudgement = response.enableTeacherJudgement;
                        settingGlobalScore.showCodeOption = response.showCodeOption;
                        settingGlobalScore.needChangeApproval = response.needChangeApproval;
                        settingGlobalScore.isProrateScore = response.isProrateScore;
                        settingGlobalScore.enablePredictedGrade = response.enablePredictedGrade;
                        settingGlobalScore.SubjectScoreLegendList = response.subjectScoreLegendList;
                        settingGlobalScore.enableDeleteAllScore = response.enableDeleteAllScore;
                        settingGlobalScore.needChangeCodeApproval = response.needChangeCodeApproval;
                        settingGlobalScore.needDeleteApproval = response.needDeleteApproval;
                        settingGlobalScore.needEntryApproval = response.needEntryApproval;
                        settingGlobalScore.needEntryCodeApproval = response.needEntryCodeApproval;
                        settingGlobalScore.updatePeriod = response.updatePeriod;
                        settingGlobalScore.isLocked = response.isLocked;
                        $("#filterComponent").attr("disabled", false);
                        $("#filterSubComponent").attr("disabled", false);
                        $("#filterCounter").attr("disabled", false);
                        let _this = UIkit.getComponent(UIkit.util.$("#entry_score"), "entry_score");
                        _this.bindInnerDDL("component")
                        //components.entry_score.methods.bindInnerDDL("subcomponent");
                        //components.entry_score.methods.bindInnerDDL("counter", settingGlobalScore.isAddCounter);
                    }).catch(function (data) {
                        binus.showerror(data)
                        KTApp.unblockPage();
                    });
            });
            $("#filterComponent").on('change', function () {
                $("#filterSubComponent").empty();
                $("#filterCounter").empty();

                components.entry_score.methods.bindInnerDDL("subcomponent");
                components.entry_score.methods.bindInnerDDL("counter", settingGlobalScore.isAddCounter);
            });
            $("#filterSubComponent").on('change', function () {

                $("#filterCounter").empty();

                components.entry_score.methods.bindInnerDDL("counter", settingGlobalScore.isAddCounter);
            });

        });

        function CheckOther(studentID, period) {
            var subM = "", compM = "", total = 0, totalComp = 0, countTemp = 0, maxTemp = 0, countSub = 0, weightTemp = "", radiobuttonbefore = "", lastCounter, countCounter = 0, lastaveragecounterscore = '';
            let prorateArray = [];
            let SubweightSum = 0;
            let valueNotNullBefore = false
            $('[name^="Score,' + studentID).each(function (key, score) {
                var scoreID = $(score).attr('name').split(",");
                var studentID = scoreID[1];
                var counterID = scoreID[2];
                var sub = scoreID[3];
                var comp = scoreID[4];
                var averageCounterScore = $("input[class='hid," + studentID + "," + sub + "," + counterID + ",averageCounter']").val();
                lastaveragecounterscore = averageCounterScore;
                var averageSubCounterScore = $("input[class='hid," + studentID + "," + sub + "," + counterID + ",averageSub']").val();
                lastaveragesubcounterscore = averageSubCounterScore;
                if (subM) {
                    if (subM != sub) {
                        var afterValidateTotalCounter;
                        if (averageCounterScore != 1)
                            afterValidateTotalCounter = countTemp;
                        else afterValidateTotalCounter = countTemp / countCounter;
                        if(maxTemp == 0) maxTemp = 1
                        if (!_thisData.isProrateScore || (_thisData.isProrateScore && afterValidateTotalCounter > 0))
                            total += ((afterValidateTotalCounter / maxTemp) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
                        if (compM != comp) {
                            var afterValidateTotalSub;
                            if (averageSubCounterScore != 1) {
                                afterValidateTotalSub = total;
                            }
                            else afterValidateTotalSub = total / countSub;
                            totalComp += afterValidateTotalSub;
                            compM = comp;
                            countSub = 1;
                            total = 0;
                        }
                        else countSub++;
                        //total += ((countTemp / maxTemp) * weightTemp);
                        subM = sub;
                        countTemp = 0;
                        maxTemp = 0;
                        countCounter = 0;
                        weightTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                    }
                }
                else {
                    compM = comp;
                    counterBefore = scoreID[2];
                    subM = sub;
                    countTemp = 0;
                    maxTemp = 0;
                    //countCounter++;
                    countSub++;
                    weightTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                }
                if ($(score).is('select')) {
                    radiobuttonbefore = "";
                    if (parseFloat(findMaxValue(score)) > 0) {
                        let valueTemporary = (parseFloat($(score).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())
                        if (!isNaN(valueTemporary)) {
                            if ($(score).val() && parseFloat($(score).val()) > 0) countTemp += (parseFloat($(score).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                            if ($(score).val()) valueNotNullBefore = true
                        }
                        if (!_thisData.isProrateScore || (_thisData.isProrateScore && $(score).val() && parseFloat($(score).val()) > 0)) {
                            if (_thisData.isProrateScore) {
                                let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                if (temp) {
                                    let subTemp = temp.subCompData.find(x => x.subComp == subM);
                                    if (subTemp) {
                                        let toProrateArray =
                                        {
                                            'score': ((parseFloat($(score).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())),
                                        }
                                            ;
                                        prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == subM).val.push(toProrateArray);
                                    }
                                    else {
                                        let toProrateArray = {
                                            'subComp': subM,
                                            'averageCounter': averageCounterScore,
                                            'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                            'val': [
                                                {
                                                    'score': ((parseFloat($(score).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())),
                                                }
                                            ]
                                        }
                                        prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                    }
                                }
                                else {
                                    let toProrateArray = {
                                        'comp': compM,
                                        'averageSubComp': averageSubCounterScore,
                                        'subCompData': [
                                            {
                                                'subComp': subM,
                                                'averageCounter': averageCounterScore,
                                                'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                'val': [
                                                    {
                                                        'score': ((parseFloat($(score).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())),
                                                    }
                                                ]
                                            }
                                        ]
                                    };
                                    prorateArray.push(toProrateArray);
                                }
                                SubweightSum += parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val());
                            }
                            if (averageCounterScore != 1)
                                maxTemp += parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                            else
                                maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                            //weightTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] +  ",weight").val());
                            countCounter++;
                        }
                    }
                }
                else if (score.type == "radio") {
                    if (!radiobuttonbefore) {
                        radiobuttonbefore = scoreID.join(",");
                        var radValue = $("input[name='" + radiobuttonbefore + "']:checked").val();
                        let valueTemporary = (parseFloat(radValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())
                        if (!isNaN(valueTemporary)) {
                            if (radValue) countTemp += (parseFloat(radValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                            if (radValue) valueNotNullBefore = true
                        }
                        if (!_thisData.isProrateScore || (_thisData.isProrateScore && radValue)) {
                            if (_thisData.isProrateScore) {
                                let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                if (temp) {
                                    let subTemp = temp.subCompData.find(x => x.subComp == subM);
                                    if (subTemp) {
                                        let toProrateArray =
                                        {
                                            'score': (parseFloat(radValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())
                                        }
                                            ;
                                        prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == subM).val.push(toProrateArray);
                                    }
                                    else {
                                        let toProrateArray = {
                                            'subComp': subM,
                                            'averageCounter': averageCounterScore,
                                            'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                            'val': [
                                                {
                                                    'score': (parseFloat(radValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())
                                                }
                                            ]
                                        }
                                        prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                    }
                                }
                                else {
                                    let toProrateArray = {
                                        'comp': compM,
                                        'averageSubComp': averageSubCounterScore,
                                        'subCompData': [
                                            {
                                                'subComp': subM,
                                                'averageCounter': averageCounterScore,
                                                'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                'val': [
                                                    {
                                                        'score': (parseFloat(radValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())
                                                    }
                                                ]
                                            }
                                        ]
                                    };
                                    prorateArray.push(toProrateArray);
                                }
                                SubweightSum += parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val());
                            }
                            if (averageCounterScore != 1)
                                maxTemp += parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                            else
                                maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                            //weightTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] +  ",weight").val());
                            countCounter++;
                        }
                    }
                    if (radiobuttonbefore != scoreID.join(",")) {
                        radiobuttonbefore = scoreID.join(",");
                        var radValue = $("input[name='" + radiobuttonbefore + "']:checked").val();
                        let valueTemporary = (parseFloat(radValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())
                        if (!isNaN(valueTemporary)) {
                            if (radValue) countTemp += (parseFloat(radValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                            if (radValue) valueNotNullBefore = true
                        }
                        if (!_thisData.isProrateScore || (_thisData.isProrateScore && radValue)) {
                            if (_thisData.isProrateScore) {
                                let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                                if (temp) {
                                    let subTemp = temp.subCompData.find(x => x.subComp == subM);
                                    if (subTemp) {
                                        let toProrateArray =
                                        {
                                            'score': (parseFloat(radValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())
                                        }
                                            ;
                                        prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == subM).val.push(toProrateArray);
                                    }
                                    else {
                                        let toProrateArray = {
                                            'subComp': subM,
                                            'averageCounter': averageCounterScore,
                                            'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                            'val': [
                                                {
                                                    'score': (parseFloat(radValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())
                                                }
                                            ]
                                        }
                                        prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                    }
                                }
                                else {
                                    let toProrateArray = {
                                        'comp': compM,
                                        'averageSubComp': averageSubCounterScore,
                                        'subCompData': [
                                            {
                                                'subComp': subM,
                                                'averageCounter': averageCounterScore,
                                                'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                                'val': [
                                                    {
                                                        'score': (parseFloat(radValue) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())
                                                    }
                                                ]
                                            }
                                        ]
                                    };
                                    prorateArray.push(toProrateArray);
                                }
                                SubweightSum += parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val());
                            }
                            if (averageCounterScore != 1)
                                maxTemp += parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                            else
                                maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                            //weightTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] +  ",weight").val());
                            countCounter++;
                        }
                    }
                }
                else if (score.type == "text") {
                    radiobuttonbefore = "";
                    if ($(score).val() != '') {
                        let valueTemporary = (parseFloat($(score).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())
                        if (!isNaN(valueTemporary)) {
                            countTemp += (parseFloat($(score).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                            valueNotNullBefore = true
                        }
                    }
                    else {
                        countTemp += 0;
                    }
                    if (!_thisData.isProrateScore || (_thisData.isProrateScore && $(score).val() != '')) {
                        if (_thisData.isProrateScore) {
                            let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                            if (temp) {
                                let subTemp = temp.subCompData.find(x => x.subComp == subM);
                                if (subTemp) {
                                    let toProrateArray =
                                    {
                                        'score': ((parseFloat($(score).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())),
                                    }
                                        ;
                                    prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == subM).val.push(toProrateArray);
                                }
                                else {
                                    let toProrateArray = {
                                        'subComp': subM,
                                        'averageCounter': averageCounterScore,
                                        'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                        'val': [
                                            {
                                                'score': ((parseFloat($(score).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())),
                                            }
                                        ]
                                    }
                                    prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                }
                            }
                            else {
                                let toProrateArray = {
                                    'comp': compM,
                                    'averageSubComp': averageSubCounterScore,
                                    'subCompData': [
                                        {
                                            'subComp': subM,
                                            'averageCounter': averageCounterScore,
                                            'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                            'val': [
                                                {
                                                    'score': ((parseFloat($(score).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())),
                                                }
                                            ]
                                        }
                                    ]
                                };
                                prorateArray.push(toProrateArray);
                            }
                            SubweightSum += parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val());
                        }
                        if (averageCounterScore != 1)
                            maxTemp += parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                        else
                            maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                        //weightTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + id[2] +  ",weight").val());
                        countCounter++;
                    }
                }
                else if (score.type == "hidden") {
                    radiobuttonbefore = "";
                    if ($(score).val() != '' && parseFloat($(score).val()) > 0) {
                        let valueTemporary = (parseFloat($(score).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())
                        if (!isNaN(valueTemporary)) {
                            countTemp += (parseFloat($(score).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                            valueNotNullBefore = true
                        }
                    }
                    else {
                        countTemp += 0;
                    }
                    if (!_thisData.isProrateScore || (_thisData.isProrateScore && $(score).val() != '')) {
                        if (_thisData.isProrateScore) {
                            let temp = _.find(prorateArray, function (x) { return x.comp == compM });
                            if (temp) {
                                let subTemp = temp.subCompData.find(x => x.subComp == subM);
                                if (subTemp) {
                                    let toProrateArray =
                                    {
                                        'score': ((parseFloat($(score).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())),
                                    }
                                        ;
                                    prorateArray.find(x => x.comp == compM).subCompData.find(x => x.subComp == subM).val.push(toProrateArray);
                                }
                                else {
                                    let toProrateArray = {
                                        'subComp': subM,
                                        'averageCounter': averageCounterScore,
                                        'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                        'val': [
                                            {
                                                'score': ((parseFloat($(score).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())),
                                            }
                                        ]
                                    }
                                    prorateArray.find(x => x.comp == compM).subCompData.push(toProrateArray);

                                }
                            }
                            else {
                                let toProrateArray = {
                                    'comp': compM,
                                    'averageSubComp': averageSubCounterScore,
                                    'subCompData': [
                                        {
                                            'subComp': subM,
                                            'averageCounter': averageCounterScore,
                                            'subWeight': parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()),
                                            'val': [
                                                {
                                                    'score': ((parseFloat($(score).val()) / parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",maxraw']").val())) * parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val())),
                                                }
                                            ]
                                        }
                                    ]
                                };
                                prorateArray.push(toProrateArray);
                            }
                            SubweightSum += parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val());
                        }
                        if (averageCounterScore != 1)
                            maxTemp += parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                        else
                            maxTemp = parseFloat($("input[class='hid," + studentID + "," + subM + "," + counterID + ",weight']").val());
                        countCounter++;
                    }
                }
                lastCounter = counterID;
            });
            //total += ((countTemp / maxTemp) * weightTemp);
            var afterValidateTotalCounter;
            if (lastaveragecounterscore != 1)
                afterValidateTotalCounter = countTemp;
            else afterValidateTotalCounter = countTemp / countCounter;
            if (!_thisData.isProrateScore || (_thisData.isProrateScore && afterValidateTotalCounter > 0))
            total += ((afterValidateTotalCounter / maxTemp) * parseFloat($("input[class='hid," + studentID + "," + subM + ",subweight']").val()));
            var afterValidateTotalSub;
            if (lastaveragesubcounterscore != 1) {
                afterValidateTotalSub = total;
            }
            else afterValidateTotalSub = total / countSub;
            totalComp += afterValidateTotalSub;
            if (_thisData.isProrateScore) {
                var afterValidateProrate;
                totalComp = 0;
                _.each(prorateArray, function (compScore, keySub) {
                    totalSubComp = 0;
                    var subProrateCount = compScore.subCompData.length;
                    var isSubProrateAverage = compScore.averageSubComp;
                    _.each(compScore.subCompData, function (score, keyscore) {
                        var totalProrateScore = 0;
                        var afterValidateProrateCounter = 0;
                        var isCounterProrateAverage = score.averageCounter;
                        var counterProrateCount = score.val.length;
                        _.each(score.val, function (counterScore, keyCounter) {
                            totalProrateScore += counterScore.score;
                        });
                        if (isCounterProrateAverage != "1") {
                            afterValidateProrateCounter += totalProrateScore;
                        }
                        else {
                            afterValidateProrateCounter += totalProrateScore / counterProrateCount;
                        }
                        totalSubComp += (afterValidateProrateCounter * score.subWeight) / SubweightSum;
                    });
                    if (isSubProrateAverage != "1") {
                        afterValidateProrate = totalSubComp;
                    }
                    else afterValidateProrate = totalSubComp / subProrateCount;
                    totalComp += afterValidateProrate;
                });
            }
            //$("input[id='" + studentID + ",total']").val((totalComp).toFixed(2));
            //$("label[id='" + studentID + ",total']").html((totalComp).toFixed(2));
            if (valueNotNullBefore)
                _.each(_thisData.SubjectScoreLegendList, function (x) {
                    if (totalComp >= x.min && totalComp <= x.max) $("td[id='grade-for-" + studentID + "']").html(x.grade)
                })
            if (_thisDataGlobal.IsScoreInOneGo)
                checkAllCounter();
            calculateCounter(period);
        }

        function calculate(id, elm, max) {
            var idElm = elm.attributes.id.value.split(",");
            var studentID = $(elm).is('select') == false ? idElm[0] : !$(elm).attr('id').includes('opt,') ? idElm[0] : idElm[1];
            let elmmax = $(`#raw_${!$(elm).attr('id').includes('opt,') ? idElm[2] : idElm[3]}`).length
            max = $(`#raw_${!$(elm).attr('id').includes('opt,') ? idElm[2] : idElm[3]}`).val();
            if (elmmax && (isNaN(max) || max === '')) {
                $(elm).val('');
                return toastr.error("Please Input Max Score");
            }
            var before = $("input[id='hid," + idElm.join(",").replace("opt,", "") + "']").val();
            if (parseFloat($(elm).val()) > parseFloat(max) || isNaN($(elm).val())) {
                $(elm).val(before);
            }
            else {
                if (!$(elm).is('select') && isNaN($(elm).val())) {
                    $(elm).val(before);
                    if ($(elm).val() == '') {
                        var id = $(elm).attr('id');
                        var id2 = "opt," + id;
                        $("select[id='" + id2 + "']").attr('disabled', false);
                    }
                }
                else {
                    if ($(elm).is('select')) {
                        var id = $(elm).attr('id');
                        var name = $(elm).attr('name');
                        if (name.includes(',submitted')) $(elm).attr('name', name.replace(',submitted', ''));
                        var id2 = id.replace("opt,", "");
                        if ($(elm).val() != '') {
                            $("input[id='" + id2 + "']").attr('disabled', 'disabled');
                            $("input[id='" + id2 + "']").val('');
                            $("input[id='hid," + idElm.join(",") + "']").val('');
                        } else {
                            $("input[id='" + id2 + "']").attr('disabled', false);
                        }
                    } else {
                        var id = $(elm).attr('id');
                        var id2 = "opt," + id;
                        if ($(elm).val() != '') {
                            $("select[id='" + id2 + "']").attr('disabled', 'disabled');
                            $("select[id='" + id2 + "']").val('');
                        } else {
                            $("select[id='" + id2 + "']").attr('disabled', false);
                        }
                        $("input[id='hid," + idElm.join(",") + "']").val($(elm).val());
                    }
                    CheckOther(studentID, settingGlobalScore.inPeriod);
                }
            }

        }

        function toogleTextArea(elm) {
            if ($(elm).is('select')) {
                var id = $(elm).attr('id');
                var id2 = id.replace("opt,", "");
                if ($(elm).val() != '') {
                    $("textarea[id='" + id2 + "']").attr('disabled', 'disabled');
                    $("textarea[id='" + id2 + "']").val('');
                } else {
                    $("textarea[id='" + id2 + "']").attr('disabled', false);
                }
            } else {
                var id = $(elm).attr('id');
                var id2 = "opt," + id;
                if ($(elm).val() != '') {
                    $("select[id='" + id2 + "']").attr('disabled', 'disabled');
                    $("select[id='" + id2 + "']").val('');
                } else {
                    $("select[id='" + id2 + "']").attr('disabled', false);
                }
            }
            if (_thisDataGlobal.IsScoreInOneGo)
                checkAllCounter();
            calculateCounter();
        }

        function changeCodeSetting(elm) {
            var idElm = elm.attributes.id.value;
            var name = $(elm).attr('name');
            if (name.includes(',submitted')) $(elm).attr('name', name.replace(',submitted', ''));
            var splitted = idElm.split(",");
            var scoreOption = elm.attributes.scoreType.value;
            if (scoreOption == "Radio") {
                var radId = elm.attributes.name.value;
                if ($(elm).val() != "") {
                    $("input[name='" + radId + "']").prop('disabled', true);
                }
                else $("input[name='" + radId + "']").prop('disabled', false);
                CheckOther(splitted[1], settingGlobalScore.inPeriod);

            }
        }

        function changeOptionScore(elm) {
            var name = $(elm).attr('name');
            if (name.includes(',submitted')) $(elm).attr('name', name.replace(',submitted', ''));
            var idElm = $(elm).attr("id").split(",");
            var studentID = idElm[0];
            CheckOther(studentID, settingGlobalScore.inPeriod);
        }

        function checkAllCounter() {
            var flag = false, radioButtonBefore = "";
            $(".input_score").each(function (key, elm) {
                if (elm.type == "radio") {
                    if (!radioButtonBefore) {
                        radioButtonBefore = elm.attributes.name.value;
                        if (!$("input[name='" + elm.attributes.name.value + "']").prop("disabled") && !$("input[name='" + elm.attributes.name.value + "']:checked").val()) {
                            flag = true;
                            $("#lblCounterError").html("You need to input all counter!")
                        }
                    }
                    else {
                        if (radioButtonBefore != elm.attributes.name.value) {
                            radioButtonBefore = elm.attributes.name.value;
                            if (!$("input[name='" + elm.attributes.name.value + "']").prop("disabled") && !$("input[name='" + elm.attributes.name.value + "']:checked").val()) {
                                flag = true;
                                $("#lblCounterError").html("You need to input all counter!")
                            }
                        }
                    }
                }
                else {
                    if (!flag && !$(elm).prop("disabled") && !$(elm).val()) {
                        flag = true;
                        $("#lblCounterError").html("You need to input all counter!")
                    }
                }
            });
            if (!flag) $("#lblCounterError").empty();
            return flag;
        }

        function findMaxValue(element) {
            var maxValue = undefined;
            if (element.type == "select-one") {
                $("select[id='" + element.attributes.id.value + "'] > option").each(function (key, elm) {
                    var val = $(elm).attr('value');
                    if (val) {
                        val = parseInt(val);
                        if (maxValue === undefined || maxValue < val) {
                            maxValue = val;
                        }
                    }
                });
            }
            else if (element.type == "radio") {
                $("input[name='" + element.attributes.name.value + "']").each(function (key, elm) {
                    var val = $(elm).attr('value');
                    if (val) {
                        val = parseInt(val);
                        if (maxValue === undefined || maxValue < val) {
                            maxValue = val;
                        }
                    }
                });
            }
            return maxValue;
        }

        function calculateCounter(period) {
            var value2 = 0;
            var value3 = 0;
            var value4 = 0;
            var value5 = 0;
            var value6 = 0;
            var radioButtonBefore = "";
            $(".input_score").each(function (key, elm) {
                if ($(elm).attr('name').includes(',submitted') && parseFloat($(elm).val()) >= 0) value4++;
                else {
                    if (elm.type == "radio") {
                        if (!radioButtonBefore) {
                            radioButtonBefore = elm.attributes.name.value;
                            if ($("input[name='" + radioButtonBefore + "']").prop('disabled') == false) value2++;
                            else if (period === -1 && $(elm).prop('disabled') === true) value6++;
                            //$("input[name=" + radioButtonBefore + "]").each(function (key, radionya) {
                            //    if (!flag && $(radionya).prop("checked") == true) {
                            //        flag = true;
                            //        value2++;
                            //    }
                            //});
                            var idelm = $(elm).attr('getId');
                            var opt = $("select[id='opt," + idelm + "']");
                        }
                        else {
                            if (radioButtonBefore != elm.attributes.name.value) {
                                radioButtonBefore = elm.attributes.name.value;
                                if ($("input[name='" + radioButtonBefore + "']").prop('disabled') == false) value2++;
                                else if (period === -1 && $(elm).prop('disabled') === true) value6++;
                                //$("input[name=" + elm.attributes.name.value + "]").each(function (key, radionya) {
                                //    if (!flag && $(radionya).prop("checked") == true) {
                                //        flag = true;
                                //        value2++;
                                //    }
                                //});
                                var idelm = $(elm).attr('getId');
                                var opt = $("select[id='opt," + idelm + "']");
                            }

                        }
                    }
                    else {
                        //if ($(elm).attr('id').includes('opt,')) {
                        //    console.log($(elm).val());
                        //    if ($(elm).val() && $(elm).val() == "-1") value5++;
                        //    if ($(elm).prop('disabled') == true) {
                        //        var id = elm.attributes.id.value.replace('opt,', '');
                        //        if ($("input[getId='" + id + "']").length > 0) {
                        //            var radname = $("input[getId='" + id + "']").first().attr('name');
                        //            if ($("input[name='" + radname + "']").prop('disabled') == false) value2++;
                        //        }
                        //        else {
                        //            $("input[id='" + id + "']").each(function (key, elm2) {
                        //                if ($(elm2).prop('disabled') == false) value2++;
                        //            });
                        //        }
                        //    }
                        //}
                        var idelm = $(elm).attr('id');
                        var opt = $("select[id='opt," + idelm + "']");
                        if (elm.type != "hidden" && $(elm).prop('disabled') == false) value2++;
                        else if (opt && $(opt).prop('disabled') === false) value2++;
                        else if (period === -1 && $(elm).prop('disabled') === true) value6++;
                    }
                }



            });
            value3 = $(".unsubmitted").length;
            $(".linkscore").each(function (key, elm) {
                if ($(this).html().toLowerCase().includes("pending")) value5++;
                if ($(this).html().toLowerCase().includes("unsubmitted")) value3++;
            });
            if (period === -1)
                value3 += value6;
            $("#label-total-pending").html(value5);
            $("#label-total-onprogress").html(value2);
            $("#label-total-submitted").html(value4);
            $("#label-total-unsubmitted").html(value3);
        }

        function changeRadioButton(elm) {
            var idElm = $(elm).attr("getId").split(",");
            var studentID = idElm[0];
            CheckOther(studentID, settingGlobalScore.inPeriod);
        }

        function clickRadioButton(elm) {
            let _thisRadio = elm;
            let radioname = elm.attributes.name.value;
            var splitted = radioname.split(",");
            var before = $(_thisRadio).prop('checked');
            let radio = $("input[name='" + radioname + "']");
            if ($(radio).attr('previousValue') == $(_thisRadio).val()) {
                $(_thisRadio).prop('checked', false);
            }
            else {
                $(radio).attr('previousValue', 'null');
                $(_thisRadio).prop('checked', true);
            }
            var checkedradio1 = $(_thisRadio).val();
            if (!$(_thisRadio).prop('checked'))
                checkedradio1 = 'null';
            $(radio).attr('previousValue', checkedradio1);
            var id = elm.attributes.getId.value;
            if (!$(_thisRadio).prop('checked')) $("select[id='opt," + id + "']").prop("disabled", false);
            else $("select[id='opt," + id + "']").prop("disabled", true);
            if (before && before != $(_thisRadio).prop('checked'))
                CheckOther(splitted[1], settingGlobalScore.inPeriod);
        }

        function clickAllRadioButton(elm) {
            let _thisRadio = elm;
            let radioname = elm.attributes.name.value;
            let radio = $("input[name='" + radioname + "']");
            if ($(radio).attr('previousValue') == $(_thisRadio).val()) {
                $(_thisRadio).prop('checked', false);
            }
            else {
                $(radio).attr('previousValue', 'null');
                $(_thisRadio).prop('checked', true);
            }
            var checkedradio1 = $(_thisRadio).val();
            if (!$(_thisRadio).prop('checked'))
                checkedradio1 = 'null';
            $(radio).attr('previousValue', checkedradio1);
            checkedradio1 = $(_thisRadio).val();
            $('input[name*=",' + radioname + ',"]').each(function (idx, rad) {
                if ($(rad).val() == checkedradio1 && $(rad).prop('disabled') == false) {
                    $(rad).click()
                    if ($(rad).prop('checked') != $(_thisRadio).prop('checked'))
                        $(rad).click()
                }
            })


        }

        function updateScoreInput(elm, max) {
            var idElm = elm.attributes.id.value;
            var before = $("#" + idElm + "before").val();
            if (parseFloat($(elm).val()) > parseFloat(max) || isNaN($(elm).val())) {
                $(elm).val(before);
                return false;
            }
            else {
                $("#" + idElm + "before").val($(elm).val());
                var codesetting = $("select[id='newScore_opt']");
                codesetting.val('');
                if ($(elm).val())
                    codesetting.prop("disabled", true);
                else codesetting.prop("disabled", false);
            }
            return true;
        }

        function sortByProperty(property) {
            return function (a, b) {
                if (a[property] < b[property])
                    return 1;
                else if (a[property] > b[property])
                    return -1;

                return 0;
            }
        }

        function padTo2Digits(num) {
            return num.toString().padStart(2, '0');
        }

        function formatDate(date) {
            return [
                date.getFullYear(),
                padTo2Digits(date.getMonth() + 1),
                padTo2Digits(date.getDate()),
            ].join('-');
        }

    </script>
}